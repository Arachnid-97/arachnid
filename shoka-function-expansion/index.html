<!-- build time:Mon Aug 25 2025 21:32:04 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="命运转轮" href="https://arachnid.cc/rss.xml"><link rel="alternate" type="application/atom+xml" title="命运转轮" href="https://arachnid.cc/atom.xml"><link rel="alternate" type="application/json" title="命运转轮" href="https://arachnid.cc/feed.json"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="hexo"><link rel="canonical" href="https://arachnid.cc/shoka-function-expansion/"><title>博客搭建笔记之功能扩展 - Hexo-shoka | Arachnid's blog = 命运转轮 = Life is ...the time you did something you're afraid of doing</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="loader-state"><div aria-label="Orange and tan hamster running in a metal wheel" role="img" class="wheel-and-hamster"><div class="wheel"></div><div class="hamster"><div class="hamster__body"><div class="hamster__head"><div class="hamster__ear"></div><div class="hamster__eye"></div><div class="hamster__nose"></div></div><div class="hamster__limb hamster__limb--fr"></div><div class="hamster__limb hamster__limb--fl"></div><div class="hamster__limb hamster__limb--br"></div><div class="hamster__limb hamster__limb--bl"></div><div class="hamster__tail"></div></div></div><div class="spoke"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">博客搭建笔记之功能扩展<i class="ic i-link-alt"></i></h1><div class="meta"><span class="item" title="创建时间：2022-05-25 23:23:42"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-05-25T23:23:42+08:00">2022-05-25</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>29k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>29 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Arachnid's blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://arachnid.cc/picture/(25).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(6).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(21).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(18).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(28).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(30).webp"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Hexo/" itemprop="item" rel="index" title="分类于 Hexo-shoka"><span itemprop="name">Hexo-shoka</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="cn"><link itemprop="mainEntityOfPage" href="https://arachnid.cc/shoka-function-expansion/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.webp"><meta itemprop="name" content="夏沫の浅雨"><meta itemprop="description" content="Life is ...the time you did something you're afraid of doing, 不曾亏欠，不曾辜负，如此足矣"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="命运转轮"></span><div class="body md" itemprop="articleBody"><h1 id="搜索功能"><a class="anchor" href="#搜索功能">#</a> 搜索功能</h1><h2 id="algolia搜索功能"><a class="anchor" href="#algolia搜索功能">#</a> algolia 搜索功能</h2><p></p><div class="links"><div class="item" title="algolia 官网" style="--block-color:#5468FF"><span class="exturl image" data-url="aHR0cHM6Ly93d3cuYWxnb2xpYS5jb20v" data-background-image="https://upload.wikimedia.org/wikipedia/commons/6/69/Algolia-logo.svg"></span><div class="info"><span class="exturl title" data-url="aHR0cHM6Ly93d3cuYWxnb2xpYS5jb20v">algolia 官网</span><p class="desc">algolia官方地址</p></div></div></div><p></p><p><strong>需要安装 <code>hexo-algoliasearch</code> 插件。</strong></p><ol><li><p>注册 algolia，创建 Index：</p><p><img data-src="image-20220530210920658.png" alt="image-20220530210920658"></p></li><li><p>获取 Key，修改站点配置：</p><ul><li><p>新建 API Key：<img data-src="image-20220530212532566.png" alt="image-20220530212532566"></p></li><li><p>获取相应的 Key，并填入配置信息：</p><p><img data-src="image-20220530212807371.png" alt="image-20220530212807371"></p></li></ul></li><li><p>在配置完 Key 后，回到终端控制台，键入以下命令上传数据到 <code>algolia</code> ：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>hexo algolia</pre></td></tr></table></figure></li></ol><p>配置参考：</p><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">algolia</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token key atrule">appId</span><span class="token punctuation">:</span> <span class="token string">"Application ID对应码"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token key atrule">apiKey</span><span class="token punctuation">:</span> <span class="token string">"API Keys页面的All API Keys中刚刚新建的API key的对应码"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token key atrule">adminApiKey</span><span class="token punctuation">:</span> <span class="token string">"Admin API Key对应码"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>   <span class="token key atrule">chunkSize</span><span class="token punctuation">:</span> <span class="token number">5000</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token key atrule">indexName</span><span class="token punctuation">:</span> <span class="token string">"你填写的Indices部分"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>   <span class="token key atrule">fields</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>     <span class="token punctuation">-</span> title <span class="token comment">#必须配置</span></pre></td></tr><tr><td data-num="9"></td><td><pre>     <span class="token punctuation">-</span> path <span class="token comment">#必须配置</span></pre></td></tr><tr><td data-num="10"></td><td><pre>     <span class="token punctuation">-</span> categories <span class="token comment">#推荐配置</span></pre></td></tr><tr><td data-num="11"></td><td><pre>     <span class="token punctuation">-</span> content<span class="token punctuation">:</span>strip<span class="token punctuation">:</span>truncate<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4000</span></pre></td></tr><tr><td data-num="12"></td><td><pre>     <span class="token punctuation">-</span> gallery</pre></td></tr><tr><td data-num="13"></td><td><pre>     <span class="token punctuation">-</span> photos</pre></td></tr><tr><td data-num="14"></td><td><pre>     <span class="token punctuation">-</span> tags</pre></td></tr></table></figure><p>注：每次更新修改文章后还需要执行 <code>hexo algolia</code> 的指令，否则，搜索数据没有或者对不上。</p><h2 id="本地搜索功能"><a class="anchor" href="#本地搜索功能">#</a> 本地搜索功能</h2><p>奈何本人对前端不熟悉，主要<s>参考</s>应用了该博主的<span class="exturl" data-url="aHR0cHM6Ly9saW5uLXlsei5jb20vSGV4by9ibG9nLXNlYXJjaC1jb25maWcv">教程</span>。</p><p><strong>需要安装 <code>hexo-generator-search</code> 插件。</strong></p><ol><li><p>修改主题文件夹下的 <code>themes\shoka\scripts\generaters\script.js</code> 文件，定位到 <code>if(config.algolia)</code> 判断的位置，然后追加配置赋值：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>search<span class="token punctuation">.</span>enable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    siteConfig<span class="token punctuation">.</span>search <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token literal-property property">path</span> <span class="token operator">:</span> config<span class="token punctuation">.</span>search<span class="token punctuation">.</span>path<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token literal-property property">field</span> <span class="token operator">:</span> config<span class="token punctuation">.</span>search<span class="token punctuation">.</span>post<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token literal-property property">format</span><span class="token operator">:</span> config<span class="token punctuation">.</span>search<span class="token punctuation">.</span>format<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token literal-property property">limit</span><span class="token operator">:</span> config<span class="token punctuation">.</span>search<span class="token punctuation">.</span>limit<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token literal-property property">content</span><span class="token operator">:</span> config<span class="token punctuation">.</span>search<span class="token punctuation">.</span>content<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token literal-property property">unescape</span><span class="token operator">:</span> config<span class="token punctuation">.</span>search<span class="token punctuation">.</span>unescape<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token literal-property property">preload</span><span class="token operator">:</span> config<span class="token punctuation">.</span>search<span class="token punctuation">.</span>preload<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token literal-property property">trigger</span><span class="token operator">:</span> config<span class="token punctuation">.</span>search<span class="token punctuation">.</span>trigger<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token literal-property property">top_n_per_article</span><span class="token operator">:</span> config<span class="token punctuation">.</span>search<span class="token punctuation">.</span>top_n_per_article<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token literal-property property">article_per_page</span><span class="token operator">:</span> config<span class="token punctuation">.</span>search<span class="token punctuation">.</span>article_per_page<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>在路径 <code>themes\shoka\source\js\_app\</code> 下，找到 <code>pjax.js</code> 搜索 <code>algoliaSearch()</code> 函数，该函数是用来实现 algolia 搜索的，由于现在要实现本地搜索，因此屏蔽掉该函数，添加并使用实现本地搜索的函数 <code>localSearch()</code> 。</p></li><li><p>实现 <code>localSearch()</code> 函数需要在 <code>themes\shoka\source\js\_app\page.js</code> 文件下找个地方定义如下内容：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">_toConsumableArray</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">_arrayWithoutHoles</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">_iterableToArray</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">_unsupportedIterableToArray</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">_nonIterableSpread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">_nonIterableSpread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">"Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">function</span> <span class="token function">_unsupportedIterableToArray</span><span class="token punctuation">(</span><span class="token parameter">o<span class="token punctuation">,</span> minLen</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>o<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> o <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">_arrayLikeToArray</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> minLen<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token string">"Object"</span> <span class="token operator">&amp;&amp;</span> o<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span> n <span class="token operator">=</span> o<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token string">"Map"</span> <span class="token operator">||</span> n <span class="token operator">===</span> <span class="token string">"Set"</span><span class="token punctuation">)</span> <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token string">"Arguments"</span> <span class="token operator">||</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">_arrayLikeToArray</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> minLen<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">function</span> <span class="token function">_iterableToArray</span><span class="token punctuation">(</span><span class="token parameter">iter</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Symbol <span class="token operator">!==</span> <span class="token string">"undefined"</span> <span class="token operator">&amp;&amp;</span> iter<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> iter<span class="token punctuation">[</span><span class="token string">"@@iterator"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>iter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">function</span> <span class="token function">_arrayWithoutHoles</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">_arrayLikeToArray</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">function</span> <span class="token function">_arrayLikeToArray</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> len</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> len <span class="token operator">></span> arr<span class="token punctuation">.</span>length<span class="token punctuation">)</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> arr2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">return</span> arr2<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">var</span> <span class="token function-variable function">localSearch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">localSearch</span><span class="token punctuation">(</span><span class="token parameter">pjax</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">// 参考 hexo next 主题的配置方法</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">.</span>search <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>siteSearch<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    siteSearch <span class="token operator">=</span> <span class="token constant">BODY</span><span class="token punctuation">.</span><span class="token function">createChild</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">'search'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token literal-property property">innerHTML</span><span class="token operator">:</span> <span class="token string">"&lt;div class=\"inner\">&lt;div class=\"header\">&lt;span class=\"icon\">&lt;i class=\"ic i-search\">&lt;/i>&lt;/span>&lt;div class=\"search-input-container\">&lt;input  class=\"search-input\"\nautocomplete=\"off\"\nplaceholder=\""</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token constant">LOCAL</span><span class="token punctuation">.</span>search<span class="token punctuation">.</span>placeholder<span class="token punctuation">,</span> <span class="token string">"\"\nspellcheck=\"false\"\ntype=\"text\"\nid=\"local-search-input\">&lt;/div>&lt;span class=\"close-btn\">&lt;i class=\"ic i-times-circle\">&lt;/i>&lt;/span>&lt;/div>&lt;div class=\"results\" id=\"search-results\">&lt;div class=\"inner\">&lt;div id=\"search-stats\">&lt;/div>&lt;div id=\"search-hits\">&lt;/div>&lt;div id=\"search-pagination\">&lt;/div>&lt;/div>&lt;/div>&lt;/div>&lt;/div>"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token keyword">var</span> isFetched <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token keyword">var</span> datas<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token keyword">var</span> isXml <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token keyword">var</span> current_page <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token keyword">var</span> article_per_page <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">.</span>search<span class="token punctuation">.</span>article_per_page<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token keyword">var</span> total_pages <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token keyword">var</span> max_page_on_show <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token comment">// 一次最多显示 7 个页码</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token keyword">var</span> start_page <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token keyword">var</span> end_page <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token keyword">var</span> resultItems <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token comment">// search DB path</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token keyword">var</span> searchPath <span class="token operator">=</span> <span class="token constant">CONFIG</span><span class="token punctuation">.</span>search<span class="token punctuation">.</span>path<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>searchPath<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    searchPath <span class="token operator">=</span> <span class="token string">'search.xml'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>searchPath<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    isXml <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token keyword">var</span> input <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.search-input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// document.querySelector('.search-input');</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token keyword">var</span> resultContent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'search-hits'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token keyword">var</span> paginationContent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'search-pagination'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token keyword">var</span> <span class="token function-variable function">getIndexByWord</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">getIndexByWord</span><span class="token punctuation">(</span><span class="token parameter">word<span class="token punctuation">,</span> text<span class="token punctuation">,</span> caseSensitive</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">.</span>search<span class="token punctuation">.</span>unescape<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>      <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>      div<span class="token punctuation">.</span>innerText <span class="token operator">=</span> word<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>      word <span class="token operator">=</span> div<span class="token punctuation">.</span>innerHTML<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token keyword">var</span> wordLen <span class="token operator">=</span> word<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>wordLen <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token keyword">var</span> startPosition <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">var</span> position <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>caseSensitive<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>      text <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>      word <span class="token operator">=</span> word<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>position <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> startPosition<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>      index<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token literal-property property">position</span><span class="token operator">:</span> position<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token literal-property property">word</span><span class="token operator">:</span> word</pre></td></tr><tr><td data-num="58"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>      startPosition <span class="token operator">=</span> position <span class="token operator">+</span> wordLen<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>    <span class="token keyword">return</span> index<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre>  <span class="token comment">// Merge hits into slices</span></pre></td></tr><tr><td data-num="65"></td><td><pre>  <span class="token keyword">var</span> <span class="token function-variable function">mergeIntoSlice</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">mergeIntoSlice</span><span class="token punctuation">(</span><span class="token parameter">start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> index<span class="token punctuation">,</span> searchText</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token keyword">var</span> item <span class="token operator">=</span> index<span class="token punctuation">[</span>index<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>    <span class="token keyword">var</span> _item <span class="token operator">=</span> item<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="68"></td><td><pre>      position <span class="token operator">=</span> _item<span class="token punctuation">.</span>position<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="69"></td><td><pre>      word <span class="token operator">=</span> _item<span class="token punctuation">.</span>word<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>    <span class="token keyword">var</span> hits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>    <span class="token keyword">var</span> searchTextCountInSlice <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span>position <span class="token operator">+</span> word<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> end <span class="token operator">&amp;&amp;</span> index<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>word <span class="token operator">===</span> searchText<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>        searchTextCountInSlice<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>      hits<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>        <span class="token literal-property property">position</span><span class="token operator">:</span> position<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="78"></td><td><pre>        <span class="token literal-property property">length</span><span class="token operator">:</span> word<span class="token punctuation">.</span>length</pre></td></tr><tr><td data-num="79"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>      <span class="token keyword">var</span> wordEnd <span class="token operator">=</span> position <span class="token operator">+</span> word<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre></pre></td></tr><tr><td data-num="82"></td><td><pre>      <span class="token comment">// Move to next position of hit</span></pre></td></tr><tr><td data-num="83"></td><td><pre>      index<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>      <span class="token keyword">while</span> <span class="token punctuation">(</span>index<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>        item <span class="token operator">=</span> index<span class="token punctuation">[</span>index<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>        position <span class="token operator">=</span> item<span class="token punctuation">.</span>position<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>        word <span class="token operator">=</span> item<span class="token punctuation">.</span>word<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>wordEnd <span class="token operator">></span> position<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>          index<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="90"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="91"></td><td><pre>          <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="94"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="95"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="96"></td><td><pre>      <span class="token literal-property property">hits</span><span class="token operator">:</span> hits<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="97"></td><td><pre>      <span class="token literal-property property">start</span><span class="token operator">:</span> start<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="98"></td><td><pre>      <span class="token literal-property property">end</span><span class="token operator">:</span> end<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="99"></td><td><pre>      <span class="token literal-property property">searchTextCount</span><span class="token operator">:</span> searchTextCountInSlice</pre></td></tr><tr><td data-num="100"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="101"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="102"></td><td><pre></pre></td></tr><tr><td data-num="103"></td><td><pre>  <span class="token comment">// Highlight title and content</span></pre></td></tr><tr><td data-num="104"></td><td><pre>  <span class="token keyword">var</span> <span class="token function-variable function">highlightKeyword</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">highlightKeyword</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> slice</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="105"></td><td><pre>    <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>    <span class="token keyword">var</span> prevEnd <span class="token operator">=</span> slice<span class="token punctuation">.</span>start<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="107"></td><td><pre>    slice<span class="token punctuation">.</span>hits<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">hit</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="108"></td><td><pre>      result <span class="token operator">+=</span> text<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>prevEnd<span class="token punctuation">,</span> hit<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="109"></td><td><pre>      <span class="token keyword">var</span> end <span class="token operator">=</span> hit<span class="token punctuation">.</span>position <span class="token operator">+</span> hit<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="110"></td><td><pre>      result <span class="token operator">+=</span> <span class="token string">"&lt;mark>"</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>hit<span class="token punctuation">.</span>position<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"&lt;/mark>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>      prevEnd <span class="token operator">=</span> end<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="113"></td><td><pre>    result <span class="token operator">+=</span> text<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>prevEnd<span class="token punctuation">,</span> slice<span class="token punctuation">.</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="114"></td><td><pre>    <span class="token keyword">return</span> result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="115"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="116"></td><td><pre>  <span class="token keyword">var</span> <span class="token function-variable function">pagination</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">pagination</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="117"></td><td><pre>    <span class="token keyword">var</span> <span class="token function-variable function">addPrevPage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">addPrevPage</span><span class="token punctuation">(</span><span class="token parameter">current_page</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="118"></td><td><pre>      <span class="token keyword">var</span> classContent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="119"></td><td><pre>      <span class="token keyword">var</span> numberContent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="120"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>current_page <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="121"></td><td><pre>        classContent <span class="token operator">=</span> <span class="token string">'#search-pagination pagination-item disabled-item'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="122"></td><td><pre>        numberContent <span class="token operator">=</span> <span class="token string">'&lt;span class="#search-pagination page-number">&lt;i class="ic i-angle-left">&lt;/i>&lt;/span>'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="123"></td><td><pre>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="124"></td><td><pre>        classContent <span class="token operator">=</span> <span class="token string">'#search-pagination pagination-item'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="125"></td><td><pre>        numberContent <span class="token operator">=</span> <span class="token string">"&lt;a class=\"#search-pagination page-number\" aria-label=\"Prev\" href=\"#\">&lt;i class=\"ic i-angle-left\">&lt;/i>&lt;/a>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="126"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="127"></td><td><pre>      <span class="token keyword">var</span> prevPage <span class="token operator">=</span> <span class="token string">"&lt;li class=\""</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>classContent<span class="token punctuation">,</span> <span class="token string">"\" id=\"prev-page\">"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>numberContent<span class="token punctuation">,</span> <span class="token string">" &lt;/li>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="128"></td><td><pre>      <span class="token keyword">return</span> prevPage<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="129"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="130"></td><td><pre>    <span class="token keyword">var</span> <span class="token function-variable function">addNextPage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">addNextPage</span><span class="token punctuation">(</span><span class="token parameter">current_page</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="131"></td><td><pre>      <span class="token keyword">var</span> classContent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="132"></td><td><pre>      <span class="token keyword">var</span> numberContent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="133"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>current_page <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">===</span> total_pages<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="134"></td><td><pre>        classContent <span class="token operator">=</span> <span class="token string">'#search-pagination pagination-item disabled-item'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="135"></td><td><pre>        numberContent <span class="token operator">=</span> <span class="token string">'&lt;span class="#search-pagination page-number">&lt;i class="ic i-angle-right">&lt;/i>&lt;/span>'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="136"></td><td><pre>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="137"></td><td><pre>        classContent <span class="token operator">=</span> <span class="token string">'#search-pagination pagination-item'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="138"></td><td><pre>        numberContent <span class="token operator">=</span> <span class="token string">"&lt;a class=\"#search-pagination page-number\" aria-label=\"Next\" href=\"#\">&lt;i class=\"ic i-angle-right\">&lt;/i>&lt;/a>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="139"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="140"></td><td><pre>      <span class="token keyword">var</span> nextPage <span class="token operator">=</span> <span class="token string">"&lt;li class=\""</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>classContent<span class="token punctuation">,</span> <span class="token string">"\" id=\"next-page\">"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>numberContent<span class="token punctuation">,</span> <span class="token string">" &lt;/li>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="141"></td><td><pre>      <span class="token keyword">return</span> nextPage<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="142"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="143"></td><td><pre>    <span class="token keyword">var</span> <span class="token function-variable function">addPage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">addPage</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> current_page</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="144"></td><td><pre>      <span class="token keyword">var</span> classContent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="145"></td><td><pre>      <span class="token keyword">var</span> numberContent <span class="token operator">=</span> <span class="token string">"&lt;a class=\"#search-pagination page-number\" aria-label=\""</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"\" href=\"#\">"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"&lt;/a>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="146"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> current_page<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="147"></td><td><pre>        classContent <span class="token operator">=</span> <span class="token string">'#search-pagination pagination-item current'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="148"></td><td><pre>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="149"></td><td><pre>        classContent <span class="token operator">=</span> <span class="token string">'#search-pagination pagination-item'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="150"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="151"></td><td><pre>      <span class="token keyword">var</span> page <span class="token operator">=</span> <span class="token string">"&lt;li class=\""</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>classContent<span class="token punctuation">,</span> <span class="token string">"\" id=\"page-"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"\">"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>numberContent<span class="token punctuation">,</span> <span class="token string">" &lt;/li>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="152"></td><td><pre>      <span class="token keyword">return</span> page<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="153"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="154"></td><td><pre>    <span class="token keyword">var</span> <span class="token function-variable function">addPaginationEvents</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">addPaginationEvents</span><span class="token punctuation">(</span><span class="token parameter">start_page<span class="token punctuation">,</span> end_page</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="155"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>total_pages <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="156"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="157"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="158"></td><td><pre>      <span class="token keyword">var</span> <span class="token function-variable function">onPrevPageClick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">onPrevPageClick</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="159"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>current_page <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="160"></td><td><pre>          current_page <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="161"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="162"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>current_page <span class="token operator">&lt;</span> start_page<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="163"></td><td><pre>          start_page <span class="token operator">=</span> current_page<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="164"></td><td><pre>          end_page <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>end_page<span class="token punctuation">,</span> start_page <span class="token operator">+</span> max_page_on_show<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="165"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="166"></td><td><pre>        <span class="token function">pagination</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="167"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="168"></td><td><pre>      <span class="token keyword">var</span> <span class="token function-variable function">onNextPageClick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">onNextPageClick</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="169"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>current_page <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> total_pages<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="170"></td><td><pre>          current_page <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="171"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="172"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>current_page <span class="token operator">></span> end_page<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="173"></td><td><pre>          end_page <span class="token operator">=</span> current_page<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="174"></td><td><pre>          start_page <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> end_page <span class="token operator">-</span> max_page_on_show<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="175"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="176"></td><td><pre>        <span class="token function">pagination</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="177"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="178"></td><td><pre>      <span class="token keyword">var</span> <span class="token function-variable function">onPageClick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">onPageClick</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="179"></td><td><pre>        <span class="token keyword">var</span> page_number <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>ariaLabel<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="180"></td><td><pre>        current_page <span class="token operator">=</span> page_number <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// note minus 1 here</span></pre></td></tr><tr><td data-num="181"></td><td><pre>        <span class="token function">pagination</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="182"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="183"></td><td><pre>      <span class="token keyword">var</span> prevPage <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'prev-page'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="184"></td><td><pre>      prevPage<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> onPrevPageClick<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="185"></td><td><pre>      <span class="token keyword">var</span> nextPage <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'next-page'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="186"></td><td><pre>      nextPage<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> onNextPageClick<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="187"></td><td><pre>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> start_page<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> end_page<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="188"></td><td><pre>        <span class="token keyword">var</span> page <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"page-"</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="189"></td><td><pre>        page<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> onPageClick<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="190"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="191"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="192"></td><td><pre>    paginationContent<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// clear</span></pre></td></tr><tr><td data-num="193"></td><td><pre>    <span class="token keyword">var</span> begin_index <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>current_page <span class="token operator">*</span> article_per_page<span class="token punctuation">,</span> resultItems<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="194"></td><td><pre>    <span class="token keyword">var</span> end_index <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>begin_index <span class="token operator">+</span> article_per_page<span class="token punctuation">,</span> resultItems<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="195"></td><td><pre>    resultContent<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>resultItems<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>begin_index<span class="token punctuation">,</span> end_index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="196"></td><td><pre>      <span class="token keyword">return</span> result<span class="token punctuation">.</span>item<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="197"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="198"></td><td><pre></pre></td></tr><tr><td data-num="199"></td><td><pre>    start_page <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> total_pages <span class="token operator">-</span> max_page_on_show<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="200"></td><td><pre>    end_page <span class="token operator">=</span> start_page <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>total_pages<span class="token punctuation">,</span> max_page_on_show<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="201"></td><td><pre>    <span class="token keyword">var</span> pageContent <span class="token operator">=</span> <span class="token string">'&lt;div class="#search-pagination">'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="202"></td><td><pre>    pageContent <span class="token operator">+=</span> <span class="token string">'&lt;div class="#search-pagination pagination">'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="203"></td><td><pre>    pageContent <span class="token operator">+=</span> <span class="token string">'&lt;ul>'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="204"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>total_pages <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="205"></td><td><pre>      <span class="token comment">// add prev page arrow, when no prev page not selectable</span></pre></td></tr><tr><td data-num="206"></td><td><pre>      pageContent <span class="token operator">+=</span> <span class="token function">addPrevPage</span><span class="token punctuation">(</span>current_page<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="207"></td><td><pre>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> start_page<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> end_page<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="208"></td><td><pre>        pageContent <span class="token operator">+=</span> <span class="token function">addPage</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> current_page<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="209"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="210"></td><td><pre>      <span class="token comment">// add next page arrow, when no next page not selectable</span></pre></td></tr><tr><td data-num="211"></td><td><pre>      pageContent <span class="token operator">+=</span> <span class="token function">addNextPage</span><span class="token punctuation">(</span>current_page<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="212"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="213"></td><td><pre>    pageContent <span class="token operator">+=</span> <span class="token string">'&lt;/ul>'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="214"></td><td><pre>    pageContent <span class="token operator">+=</span> <span class="token string">'&lt;/div>'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="215"></td><td><pre>    pageContent <span class="token operator">+=</span> <span class="token string">'&lt;/div>'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="216"></td><td><pre>    paginationContent<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> pageContent<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="217"></td><td><pre>    <span class="token function">addPaginationEvents</span><span class="token punctuation">(</span>start_page<span class="token punctuation">,</span> end_page<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="218"></td><td><pre>    resultContent<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// scroll to top</span></pre></td></tr><tr><td data-num="219"></td><td><pre>    window<span class="token punctuation">.</span>pjax <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>pjax<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span>resultContent<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="220"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="221"></td><td><pre>  <span class="token keyword">var</span> <span class="token function-variable function">inputEventFunction</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">inputEventFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="222"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isFetched<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="223"></td><td><pre>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Data not fetched."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="224"></td><td><pre>      <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="225"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="226"></td><td><pre>    <span class="token keyword">var</span> searchText <span class="token operator">=</span> input<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="227"></td><td><pre>    <span class="token keyword">var</span> keywords <span class="token operator">=</span> searchText<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[-\s]+</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="228"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>keywords<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="229"></td><td><pre>      keywords<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>searchText<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="230"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="231"></td><td><pre>    resultItems <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="232"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>searchText<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="233"></td><td><pre>      <span class="token comment">// Perform local searching</span></pre></td></tr><tr><td data-num="234"></td><td><pre>      datas<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_ref<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="235"></td><td><pre>        <span class="token keyword">var</span> categories <span class="token operator">=</span> _ref<span class="token punctuation">.</span>categories<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="236"></td><td><pre>          title <span class="token operator">=</span> _ref<span class="token punctuation">.</span>title<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="237"></td><td><pre>          content <span class="token operator">=</span> _ref<span class="token punctuation">.</span>content<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="238"></td><td><pre>          url <span class="token operator">=</span> _ref<span class="token punctuation">.</span>url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="239"></td><td><pre>        <span class="token keyword">var</span> titleInLowerCase <span class="token operator">=</span> title<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="240"></td><td><pre>        <span class="token keyword">var</span> contentInLowerCase <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="241"></td><td><pre>        <span class="token keyword">var</span> indexOfTitle <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="242"></td><td><pre>        <span class="token keyword">var</span> indexOfContent <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="243"></td><td><pre>        <span class="token keyword">var</span> searchTextCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="244"></td><td><pre>        keywords<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">keyword</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="245"></td><td><pre>          indexOfTitle <span class="token operator">=</span> indexOfTitle<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">getIndexByWord</span><span class="token punctuation">(</span>keyword<span class="token punctuation">,</span> titleInLowerCase<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="246"></td><td><pre>          indexOfContent <span class="token operator">=</span> indexOfContent<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">getIndexByWord</span><span class="token punctuation">(</span>keyword<span class="token punctuation">,</span> contentInLowerCase<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="247"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="248"></td><td><pre></pre></td></tr><tr><td data-num="249"></td><td><pre>        <span class="token comment">// Show search results</span></pre></td></tr><tr><td data-num="250"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>indexOfTitle<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">||</span> indexOfContent<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="251"></td><td><pre>          <span class="token keyword">var</span> hitCount <span class="token operator">=</span> indexOfTitle<span class="token punctuation">.</span>length <span class="token operator">+</span> indexOfContent<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="252"></td><td><pre>          <span class="token comment">// Sort index by position of keyword</span></pre></td></tr><tr><td data-num="253"></td><td><pre>          <span class="token punctuation">[</span>indexOfTitle<span class="token punctuation">,</span> indexOfContent<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="254"></td><td><pre>            index<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">itemLeft<span class="token punctuation">,</span> itemRight</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="255"></td><td><pre>              <span class="token keyword">if</span> <span class="token punctuation">(</span>itemRight<span class="token punctuation">.</span>position <span class="token operator">!==</span> itemLeft<span class="token punctuation">.</span>position<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="256"></td><td><pre>                <span class="token keyword">return</span> itemRight<span class="token punctuation">.</span>position <span class="token operator">-</span> itemLeft<span class="token punctuation">.</span>position<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="257"></td><td><pre>              <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="258"></td><td><pre>              <span class="token keyword">return</span> itemLeft<span class="token punctuation">.</span>word<span class="token punctuation">.</span>length <span class="token operator">-</span> item<span class="token punctuation">.</span>word<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="259"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="260"></td><td><pre>          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="261"></td><td><pre>          <span class="token keyword">var</span> slicesOfTitle <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="262"></td><td><pre>          <span class="token keyword">if</span> <span class="token punctuation">(</span>indexOfTitle<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="263"></td><td><pre>            <span class="token keyword">var</span> tmp <span class="token operator">=</span> <span class="token function">mergeIntoSlice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> title<span class="token punctuation">.</span>length<span class="token punctuation">,</span> indexOfTitle<span class="token punctuation">,</span> searchText<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="264"></td><td><pre>            searchTextCount <span class="token operator">+=</span> tmp<span class="token punctuation">.</span>searchTextCountInSlice<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="265"></td><td><pre>            slicesOfTitle<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="266"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="267"></td><td><pre>          <span class="token keyword">var</span> slicesOfContent <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="268"></td><td><pre>          <span class="token keyword">while</span> <span class="token punctuation">(</span>indexOfContent<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="269"></td><td><pre>            <span class="token keyword">var</span> _item2 <span class="token operator">=</span> indexOfContent<span class="token punctuation">[</span>indexOfContent<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="270"></td><td><pre>            <span class="token keyword">var</span> position <span class="token operator">=</span> _item2<span class="token punctuation">.</span>position<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="271"></td><td><pre>              word <span class="token operator">=</span> _item2<span class="token punctuation">.</span>word<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="272"></td><td><pre>            <span class="token comment">// Cut out 100 characters</span></pre></td></tr><tr><td data-num="273"></td><td><pre>            <span class="token keyword">var</span> start <span class="token operator">=</span> position <span class="token operator">-</span> <span class="token number">20</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="274"></td><td><pre>            <span class="token keyword">var</span> end <span class="token operator">=</span> position <span class="token operator">+</span> <span class="token number">30</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="275"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="276"></td><td><pre>              start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="277"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="278"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>end <span class="token operator">&lt;</span> position <span class="token operator">+</span> word<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="279"></td><td><pre>              end <span class="token operator">=</span> position <span class="token operator">+</span> word<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="280"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="281"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>end <span class="token operator">></span> content<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="282"></td><td><pre>              end <span class="token operator">=</span> content<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="283"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="284"></td><td><pre>            <span class="token keyword">var</span> _tmp <span class="token operator">=</span> <span class="token function">mergeIntoSlice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> indexOfContent<span class="token punctuation">,</span> searchText<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="285"></td><td><pre>            searchTextCount <span class="token operator">+=</span> _tmp<span class="token punctuation">.</span>searchTextCountInSlice<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="286"></td><td><pre>            slicesOfContent<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>_tmp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="287"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="288"></td><td><pre></pre></td></tr><tr><td data-num="289"></td><td><pre>          <span class="token comment">// Sort slices in content by search text's count and hits' count</span></pre></td></tr><tr><td data-num="290"></td><td><pre>          slicesOfContent<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">sliceLeft<span class="token punctuation">,</span> sliceRight</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="291"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>sliceLeft<span class="token punctuation">.</span>searchTextCount <span class="token operator">!==</span> sliceRight<span class="token punctuation">.</span>searchTextCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="292"></td><td><pre>              <span class="token keyword">return</span> sliceRight<span class="token punctuation">.</span>searchTextCount <span class="token operator">-</span> sliceLeft<span class="token punctuation">.</span>searchTextCount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="293"></td><td><pre>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sliceLeft<span class="token punctuation">.</span>hits<span class="token punctuation">.</span>length <span class="token operator">!==</span> sliceRight<span class="token punctuation">.</span>hits<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="294"></td><td><pre>              <span class="token keyword">return</span> sliceRight<span class="token punctuation">.</span>hits<span class="token punctuation">.</span>length <span class="token operator">-</span> sliceLeft<span class="token punctuation">.</span>hits<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="295"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="296"></td><td><pre>            <span class="token keyword">return</span> sliceLeft<span class="token punctuation">.</span>start <span class="token operator">-</span> sliceRight<span class="token punctuation">.</span>start<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="297"></td><td><pre>          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="298"></td><td><pre></pre></td></tr><tr><td data-num="299"></td><td><pre>          <span class="token comment">// Select top N slices in content</span></pre></td></tr><tr><td data-num="300"></td><td><pre>          <span class="token keyword">var</span> upperBound <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">.</span>search<span class="token punctuation">.</span>top_n_per_article<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="301"></td><td><pre>          <span class="token keyword">if</span> <span class="token punctuation">(</span>upperBound <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="302"></td><td><pre>            slicesOfContent <span class="token operator">=</span> slicesOfContent<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> upperBound<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="303"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="304"></td><td><pre>          <span class="token keyword">var</span> resultItem <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="305"></td><td><pre>          resultItem <span class="token operator">+=</span> <span class="token string">'&lt;div class="#search-hits item">'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="306"></td><td><pre>          resultItem <span class="token operator">+=</span> <span class="token string">'&lt;li>'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="307"></td><td><pre>          <span class="token keyword">var</span> cats <span class="token operator">=</span> categories <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token string">'&lt;span>'</span> <span class="token operator">+</span> categories<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'&lt;i class="ic i-angle-right">&lt;/i>'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&lt;/span>'</span> <span class="token operator">:</span> <span class="token string">'&lt;span>No categories&lt;/span>'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="308"></td><td><pre>          resultItem <span class="token operator">+=</span> <span class="token string">"&lt;a href=\""</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">"\">"</span><span class="token punctuation">)</span> <span class="token operator">+</span> cats<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="309"></td><td><pre>          <span class="token keyword">if</span> <span class="token punctuation">(</span>slicesOfTitle<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="310"></td><td><pre>            resultItem <span class="token operator">+=</span> <span class="token string">"&lt;b>"</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">highlightKeyword</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> slicesOfTitle<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"&lt;/b>&lt;br>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="311"></td><td><pre>          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="312"></td><td><pre>            resultItem <span class="token operator">+=</span> <span class="token string">"&lt;b>"</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> <span class="token string">"&lt;/b>&lt;br>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="313"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="314"></td><td><pre>          slicesOfContent<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">slice</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="315"></td><td><pre>            resultItem <span class="token operator">+=</span> <span class="token string">"&lt;li class=\"#search-hits subitem\">"</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">highlightKeyword</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> slice<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">" ...&lt;/li>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="316"></td><td><pre>          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="317"></td><td><pre></pre></td></tr><tr><td data-num="318"></td><td><pre>          resultItem <span class="token operator">+=</span> <span class="token string">'&lt;/a>'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="319"></td><td><pre>          resultItem <span class="token operator">+=</span> <span class="token string">'&lt;/li>'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="320"></td><td><pre>          resultItem <span class="token operator">+=</span> <span class="token string">'&lt;/div>'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="321"></td><td><pre>          resultItems<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="322"></td><td><pre>            <span class="token literal-property property">item</span><span class="token operator">:</span> resultItem<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="323"></td><td><pre>            <span class="token literal-property property">id</span><span class="token operator">:</span> resultItems<span class="token punctuation">.</span>length<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="324"></td><td><pre>            <span class="token literal-property property">hitCount</span><span class="token operator">:</span> hitCount<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="325"></td><td><pre>            <span class="token literal-property property">searchTextCount</span><span class="token operator">:</span> searchTextCount</pre></td></tr><tr><td data-num="326"></td><td><pre>          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="327"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="328"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="329"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="330"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>keywords<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> keywords<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="331"></td><td><pre>      resultContent<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'&lt;div id="no-result">&lt;i>&lt;/i>&lt;/div>'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="332"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>resultItems<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="333"></td><td><pre>      resultContent<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'&lt;div id="no-result">&lt;i>&lt;/i>&lt;/div>'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="334"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="335"></td><td><pre>      resultItems<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resultLeft<span class="token punctuation">,</span> resultRight</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="336"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>resultLeft<span class="token punctuation">.</span>searchTextCount <span class="token operator">!==</span> resultRight<span class="token punctuation">.</span>searchTextCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="337"></td><td><pre>          <span class="token keyword">return</span> resultRight<span class="token punctuation">.</span>searchTextCount <span class="token operator">-</span> resultLeft<span class="token punctuation">.</span>searchTextCount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="338"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>resultLeft<span class="token punctuation">.</span>hitCount <span class="token operator">!==</span> resultRight<span class="token punctuation">.</span>hitCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="339"></td><td><pre>          <span class="token keyword">return</span> resultRight<span class="token punctuation">.</span>hitCount <span class="token operator">-</span> resultLeft<span class="token punctuation">.</span>hitCount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="340"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="341"></td><td><pre>        <span class="token keyword">return</span> resultRight<span class="token punctuation">.</span>id <span class="token operator">-</span> resultLeft<span class="token punctuation">.</span>id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="342"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="343"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="344"></td><td><pre>    <span class="token comment">// Do pagination</span></pre></td></tr><tr><td data-num="345"></td><td><pre>    total_pages <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>resultItems<span class="token punctuation">.</span>length <span class="token operator">/</span> article_per_page<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="346"></td><td><pre>    <span class="token function">pagination</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="347"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="348"></td><td><pre>  <span class="token keyword">var</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="349"></td><td><pre>    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">.</span>root <span class="token operator">+</span> searchPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="350"></td><td><pre>      <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="351"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="352"></td><td><pre>      <span class="token comment">// Get the contents from search data</span></pre></td></tr><tr><td data-num="353"></td><td><pre>      isFetched <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="354"></td><td><pre>      datas <span class="token operator">=</span> isXml <span class="token operator">?</span> <span class="token function">_toConsumableArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DOMParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseFromString</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'text/xml'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'entry'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="355"></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="356"></td><td><pre>          <span class="token literal-property property">title</span><span class="token operator">:</span> element<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="357"></td><td><pre>          <span class="token literal-property property">content</span><span class="token operator">:</span> element<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="358"></td><td><pre>          <span class="token literal-property property">url</span><span class="token operator">:</span> element<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent</pre></td></tr><tr><td data-num="359"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="360"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="361"></td><td><pre>      <span class="token comment">// Only match articles with not empty titles</span></pre></td></tr><tr><td data-num="362"></td><td><pre>      datas <span class="token operator">=</span> datas<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="363"></td><td><pre>        <span class="token keyword">return</span> data<span class="token punctuation">.</span>title<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="364"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="365"></td><td><pre>        data<span class="token punctuation">.</span>title <span class="token operator">=</span> data<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="366"></td><td><pre>        data<span class="token punctuation">.</span>content <span class="token operator">=</span> data<span class="token punctuation">.</span>content <span class="token operator">?</span> data<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;[^>]+></span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="367"></td><td><pre>        data<span class="token punctuation">.</span>url <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/&#123;2,&#125;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="368"></td><td><pre>        <span class="token keyword">return</span> data<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="369"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="370"></td><td><pre>      <span class="token comment">// Remove loading animation</span></pre></td></tr><tr><td data-num="371"></td><td><pre>      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'search-hits'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'&lt;i>&lt;/i>'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="372"></td><td><pre>      <span class="token function">inputEventFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="373"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="374"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="375"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">.</span>search<span class="token punctuation">.</span>preload<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="376"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"fetch data."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="377"></td><td><pre>    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="378"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="379"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">.</span>search<span class="token punctuation">.</span>trigger <span class="token operator">===</span> <span class="token string">'auto'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="380"></td><td><pre>    input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> inputEventFunction<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="381"></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="382"></td><td><pre>    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.search-icon'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> inputEventFunction<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="383"></td><td><pre>    input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keypress'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="384"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'Enter'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="385"></td><td><pre>        <span class="token function">inputEventFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="386"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="387"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="388"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="389"></td><td><pre></pre></td></tr><tr><td data-num="390"></td><td><pre>  <span class="token comment">// Handle and trigger popup window</span></pre></td></tr><tr><td data-num="391"></td><td><pre>  document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.popup-trigger'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="392"></td><td><pre>    element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="393"></td><td><pre>      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> <span class="token string">'hidden'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="394"></td><td><pre>      document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.search-pop-overlay'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'search-active'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="395"></td><td><pre>      input<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="396"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isFetched<span class="token punctuation">)</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="397"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="398"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="399"></td><td><pre></pre></td></tr><tr><td data-num="400"></td><td><pre>  <span class="token comment">// Handle and trigger popup window</span></pre></td></tr><tr><td data-num="401"></td><td><pre>  $<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token string">'.search'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="402"></td><td><pre>    element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="403"></td><td><pre>      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> <span class="token string">'hidden'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="404"></td><td><pre>      <span class="token function">transition</span><span class="token punctuation">(</span>siteSearch<span class="token punctuation">,</span> <span class="token string">'shrinkIn'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="405"></td><td><pre>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.search-input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="406"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// transition.shrinkIn</span></pre></td></tr><tr><td data-num="407"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="408"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="409"></td><td><pre></pre></td></tr><tr><td data-num="410"></td><td><pre>  <span class="token comment">// Monitor main search box</span></pre></td></tr><tr><td data-num="411"></td><td><pre>  <span class="token keyword">var</span> <span class="token function-variable function">onPopupClose</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">onPopupClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="412"></td><td><pre>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="413"></td><td><pre>    <span class="token function">transition</span><span class="token punctuation">(</span>siteSearch<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "transition.shrinkOut"</span></pre></td></tr><tr><td data-num="414"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="415"></td><td><pre></pre></td></tr><tr><td data-num="416"></td><td><pre>  siteSearch<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="417"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>target <span class="token operator">===</span> siteSearch<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="418"></td><td><pre>      <span class="token function">onPopupClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="419"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="420"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="421"></td><td><pre>  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.close-btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> onPopupClose<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="422"></td><td><pre>  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pjax:success'</span><span class="token punctuation">,</span> onPopupClose<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="423"></td><td><pre>  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="424"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'Escape'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="425"></td><td><pre>      <span class="token function">onPopupClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="426"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="427"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="428"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>配置信息添加参考：<span class="exturl" data-url="aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvaGV4by1nZW5lcmF0b3Itc2VhcmNo">https://www.npmjs.com/package/hexo-generator-search</span></p></li></ol><h1 id="valine-评价功能"><a class="anchor" href="#valine-评价功能">#</a> valine 评价功能</h1><h2 id="leancloud-配置"><a class="anchor" href="#leancloud-配置">#</a> leancloud 配置</h2><p></p><div class="links"><div class="item" title="leancloud 官网" style="--block-color:#2C97E8"><span class="exturl image" data-url="aHR0cHM6Ly9sZWFuY2xvdWQuYXBwLw==" data-background-image="https://www.leancloud.cn/assets/imgs/press/Logo%20-%20Normal%20Padding.0fd4f628.png"></span><div class="info"><span class="exturl title" data-url="aHR0cHM6Ly9sZWFuY2xvdWQuYXBwLw==">leancloud 官网</span><p class="desc">leancloud官方地址</p></div></div></div><p></p><p>1、<span class="exturl" data-url="aHR0cHM6Ly92YWxpbmUuanMub3JnL3F1aWNrc3RhcnQuaHRtbA==">获取 LeanCloud 的 appld 和 appkey</span> 。</p><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">valine</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">appId</span><span class="token punctuation">:</span> <span class="token comment">#Your_appId</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">appKey</span><span class="token punctuation">:</span> <span class="token comment">#Your_appkey</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">placeholder</span><span class="token punctuation">:</span> ヽ(○´∀`)ﾉ♪ <span class="token comment"># Comment box placeholder</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token key atrule">avatar</span><span class="token punctuation">:</span> mp <span class="token comment"># Gravatar style : mp, identicon, monsterid, wavatar, robohash, retro</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token key atrule">pageSize</span><span class="token punctuation">:</span> <span class="token number">10</span> <span class="token comment"># Pagination size</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token key atrule">lang</span><span class="token punctuation">:</span> zh<span class="token punctuation">-</span>CN</pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token key atrule">visitor</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 文章访问量统计</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token key atrule">NoRecordIP</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 不记录 IP</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token key atrule">serverURLs</span><span class="token punctuation">:</span> <span class="token comment"># When the custom domain name is enabled, fill it in here (it will be detected automatically by default, no need to fill in)；当使用 LeanCloud 共享域名时填入 LeanCloud 服务器地址 (REST API 服务器地址)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token key atrule">powerMode</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 默认打开评论框输入特效</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token key atrule">tagMeta</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token key atrule">visitor</span><span class="token punctuation">:</span> 新朋友</pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token key atrule">master</span><span class="token punctuation">:</span> 主人</pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token key atrule">friend</span><span class="token punctuation">:</span> 小伙伴</pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token key atrule">investor</span><span class="token punctuation">:</span> 金主粑粑</pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token key atrule">tagColor</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token key atrule">master</span><span class="token punctuation">:</span> <span class="token string">"var(--color-orange)"</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token key atrule">friend</span><span class="token punctuation">:</span> <span class="token string">"var(--color-aqua)"</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token key atrule">investor</span><span class="token punctuation">:</span> <span class="token string">"var(--color-pink)"</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token key atrule">tagMember</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token key atrule">master</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>      <span class="token comment"># - hash of master@email.com</span></pre></td></tr><tr><td data-num="24"></td><td><pre>      <span class="token comment"># - hash of master2@email.com</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token key atrule">friend</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>      <span class="token comment"># - hash of friend@email.com</span></pre></td></tr><tr><td data-num="27"></td><td><pre>      <span class="token comment"># - hash of friend2@email.com</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token key atrule">investor</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>      <span class="token comment"># - hash of investor1@email.com</span></pre></td></tr></table></figure><p>2、tagMeta 标签</p><p>tag 标签显示在评论者名字的后面，默认是 <code>tagMeta.visitor</code> 对应的值。<br>在 <code>tagMeta</code> 和 <code>tagColor</code> 中，除了 <code>visitor</code> 这个 key 不能修改外，其他 key 都可以换一换，但需要保证一致性。</p><figure class="highlight yaml"><figcaption data-lang="YAML"><span>举个栗子</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">tagMeta</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">visitor</span><span class="token punctuation">:</span> 游客</pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">admin</span><span class="token punctuation">:</span> 管理员</pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">waifu</span><span class="token punctuation">:</span> 我老婆</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token key atrule">tagColor</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token key atrule">visitor</span><span class="token punctuation">:</span> <span class="token string">"#855194"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token key atrule">admin</span><span class="token punctuation">:</span> <span class="token string">"#a77c59"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token key atrule">waifu</span><span class="token punctuation">:</span> <span class="token string">"#ed6ea0"</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token key atrule">tagMember</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token key atrule">admin</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment"># - hash of admin@email.com</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token key atrule">waifu</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment"># - hash of waifu@email.com</span></pre></td></tr></table></figure><p>3、单篇文章评价配置</p><p>在文章 Front Matter 中也可以配置上述参数，访问该文章页面时，将覆盖全局配置。<br>尤其可以用来配置一个特殊的 <code>placeholder</code> ：</p><figure class="highlight markdown"><figcaption data-lang="markdown"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token front-matter-block"><span class="token punctuation">---</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token front-matter yaml language-yaml"><span class="token key atrule">valine</span><span class="token punctuation">:</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">placeholder</span><span class="token punctuation">:</span> <span class="token string">"💪请遵守评价礼仪, 禁止恶意评价\n🤣一起来玩啊, 留下你的足迹吧\n⚠️公开网络, 注意隐私信息"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">---</span></pre></td></tr></table></figure><p>如果某一篇文章需要关闭评论功能，则在文章 Front Matter 中配置：</p><figure class="highlight markdown"><figcaption data-lang="markdown"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token front-matter-block"><span class="token punctuation">---</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token front-matter yaml language-yaml"><span class="token key atrule">title</span><span class="token punctuation">:</span> 关闭评论</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">comment</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">---</span></pre></td></tr></table></figure><h2 id="valine-admin-配置"><a class="anchor" href="#valine-admin-配置">#</a> Valine Admin 配置</h2><p></p><div class="links"><div class="item" title="Valine Admin 主站" style="--block-color:#0E9FCF"><span class="exturl image" data-url="aHR0cHM6Ly9naXRodWIuY29tL0Rlc2VydHNQL1ZhbGluZS1BZG1pbg==" data-background-image="https://valine.js.org/images/valine.png"></span><div class="info"><span class="exturl title" data-url="aHR0cHM6Ly9naXRodWIuY29tL0Rlc2VydHNQL1ZhbGluZS1BZG1pbg==">Valine Admin 主站</span><p class="desc">Valine-Admin网页地址</p></div></div></div><p></p><p>评论通知与管理工具建议使用这个<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0Rlc2VydHNQL1ZhbGluZS1BZG1pbg=="> Valine-Admin</span> ；大致教程可参考：<span class="exturl" data-url="aHR0cHM6Ly9kZXNlcnRzLmlvL3ZhbGluZS1hZG1pbi1kb2N1bWVudC8=">Valine Admin 配置手册</span> 。</p><p><strong>以下作相关重要部分补充，以 LeanCloud 国际版为准。</strong></p><h3 id="自定义环境变量"><a class="anchor" href="#自定义环境变量">#</a> 自定义环境变量</h3><p>点击 <code>云引擎</code> - <code>-WEB</code> - <code>设置</code> - <code>添加</code> ， 添加一些如下变量， 可以用来自定义一些邮件通知、通知模板、消息回复等个性化的设置。</p><table><thead><tr><th>变量</th><th>示例</th><th>说明</th></tr></thead><tbody><tr><td>ADMIN_URL</td><td><span class="exturl" data-url="aHR0cHM6Ly94eHguZXhhbXBsZS5jb20v">https://xxx.example.com/</span></td><td>[建议] Web 主机二级域名（云引擎域名），用于自动唤醒</td></tr><tr><td>AKISMET_KEY</td><td>xxxxxxx</td><td>[可选] <span class="exturl" data-url="aHR0cHM6Ly9ha2lzbWV0LmNvbS8=">Akismet</span> Key 用于垃圾评论检测，设为 MANUAL_REVIEW 开启人工审核，留空不使用反垃圾</td></tr><tr><td>BLOGGER_EMAIL</td><td><code>$&#123;SENDER_EMAIL&#125;</code></td><td>[可选] 博主通知收件地址，默认使用 SENDER_EMAIL</td></tr><tr><td>MAIL_SUBJECT</td><td><code>$&#123;PARENT_NICK&#125;</code> ，您在 ​ <code>$&#123;SITE_NAME&#125;</code> 上的评论收到了回复</td><td>[可选] 访客邮件接收主题</td></tr><tr><td>MAIL_SUBJECT_ADMIN</td><td><code>$&#123;SITE_NAME&#125;</code> 上有新评论了</td><td>[可选] 管理员邮件接收主题</td></tr><tr><td>MAIL_TEMPLATE</td><td><a href="#MAIL_TEMPLATE">代码块_1</a></td><td>[可选] 访客邮件内容模板</td></tr><tr><td>MAIL_TEMPLATE_ADMIN</td><td><a href="#MAIL_TEMPLATE_ADMIN">代码块_2</a></td><td>[可选] 管理员邮件内容模板</td></tr><tr><td>SENDER_EMAIL</td><td><span class="exturl" data-url="bWFpbHRvOnh4eHh4eEBxcS5jb20=">xxxxxx@qq.com</span></td><td>[必填] 发件邮箱</td></tr><tr><td>SENDER_NAME</td><td>user_name</td><td>[必填] 发件人</td></tr><tr><td>SITE_NAME</td><td>xxx's blog</td><td>[必填] 博客名称</td></tr><tr><td>SITE_URL</td><td><span class="exturl" data-url="aHR0cHM6Ly9leGFtcGxlLmNvbS8=">https://example.com/</span></td><td>[必填] 博客首页地址</td></tr><tr><td>SMTP_HOST</td><td><span class="exturl" data-url="aHR0cDovL3NtdHAucXEuY29t">smtp.qq.com</span></td><td>[可选] SMTP_SERVICE 留空时，自定义 SMTP 服务器地址</td></tr><tr><td>SMTP_PASS</td><td>xxxxxxx</td><td>[必填] SMTP 登录密码（QQ 邮箱需要获取 SMTP 授权码，参照<span class="exturl" data-url="aHR0cHM6Ly9zZXJ2aWNlLm1haWwucXEuY29tL2NnaS1iaW4vaGVscD9zdWJ0eXBlPTEmYW1wO2lkPTI4JmFtcDtubz0xMDAxMjU2">客户端设置</span>）</td></tr><tr><td>SMTP_PORT</td><td>465 或 587，参照 <span class="exturl" data-url="aHR0cHM6Ly9zZXJ2aWNlLm1haWwucXEuY29tL2NnaS1iaW4vaGVscD9pZD0yOCZhbXA7bm89MTY3JmFtcDtzdWJ0eXBlPTE=">POP3 与 SMTP</span></td><td>[可选] SMTP_SERVICE 留空时，自定义 SMTP 端口</td></tr><tr><td>SMTP_SECURE</td><td>true</td><td>[可选] 使用 TLS</td></tr><tr><td>SMTP_SERVICE</td><td>QQ</td><td>[新版支持] 邮件服务提供商，支持 QQ、163、126、Gmail 以及 <span class="exturl" data-url="aHR0cHM6Ly9ub2RlbWFpbGVyLmNvbS9zbXRwL3dlbGwta25vd24vI3N1cHBvcnRlZC1zZXJ2aWNlcw==">更多</span></td></tr><tr><td>SMTP_USER</td><td><span class="exturl" data-url="bWFpbHRvOnh4eHh4eEBxcS5jb20=">xxxxxx@qq.com</span></td><td>[必填] SMTP 用户名</td></tr></tbody></table><p>注意 <code>SITE_URL</code> 需要以 <code>/</code> 结尾，否则在评价后台的 <code>查看评价</code> 的链接会对不上文章链接（缺 <code>/</code> 分割符）。</p><h4 id="mail_template"><a class="anchor" href="#mail_template">#</a> MAIL_TEMPLATE</h4><p>变量实现：</p><figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">border-radius</span><span class="token punctuation">:</span> 10px 10px 10px 10px<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span>13px<span class="token punctuation">;</span>    <span class="token property">color</span><span class="token punctuation">:</span> #555555<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span> 666px<span class="token punctuation">;</span><span class="token property">font-family</span><span class="token punctuation">:</span><span class="token string">'Century Gothic'</span><span class="token punctuation">,</span><span class="token string">'Trebuchet MS'</span><span class="token punctuation">,</span><span class="token string">'Hiragino Sans GB'</span><span class="token punctuation">,</span>微软雅黑<span class="token punctuation">,</span><span class="token string">'Microsoft Yahei'</span><span class="token punctuation">,</span>Tahoma<span class="token punctuation">,</span>Helvetica<span class="token punctuation">,</span>Arial<span class="token punctuation">,</span><span class="token string">'SimSun'</span><span class="token punctuation">,</span>sans-serif<span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span>50px auto<span class="token punctuation">;</span><span class="token property">border</span><span class="token punctuation">:</span>1px solid #eee<span class="token punctuation">;</span><span class="token property">max-width</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span> #ffffff <span class="token function">repeating-linear-gradient</span><span class="token punctuation">(</span>-45deg<span class="token punctuation">,</span>#fff<span class="token punctuation">,</span>#fff 1.125rem<span class="token punctuation">,</span>transparent 1.125rem<span class="token punctuation">,</span>transparent 2.25rem<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 1px 5px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.15<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span>#49BDAD<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#ffffff<span class="token punctuation">;</span><span class="token property">border-radius</span><span class="token punctuation">:</span> 10px 10px 0 0<span class="token punctuation">;</span><span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">-moz-linear-gradient</span><span class="token punctuation">(</span>0deg<span class="token punctuation">,</span> <span class="token function">rgb</span><span class="token punctuation">(</span>67<span class="token punctuation">,</span> 198<span class="token punctuation">,</span> 184<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rgb</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 209<span class="token punctuation">,</span> 244<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">-webkit-linear-gradient</span><span class="token punctuation">(</span>0deg<span class="token punctuation">,</span> <span class="token function">rgb</span><span class="token punctuation">(</span>67<span class="token punctuation">,</span> 198<span class="token punctuation">,</span> 184<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rgb</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 209<span class="token punctuation">,</span> 244<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> 66px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">font-size</span><span class="token punctuation">:</span>15px<span class="token punctuation">;</span><span class="token property">word-break</span><span class="token punctuation">:</span>break-all<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span> 23px 32px<span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span><span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">hsla</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0%<span class="token punctuation">,</span>100%<span class="token punctuation">,</span>.4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">border-radius</span><span class="token punctuation">:</span> 10px 10px 0 0<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>您在<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span> #ffffff<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;SITE_URL&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> $&#123;SITE_NAME&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>上的留言有新回复啦！<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">margin</span><span class="token punctuation">:</span>40px auto<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span>90%</span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>$&#123;PARENT_NICK&#125; 同学，您曾在文章上发表评论：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">background</span><span class="token punctuation">:</span> #fafafa <span class="token function">repeating-linear-gradient</span><span class="token punctuation">(</span>-45deg<span class="token punctuation">,</span>#fff<span class="token punctuation">,</span>#fff 1.125rem<span class="token punctuation">,</span>transparent 1.125rem<span class="token punctuation">,</span>transparent 2.25rem<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 2px 5px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.15<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span>20px 0px<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span>15px<span class="token punctuation">;</span><span class="token property">border-radius</span><span class="token punctuation">:</span>5px<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span>14px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#555555<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>$&#123;PARENT_COMMENT&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>$&#123;NICK&#125; 给您的回复如下：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">background</span><span class="token punctuation">:</span> #fafafa <span class="token function">repeating-linear-gradient</span><span class="token punctuation">(</span>-45deg<span class="token punctuation">,</span>#fff<span class="token punctuation">,</span>#fff 1.125rem<span class="token punctuation">,</span>transparent 1.125rem<span class="token punctuation">,</span>transparent 2.25rem<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 2px 5px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.15<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span>20px 0px<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span>15px<span class="token punctuation">;</span><span class="token property">border-radius</span><span class="token punctuation">:</span>5px<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span>14px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#555555<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>$&#123;COMMENT&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>您可以点击<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span>#12addb</span><span class="token punctuation">"</span></span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;POST_URL&#125;#comments<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>查看回复的完整內容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>，欢迎再次光临<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span>#12addb</span><span class="token punctuation">"</span></span></span>                <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;SITE_URL&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> $&#123;SITE_NAME&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><span class="token selector">a:link</span><span class="token punctuation">&#123;</span><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">&#125;</span><span class="token selector">a:visited</span><span class="token punctuation">&#123;</span><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">&#125;</span><span class="token selector">a:hover</span><span class="token punctuation">&#123;</span><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">&#125;</span><span class="token selector">a:active</span><span class="token punctuation">&#123;</span><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h4 id="mail_template_admin"><a class="anchor" href="#mail_template_admin">#</a> MAIL_TEMPLATE_ADMIN</h4><p>变量实现：</p><figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">border-top</span><span class="token punctuation">:</span>2px solid #12ADDB<span class="token punctuation">;</span><span class="token property">box-shadow</span><span class="token punctuation">:</span>0 1px 3px #AAAAAA<span class="token punctuation">;</span><span class="token property">line-height</span><span class="token punctuation">:</span>180%<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span>0 15px 12px<span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span>50px auto<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span>12px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">border-bottom</span><span class="token punctuation">:</span>1px solid #DDD<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span>14px<span class="token punctuation">;</span><span class="token property">font-weight</span><span class="token punctuation">:</span>normal<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span>13px 0 10px 8px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>您在<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span> #12ADDB<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;SITE_URL&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>$&#123;SITE_NAME&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>上的文章有了新的评论<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">></span></span>$&#123;NICK&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">></span></span>回复说：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">background-color</span><span class="token punctuation">:</span> #f5f5f5<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span> 10px 15px<span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span>18px 0<span class="token punctuation">;</span><span class="token property">word-wrap</span><span class="token punctuation">:</span>break-word<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span> $&#123;COMMENT&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>您可以点击<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span>#12addb</span><span class="token punctuation">"</span></span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;POST_URL&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>查看回复的完整內容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h3 id="访问域名设置"><a class="anchor" href="#访问域名设置">#</a> 访问域名设置</h3><p>在配置环境变量的下方，有以下两个的配置：</p><ul><li><p>使用共享域名（目前国际版需要自定义域名才运作）</p><p>这里可以自己定义，使用一个容易记忆的名称即可。在填写 <code>ADMIN_URL</code> 时，需要注意在域名前添加 <code>stg</code> 前缀。例如，我自己定义的名称为 <code>xxxblog</code> ，此时完整的域名包含了固定的后缀 <code>.avosapps.us</code> ，即完整的域名是 <code>https://xxxblog.avosapps.us</code> 。而 <code>ADMIN_URL</code> 中需要填写 <code>https://stg-xxxblog.avosapps.us</code> 。</p></li><li><p>自定义域名</p><p>该域名需要二级域名，然后按正常的配置 DNS 解析，等通过就行了；如果绑定了域名，那么在变量中的 <code>ADMIN_URL</code> 则填写该域名。</p></li></ul><h3 id="管理后台"><a class="anchor" href="#管理后台">#</a> 管理后台</h3><p>当部署完成后，首先需要设置管理员信息。访问管理员注册页面 <code>https://云引擎域名/sign-up</code> ，注册管理员登录信息，如：<span class="exturl" data-url="aHR0cHM6Ly94eHguZXhhbXBsZS5jb20vL3NpZ24tdXA=">https://xxx.example.com//sign-up</span> 。</p><h3 id="解决跨域问题"><a class="anchor" href="#解决跨域问题">#</a> 解决跨域问题</h3><p>在非国际版中，他们的 API 链接是会自动检测的；但当你使用的是国际版，它并不会自动检测。并且由于 <span class="exturl" data-url="aHR0cDovL3VzLmF2b3NjbG91ZC5jb20=">us.avoscloud.com</span> 这个域名被弃用了，因而会发生报错提示遇到跨域访问的问题。</p><p>解决方法：</p><ol><li>前往 <span class="exturl" data-url="aHR0cHM6Ly9jb25zb2xlLmxlYW5jbG91ZC5hcHAv">https://console.leancloud.app/</span></li><li>选择并点击你的应用</li><li>前往 <code>设置</code> &gt; <code>应用凭证</code></li><li>然后你会看到一个 <code>REST API 服务器地址</code> 把那个链接复制起来</li><li>最后把它放入配置档案 <code>valine</code> 的 <code>serverURLs</code><br><code>serverURLs</code> 通常是这样的 <code>https://[appId 前八位].api.lncldglobal.com</code> ；或者对其进行域名绑定： <code>设置</code> -&gt; <code>域名绑定</code> -&gt; <code>API 访问域名</code> -&gt; <code>绑定新域名</code> ，然后使用该域名配置到 <code>serverURLs</code> 中。</li></ol><p>最后提醒：</p><p>请确保你的 <code>appKey</code> 和 <code>appId</code> 是正确的，这样你的评论功能就能正常使用了。</p><h3 id="定时唤醒"><a class="anchor" href="#定时唤醒">#</a> 定时唤醒</h3><p>关于自动休眠的官方说法：<span class="exturl" data-url="aHR0cHM6Ly9sZWFuY2xvdWQuY24vZG9jcy9sZWFuZW5naW5lX3BsYW4uaHRtbCNoYXNoNjMzMzE1MTM0">点击查看</span>。由于目前 leancloud 发布了 [<span class="exturl" data-url="aHR0cHM6Ly9mb3J1bS5sZWFuY2xvdWQuY24vdC90b3BpYy8yMjU5NQ==">关于对体验版云引擎定时任务进行适当流控的说明</span>](<span class="exturl" data-url="aHR0cHM6Ly9mb3J1bS5sZWFuY2xvdWQuY24vdC90b3BpYy8yMjU5NQ==">https://forum.leancloud.cn/t/topic/22595</span>) 一则文章，导致 leancloud 的定时任务使用需要升级至标准版云引擎才能避免休眠；因此，在这里放弃 leancloud 的定时任务，利用 github actions 中的 workflow 定时执行命令访问 leancloud 的 web 域名，即可解决 leancloud 平台因为流控原因无法激活定时唤醒任务的问题：</p><ol><li><p>主分支上创建 github actions 的 workflow 任务。</p></li><li><p>在 <code>xxx.yml</code> 文件中修改如下代码：</p><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">'wake comment system'</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">on</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">push</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">schedule</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">-</span> <span class="token key atrule">cron</span><span class="token punctuation">:</span> <span class="token string">'7,33,53 0-15,23 * * *'</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token key atrule">jobs</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token key atrule">bot</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest</pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token key atrule">steps</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> curl <span class="token punctuation">-</span>sLo /dev/null $&lt;<span class="token tag">!--swig</span>￼3<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">></span></pre></td></tr></table></figure></li><li><p>添加私钥 <code>DOMAIN</code> （域名）：</p><p><code>仓库</code> -&gt; <code>settings</code> -&gt; <code>Secrets and variabled</code> -&gt; <code>Actions</code> -&gt; <code>New repository secret</code></p><ul><li>Name：DOMAIN</li><li>Value：你的 web 域名</li></ul></li></ol><h2 id="评价头像"><a class="anchor" href="#评价头像">#</a> 评价头像</h2><p></p><div class="links"><div class="item" title="Gravatar 官网" style="--block-color:#0A76B7"><span class="exturl image" data-url="aHR0cHM6Ly9jbi5ncmF2YXRhci5jb20v" data-background-image="https://upload.wikimedia.org/wikipedia/commons/5/5f/Gravatar-default-logo.jpg"></span><div class="info"><span class="exturl title" data-url="aHR0cHM6Ly9jbi5ncmF2YXRhci5jb20v">Gravatar 官网</span><p class="desc">Gravatar官方地址</p></div></div></div><p></p><ol><li><p>注册：进入 Gravatar 网站，点击左上角菜单里的 Sign In 进行登录 / 注册。</p></li><li><p>绑定邮箱及头像：点击 My Gravatar -&gt; <span class="exturl" data-url="aHR0cHM6Ly9lbi5ncmF2YXRhci5jb20vZW1haWxzL25ldw==">Add email address</span> -&gt; <span class="exturl" data-url="aHR0cHM6Ly9lbi5ncmF2YXRhci5jb20vZ3JhdmF0YXJzL25ldw==">Add a new image</span></p></li><li><p>点击 <code>View rating</code> 可查看邮箱的 <code>hash</code> 码。hash 码可填入 shoka 主题的 <code>_config.yml</code> 文件中的 <code>valine.tagMember</code> 其中一处（评论区对应显示的 tag 标签）。配置好后，有缓冲时间，最慢有 7 天缓冲时间。</p></li></ol><h1 id="字数及阅读时间统计"><a class="anchor" href="#字数及阅读时间统计">#</a> 字数及阅读时间统计</h1><p><strong>需要安装 <code>hexo-symbols-count-time</code> 插件。</strong></p><p>安装后不需要修改站点配置文件，直接使用插件默认配置就行，如需进行配置，可参考：</p><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># hexo-symbols-count-time</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">## shoka 主题默认采取了默认的配置，所以覆盖相应配置就行了</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">symbols_count_time</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">symbols</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token key atrule">time</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token key atrule">total_symbols</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token key atrule">total_time</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token key atrule">exclude_codeblock</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token key atrule">awl</span><span class="token punctuation">:</span> <span class="token number">4</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token key atrule">wpm</span><span class="token punctuation">:</span> <span class="token number">245</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token key atrule">suffix</span><span class="token punctuation">:</span> <span class="token string">"mins."</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">#exclude_codeblock: 是否排除代码块区域的字数统计</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">#awl: 平均字符长度 (多少符字算一个中文或英文) 中文约是 2，英文约是 5，其他约是 6</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">#wpm: 每分钟阅读字数  正常值约为 275 字，较小值约为 200 字，较快值约 350 字</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">#suffix: 当总字数小于每分钟阅读字数时，默认采取的时间类型，不填写默认类型采取 "mins."</span></pre></td></tr></table></figure><p>启用则需要找到 <code>footer</code> 和 <code>post</code> 的两处 <code>count</code> ，修改为 <code>true</code> ：</p><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 页尾全站统计</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">footer</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">since</span><span class="token punctuation">:</span> <span class="token number">2010</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">count</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 文章界面统计</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token key atrule">post</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token key atrule">count</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr></table></figure><h1 id="访问及阅读统计"><a class="anchor" href="#访问及阅读统计">#</a> 访问及阅读统计</h1><p>LeanCloud 评价里面是有阅读访问统计，但是，目前由于 LeanCloud 国际版不对国内用户提供服务了，因此改用其它记录统计，这里可以使用简单的<span class="exturl" data-url="aHR0cDovL2J1c3VhbnppLmlicnVjZS5pbmZvLw==">不蒜子</span>计数，操作更改也比较简单： <strong>引脚本 + 写标签</strong></p><p>1、调用不蒜子的官方脚本，这个比较简单，在你需要的地方调用如下代码</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre># 引脚本</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">&lt;</span>script <span class="token keyword">async</span> src<span class="token operator">=</span><span class="token string">"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre># 写标签</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">&lt;</span>span id<span class="token operator">=</span><span class="token string">"busuanzi_value_page_pv"</span><span class="token operator">></span> # 当前访问页面次数</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">&lt;</span>span id<span class="token operator">=</span><span class="token string">"busuanzi_container_site_uv"</span><span class="token operator">></span> # 站点访客次数</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">&lt;</span>span id<span class="token operator">=</span><span class="token string">"busuanzi_container_site_pv"</span><span class="token operator">></span> # 站点访问总量</pre></td></tr></table></figure><p>2、静态部署调用，这个需要在 <code>&lt;root&gt;/source/js</code> 路径下创建 <code>busuanzi.pure.min.js</code> 文件，如果 <code>js</code> 目录不存在则自己新建，并且把如下代码添加进去，并保存：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">var</span> bszCaller<span class="token punctuation">,</span>bszTag<span class="token punctuation">;</span><span class="token operator">!</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>e<span class="token punctuation">,</span>a<span class="token operator">=</span><span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">,</span>b<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function-variable function">ready</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> a<span class="token operator">||</span><span class="token string">"interactive"</span><span class="token operator">===</span>document<span class="token punctuation">.</span>readyState<span class="token operator">||</span><span class="token string">"complete"</span><span class="token operator">===</span>document<span class="token punctuation">.</span>readyState<span class="token operator">?</span><span class="token function">c</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token operator">:</span>b<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token function">c</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token function-variable function">d</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> a<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>c<span class="token operator">=</span>b<span class="token punctuation">.</span>length<span class="token punctuation">;</span>c<span class="token operator">></span>a<span class="token punctuation">;</span>a<span class="token operator">++</span><span class="token punctuation">)</span>b<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">;</span>b<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token function-variable function">e</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>a<span class="token operator">||</span><span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token function">d</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">,</span>document<span class="token punctuation">.</span>removeEventListener<span class="token operator">?</span>document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"DOMContentLoaded"</span><span class="token punctuation">,</span>e<span class="token punctuation">,</span><span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span>document<span class="token punctuation">.</span>attachEvent<span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">detachEvent</span><span class="token punctuation">(</span><span class="token string">"onreadystatechange"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>window<span class="token operator">==</span>window<span class="token punctuation">.</span>top<span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span><span class="token function">clearInterval</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span>c<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>document<span class="token punctuation">.</span>addEventListener<span class="token operator">?</span>document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"DOMContentLoaded"</span><span class="token punctuation">,</span>e<span class="token punctuation">,</span><span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span>document<span class="token punctuation">.</span>attachEvent<span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">"onreadystatechange"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">loaded|complete</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>window<span class="token operator">==</span>window<span class="token punctuation">.</span>top<span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>c<span class="token operator">=</span><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">try</span><span class="token punctuation">&#123;</span>a<span class="token operator">||</span>document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span><span class="token function">doScroll</span><span class="token punctuation">(</span><span class="token string">"left"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bszCaller<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token function-variable function">fetch</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> c<span class="token operator">=</span><span class="token string">"BusuanziCallback_"</span><span class="token operator">+</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token number">1099511627776</span><span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>window<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">evalCall</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span>a<span class="token operator">=</span>a<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"=BusuanziCallback"</span><span class="token punctuation">,</span><span class="token string">"="</span><span class="token operator">+</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span>scriptTag<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"SCRIPT"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>scriptTag<span class="token punctuation">.</span>type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token punctuation">,</span>scriptTag<span class="token punctuation">.</span>defer<span class="token operator">=</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>scriptTag<span class="token punctuation">.</span>src<span class="token operator">=</span>a<span class="token punctuation">,</span>scriptTag<span class="token punctuation">.</span>referrerPolicy<span class="token operator">=</span><span class="token string">"no-referrer-when-downgrade"</span><span class="token punctuation">,</span>document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"HEAD"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>scriptTag<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token function-variable function">evalCall</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">try</span><span class="token punctuation">&#123;</span><span class="token function">a</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span>scriptTag<span class="token punctuation">.</span>parentElement<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>scriptTag<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>bszTag<span class="token punctuation">.</span><span class="token function">hides</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>bszCaller<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"//busuanzi.ibruce.info/busuanzi?jsonpCallback=BusuanziCallback"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>bszTag<span class="token punctuation">.</span><span class="token function">texts</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span>bszTag<span class="token punctuation">.</span><span class="token function">shows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bszTag<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token literal-property property">bszs</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"site_pv"</span><span class="token punctuation">,</span><span class="token string">"page_pv"</span><span class="token punctuation">,</span><span class="token string">"site_uv"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function-variable function">texts</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>bszs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> c<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"busuanzi_value_"</span><span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>innerHTML<span class="token operator">=</span>a<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token function-variable function">hides</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>bszs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> b<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"busuanzi_container_"</span><span class="token operator">+</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>b<span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display<span class="token operator">=</span><span class="token string">"none"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token function-variable function">shows</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>bszs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> b<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"busuanzi_container_"</span><span class="token operator">+</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>b<span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display<span class="token operator">=</span><span class="token string">"inline"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>然后更改上面第一条代码的引用路径为本地路径，例如： <code>&lt;script async src=&quot;https://xxx.example.com/js/busuanzi.pure.min.js&quot;&gt;&lt;/script&gt;</code> ， <code>xxx.example.com</code> 为你的部署网站。后面三行的代码的 <code>&lt;span id=&quot;xxx&quot;&gt;</code> 不用变动，只需在合适的地方调用想用的计数代码即可。</p><p>3、举个例子，替换 shoka 主题原有的页面访问计数。在 <code>&lt;root&gt;/themes/shoka/layout/_partials/post/footer.njk</code> 文件中，添加并替换即可。如下图：</p><p><img data-src="image-20221115121446459.png" alt="image-20221115121446459"></p><h1 id="rss订阅"><a class="anchor" href="#rss订阅">#</a> RSS 订阅</h1><p><strong>需要安装 <code>hexo-generator-feed</code> 插件。</strong></p><p>安装完成后，需要在 <code>&lt;root&gt;/_config.yml</code> 配置中添加如下信息，并填写自己需要的信息：</p><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">feed</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">type</span><span class="token punctuation">:</span> atom</pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">path</span><span class="token punctuation">:</span> atom.xml</pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token key atrule">limit</span><span class="token punctuation">:</span> <span class="token number">20</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token key atrule">hub</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token key atrule">content</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token key atrule">content_limit</span><span class="token punctuation">:</span> <span class="token number">140</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token key atrule">content_limit_delim</span><span class="token punctuation">:</span> <span class="token string">' '</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token key atrule">order_by</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>date</pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token key atrule">icon</span><span class="token punctuation">:</span> icon.png</pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token key atrule">autodiscovery</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  template<span class="token punctuation">:</span></pre></td></tr></table></figure><p>具体内容可参看：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvLWdlbmVyYXRvci1mZWVk">https://github.com/hexojs/hexo-generator-feed</span></p><p>当然，如果有能力的，可以自建 rss 模板，shoka 主题上也有提供，只需要如下调用模板即可：</p><p><img data-src="image-20221115164425176.png" alt="image-20221115164425176"></p><p>最后，在需要获取 RSS 链接的地方添加 <code>/atom.xml</code> 即可。</p><h1 id="站点运行时间"><a class="anchor" href="#站点运行时间">#</a> 站点运行时间</h1><p>在配置站点页脚的 <code>&lt;root&gt;/themes/shoka/layout/_partials/footer.njk</code> 文件上，选择合适的地方添加如下代码：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>swig￼<span class="token number">5</span><span class="token operator">--</span><span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"create_time"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token operator">&lt;</span>span id<span class="token operator">=</span><span class="token string">"timeDate"</span><span class="token operator">></span>加载日期<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token operator">&lt;</span>span id<span class="token operator">=</span><span class="token string">"times"</span><span class="token operator">></span>加载时间<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token operator">&lt;</span>script<span class="token operator">></span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token keyword">var</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token keyword">function</span> <span class="token function">createtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">var</span> grt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        now<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        days <span class="token operator">=</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> grt<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">24</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        dnum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>days<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        hours <span class="token operator">=</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> grt<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> dnum<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        hnum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>hours<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>hnum<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>          hnum <span class="token operator">=</span> <span class="token string">"0"</span> <span class="token operator">+</span> hnum<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        minutes <span class="token operator">=</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> grt<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> dnum<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> hnum<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        mnum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>minutes<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>mnum<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>          mnum <span class="token operator">=</span> <span class="token string">"0"</span> <span class="token operator">+</span> mnum<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        seconds <span class="token operator">=</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> grt<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> dnum<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> hnum<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> mnum<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        snum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>seconds<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>snum<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>          snum <span class="token operator">=</span> <span class="token string">"0"</span> <span class="token operator">+</span> snum<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"timeDate"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">" 本站存活 "</span> <span class="token operator">+</span> dnum <span class="token operator">+</span> <span class="token string">" 天 "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"times"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> hnum <span class="token operator">+</span> <span class="token string">" 小时 "</span> <span class="token operator">+</span> mnum <span class="token operator">+</span> <span class="token string">" 分 "</span> <span class="token operator">+</span> snum <span class="token operator">+</span> <span class="token string">" 秒"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>      <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token string">"createtime()"</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>swig￼<span class="token number">7</span><span class="token operator">--</span><span class="token operator">></span></pre></td></tr></table></figure><p>再在主题配置文件 <code>&lt;root&gt;/themes/shoka/_config.yml</code> 中添加：</p><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># Runing Time</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">running_time</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">create_time</span><span class="token punctuation">:</span> <span class="token string">"01/01/1945 19:00:00"</span> <span class="token comment">#此处修改你的建站时间或者网站上线时间</span></pre></td></tr></table></figure><h1 id="seo-优化及站点收录"><a class="anchor" href="#seo-优化及站点收录">#</a> SEO 优化及站点收录</h1><p>辛辛苦苦搭好网站，当然是想跟其他人一起分享博文啦；但是，对于个人博客，如果没有被搜索引擎收录的话，别人在搜索引擎基本上是看不到的。那么如何查看个人博客网站是否被收录？只需要在对应的搜索引擎搜索框上输入：</p><figure class="highlight http"><figcaption data-lang="HTTP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token header"><span class="token header-name keyword">site</span><span class="token punctuation">:</span><span class="token header-value">your_website</span></span></pre></td></tr></table></figure><p>eg:</p><p><img data-src="image-20221126231952585.png" alt="image-20221126231952585"></p><h2 id="google收录"><a class="anchor" href="#google收录">#</a> Google 收录</h2><p>谷歌收录相对简单，只需要准备一个谷歌账号，然后访问 <span class="exturl" data-url="aHR0cHM6Ly9zZWFyY2guZ29vZ2xlLmNvbS9zZWFyY2gtY29uc29sZS93ZWxjb21l">Google Search Console</span> 如下图：</p><p><img data-src="image-20221126232456573.png" alt="image-20221126232456573"></p><p>先登录账号，然后再输入个人博客网站域名。然后弹出验证网站所有权窗口，这里一般选择 <code>CNAME验证</code> ，接着根据提示操作即可，这里就不贴图，并且在你的网站管理那里添加给出来的 DNS 解析；最后等 DNS 更改生效，验证通过即可。完成后进入配置，添加站点地图链接，可能添加完后刷新会显示 <code>无法获取</code> 的状态，但其实是已经配置完成了。</p><h2 id="bing收录"><a class="anchor" href="#bing收录">#</a> Bing 收录</h2><p>进入 <span class="exturl" data-url="aHR0cHM6Ly93d3cuYmluZy5jb20vd2VibWFzdGVycy9hYm91dA==">Bing Webmaster Tools</span> ，这个可以选择使用 GSC 导入网站，只需要授权一下即可；或者手动添加通过 <code>CNAME验证</code> 添加，如下图：</p><p><img data-src="image-20221126234903144.png" alt="image-20221126234903144"></p><p>通过后，同样的添加站点地图链接。</p><h2 id="baidu收录"><a class="anchor" href="#baidu收录">#</a> Baidu 收录</h2><p>访问 <span class="exturl" data-url="aHR0cHM6Ly96aXl1YW4uYmFpZHUuY29tLw==">百度搜索资源平台</span> ，点击 <code>用户中心</code> -&gt; <code>站点管理</code> ，然后添加网站，一路到验证通过，这里同样的使用 <code>CNAME验证</code> 即可，当然选择其他的也行，哪种方便用哪种：</p><p><img data-src="image-20221127000022983.png" alt="image-20221127000022983"></p><p>验证完毕后，找到 <code>普通收录</code> ，选择 <code>sitemap</code> ，接着添加站点地图链接：</p><p><img data-src="image-20221127000321081.png" alt="image-20221127000321081"></p><h1 id="看板卡通模型"><a class="anchor" href="#看板卡通模型">#</a> 看板卡通模型</h1><p>这里使用 <code>live2d模块</code> ，比较简单。</p><p>安装插件 <code>npm install --save hexo-helper-live2d</code> ，选则安装所需的卡通模型：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hpYXpleXUvbGl2ZTJkLXdpZGdldC1tb2RlbHM=">https://github.com/xiazeyu/live2d-widget-models</span> ，例如，安装名为 <strong>unitychan</strong> 的模型：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span> live2d-widget-model-unitychan</pre></td></tr></table></figure><p>配置插件，在 <code>&lt;root&gt;/_config.yml</code> 中添加及更改如下信息：</p><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">live2d</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">scriptFrom</span><span class="token punctuation">:</span> local <span class="token comment"># 默认</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">pluginRootPath</span><span class="token punctuation">:</span> live2dw/ <span class="token comment"># 插件在站点上的根目录 (相对路径)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token key atrule">pluginJsPath</span><span class="token punctuation">:</span> lib/ <span class="token comment"># 脚本文件相对与插件根目录路径</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token key atrule">pluginModelPath</span><span class="token punctuation">:</span> assets/ <span class="token comment"># 模型文件相对与插件根目录路径</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token key atrule">tagMode</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 标签模式，是否仅替换 live2d tag 标签而非插入到所有页面中</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token key atrule">debug</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 调试，是否在控制台输出日志</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token key atrule">model</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token key atrule">use</span><span class="token punctuation">:</span> live2d<span class="token punctuation">-</span>widget<span class="token punctuation">-</span>model<span class="token punctuation">-</span>unitychan</pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token key atrule">display</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token key atrule">position</span><span class="token punctuation">:</span> right <span class="token comment">#动画位置</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token key atrule">width</span><span class="token punctuation">:</span> <span class="token number">210</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token key atrule">height</span><span class="token punctuation">:</span> <span class="token number">380</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment"># 位置配置，这个在左侧边栏位置很居中</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token key atrule">hOffset</span><span class="token punctuation">:</span> <span class="token number">50</span>  <span class="token comment"># 调节水平位置</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token key atrule">vOffset</span><span class="token punctuation">:</span> <span class="token number">-25</span>  <span class="token comment"># 调节垂直位置</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token key atrule">mobile</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token key atrule">show</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 是否在移动设备上显示</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token key atrule">scale</span><span class="token punctuation">:</span> <span class="token number">0.5</span> <span class="token comment"># 移动设备上的缩放</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token key atrule">react</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token key atrule">opacityDefault</span><span class="token punctuation">:</span> <span class="token number">0.7</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token key atrule">opacityOnHover</span><span class="token punctuation">:</span> <span class="token number">0.8</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/hexo/" rel="tag"><i class="ic i-tag"></i> hexo</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-06-01 01:34:11" itemprop="dateModified" datetime="2024-06-01T01:34:11+08:00">2024-06-01</time></span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="shoka-function-expansion/" class="item leancloud_visitors" data-flag-title="博客搭建笔记之功能扩展" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span id="busuanzi_value_page_pv"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 投喂</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.webp" alt="夏沫の浅雨 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.webp" alt="夏沫の浅雨 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>夏沫の浅雨 <i class="ic i-at"><em>@</em></i>命运转轮</li><li class="link"><strong>本文链接：</strong> <a href="https://arachnid.cc/shoka-function-expansion/" title="博客搭建笔记之功能扩展">https://arachnid.cc/shoka-function-expansion/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/shoka-config/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;arachnid.cc&#x2F;picture&#x2F;(30).webp" title="博客搭建笔记之 shoka 配置"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Hexo-shoka</span><h3>博客搭建笔记之 shoka 配置</h3></a></div><div class="item right"><a href="/vscode-config/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;arachnid.cc&#x2F;picture&#x2F;(17).webp" title="vscode 常用配置"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>vscode 常用配置</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD"><span class="toc-number">1.</span> <span class="toc-text">搜索功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#algolia%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD"><span class="toc-number">1.1.</span> <span class="toc-text">algolia 搜索功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD"><span class="toc-number">1.2.</span> <span class="toc-text">本地搜索功能</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#valine-%E8%AF%84%E4%BB%B7%E5%8A%9F%E8%83%BD"><span class="toc-number">2.</span> <span class="toc-text">valine 评价功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#leancloud-%E9%85%8D%E7%BD%AE"><span class="toc-number">2.1.</span> <span class="toc-text">leancloud 配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#valine-admin-%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.</span> <span class="toc-text">Valine Admin 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">2.2.1.</span> <span class="toc-text">自定义环境变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mail_template"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">MAIL_TEMPLATE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mail_template_admin"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">MAIL_TEMPLATE_ADMIN</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%9F%9F%E5%90%8D%E8%AE%BE%E7%BD%AE"><span class="toc-number">2.2.2.</span> <span class="toc-text">访问域名设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0"><span class="toc-number">2.2.3.</span> <span class="toc-text">管理后台</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-number">2.2.4.</span> <span class="toc-text">解决跨域问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E5%94%A4%E9%86%92"><span class="toc-number">2.2.5.</span> <span class="toc-text">定时唤醒</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%84%E4%BB%B7%E5%A4%B4%E5%83%8F"><span class="toc-number">2.3.</span> <span class="toc-text">评价头像</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E6%95%B0%E5%8F%8A%E9%98%85%E8%AF%BB%E6%97%B6%E9%97%B4%E7%BB%9F%E8%AE%A1"><span class="toc-number">3.</span> <span class="toc-text">字数及阅读时间统计</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%8F%8A%E9%98%85%E8%AF%BB%E7%BB%9F%E8%AE%A1"><span class="toc-number">4.</span> <span class="toc-text">访问及阅读统计</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rss%E8%AE%A2%E9%98%85"><span class="toc-number">5.</span> <span class="toc-text">RSS 订阅</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AB%99%E7%82%B9%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4"><span class="toc-number">6.</span> <span class="toc-text">站点运行时间</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#seo-%E4%BC%98%E5%8C%96%E5%8F%8A%E7%AB%99%E7%82%B9%E6%94%B6%E5%BD%95"><span class="toc-number">7.</span> <span class="toc-text">SEO 优化及站点收录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#google%E6%94%B6%E5%BD%95"><span class="toc-number">7.1.</span> <span class="toc-text">Google 收录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bing%E6%94%B6%E5%BD%95"><span class="toc-number">7.2.</span> <span class="toc-text">Bing 收录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#baidu%E6%94%B6%E5%BD%95"><span class="toc-number">7.3.</span> <span class="toc-text">Baidu 收录</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9C%8B%E6%9D%BF%E5%8D%A1%E9%80%9A%E6%A8%A1%E5%9E%8B"><span class="toc-number">8.</span> <span class="toc-text">看板卡通模型</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/hexo-shoka-create/" rel="bookmark" title="博客搭建笔记之 Hexo-shoka">博客搭建笔记之 Hexo-shoka</a></li><li><a href="/shoka-config/" rel="bookmark" title="博客搭建笔记之 shoka 配置">博客搭建笔记之 shoka 配置</a></li><li class="active"><a href="/shoka-function-expansion/" rel="bookmark" title="博客搭建笔记之功能扩展">博客搭建笔记之功能扩展</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="夏沫の浅雨" data-src="/images/avatar.webp"><p class="name" itemprop="name">夏沫の浅雨</p><div class="description" itemprop="description">不曾亏欠，不曾辜负，如此足矣</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">98</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">6</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">26</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FyYWNobmlkLTk3" title="https:&#x2F;&#x2F;github.com&#x2F;Arachnid-97"><i class="ic i-github"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMjM2MTA4MzU=" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;23610835"><i class="ic i-bilibili"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友人帐</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-info-circle"></i>关于</a></li><li class="item"><a href="/atom.xml" rel="section"><i class="ic i-rss"></i>RSS</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/shoka-config/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/vscode-config/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/NAS/" title="分类于 NAS">NAS</a></div><span><a href="/omv6-install" title="debian 11 桌面安装 OMV 6">debian 11 桌面安装 OMV 6<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/net-tools-vs-proute2" title="Linux 网络管理套件">Linux 网络管理套件<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/kicad-summary" title="Kicad 应用总结">Kicad 应用总结<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/arch-linux-install" title="基于官方指导安装 Arch Linux">基于官方指导安装 Arch Linux<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/gdb-debuging" title="GDB 调试器 + VSCode 开发">GDB 调试器 + VSCode 开发<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/NAS/" title="分类于 NAS">NAS</a></div><span><a href="/nginx-uses-anti-proxy-and-ssl" title="Nginx 反代理并安装 SSL">Nginx 反代理并安装 SSL<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a></div><span><a href="/md5-algorithm" title="MD5 算法">MD5 算法<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/summary-of-keil-tool-use" title="关于 Keil 的一些总结性使用">关于 Keil 的一些总结性使用<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/linux-rootfs-create" title="Linux 根文件系统的构建">Linux 根文件系统的构建<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/makefile-summarize" title="来学点 Makefile">来学点 Makefile<i class="ic i-link-alt"></i></a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">夏沫の浅雨 @ Arachnid's blog</span></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="count"><span class="icon"><i class="ic i-person"></i> <span id="busuanzi_value_site_uv"></span>人 <span class="post-meta-divider">|</span> <span class="icon"><i class="ic i-eye"></i> <span id="busuanzi_value_site_pv"></span>次 <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">692k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">11:46</span></span></span></div><div class="create_time"><span class="icon"><i class="ic i-clock"></i> <span id="timeDate">正在加载</span> <span id="times">...</span><script>function createtime(){var n=new Date("04/28/2022 15:45:50");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML=" 本站存活 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}var now=new Date;setInterval("createtime()",250)</script></span></div><div class="powered-by">Powered-by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"shoka-function-expansion/",favicon:{show:"ψ(｀∇´)ψ 欢迎回来!",hide:"《原子弹入门及制造》"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,mermaid:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',isOutdated:!0,format_year_as_prefix:"{{year}}年",format_month_as_prefix:"{{month}}个月",format_month_as_suffix:"零{{month}}个月",format_day_as_prefix:"{{day}}天",format_day_as_suffix:"零{{day}}天",template:"<div class='note warning'><p><span class='label primary'><strong>文章时效性提示</strong></span><br>这是一篇发布于 <span class='pink'>{{publish}}</span> 前，最后一次更新距今已经 <span class='pink'>{{updated}}</span> 的文章，部分内容可能已经过时，请注意甄别。</p></div>",ignores:[function(a){return a.includes("#")},function(a){return new RegExp(LOCAL.path+"$").test(a)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="/js/combined-file.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->