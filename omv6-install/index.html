<!-- build time:Sat Aug 31 2024 11:50:55 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="命运转轮" href="https://arachnid.cc/rss.xml"><link rel="alternate" type="application/atom+xml" title="命运转轮" href="https://arachnid.cc/atom.xml"><link rel="alternate" type="application/json" title="命运转轮" href="https://arachnid.cc/feed.json"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Linux"><link rel="canonical" href="https://arachnid.cc/omv6-install/"><title>debian 11 桌面安装 OMV 6 | Arachnid's blog = 命运转轮 = Life is ...the time you did something you're afraid of doing</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="loader-state"><svg viewBox="0 0 178 40" width="178" height="40"><path class="air" d="M 46 16.5 h -20 a 8 8 0 0 1 0 -16" fill="none" stroke="#E85725" stroke-width="1" stroke-linejoin="round" stroke-linecap="round"></path><g id="car"><svg viewBox="0 0 118 28.125" x="30" y="11.725" width="118" height="28.125"><defs><circle id="circle" cx="0" cy="0" r="1"></circle><g id="wheel"><use href="#circle" fill="#1E191A" transform="scale(10)"></use><use href="#circle" fill="#fff" transform="scale(5)"></use><path fill="#1E191A" stroke="#1E191A" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" opacity="0.2" stroke-dashoffset="0" d="M -3.5 0 a 4 4 0 0 1 7 0 a 3.5 3.5 0 0 0 -7 0"></path><use href="#circle" fill="#1E191A" transform="scale(1.5)"></use><path fill="none" stroke="#F9B35C" stroke-width="0.75" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="20 14 8 5" d="M 0 -7.5 a 7.5 7.5 0 0 1 0 15 a 7.5 7.5 0 0 1 0 -15"></path><path fill="none" stroke="#fff" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" opacity="0.1" stroke-dashoffset="0" d="M -6.5 -6.25 a 10 10 0 0 1 13 0 a 9 9 0 0 0 -13 0"></path></g></defs><g transform="translate(51.5 11.125)"><path stroke-width="2" stroke="#1E191A" fill="#EF3F33" d="M 0 0 v -2 a 4.5 4.5 0 0 1 9 0 v 2"></path><rect fill="#1E191A" x="3.25" y="-3" width="5" height="3"></rect></g><g transform="translate(10 24.125)"><g transform="translate(59 0)"><path id="shadow" opacity="0.7" fill="#1E191A" d="M -64 0 l -4 4 h 9 l 8 -1.5 h 100 l -3.5 -2.5"></path></g><path fill="#fff" stroke="#1E191A" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" d="M 0 0 v -10 l 35 -13 v 5 l 4 0.5 l 0.5 4.5 h 35.5 l 30 13"></path><g fill="#fff" stroke="#1E191A" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round"><path d="M -6 0 v -22 h 10 z"></path><path d="M 105 0 h -3 l -12 -5.2 v 6.2 h 12"></path></g><g fill="#949699" opacity="0.7"><rect x="16" y="-6" width="55" height="6"></rect><path d="M 24 -14 l 13 -1.85 v 1.85"></path></g><g fill="none" stroke="#1E191A" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round"><path stroke-dasharray="30 7 42" d="M 90 0 h -78"></path><path d="M 39.5 -13 h -15"></path></g><path fill="#fff" stroke="#1E191A" stroke-width="2.25" stroke-linejoin="round" d="M 48.125 -6 h -29 v 6 h 29"></path><rect x="48" y="-7.125" width="6.125" height="7.125" fill="#1E191A"></rect><g fill="#1E191A"><rect x="60" y="-15" width="1" height="6"></rect><rect x="56.5" y="-17.5" width="6" height="2.5"></rect></g></g><g class="wheels" transform="translate(0 18.125)"><g transform="translate(10 0)"><use href="#wheel"></use></g><g transform="translate(87 0)"><use href="#wheel" stroke-dashoffset="-22"></use></g></g></svg></g><g fill="none" stroke-width="1" stroke-linejoin="round" stroke-linecap="round"><path class="air" stroke="#E85725" d="M 177.5 34 h -10 q -16 0 -32 -8"></path><path class="air" stroke="#949699" d="M 167 28.5 c -18 -2 -22 -8 -37 -10.75"></path><path class="air" stroke="#949699" d="M 153 20 q -4 -1.7 -8 -3"></path><path class="air" stroke="#E85725" d="M 117 16.85 c -12 0 -12 16 -24 16 h -8"></path><path class="air" stroke="#949699" d="M 65 12 q -5 3 -12 3.8"></path><path class="air" stroke="#949699" stroke-dasharray="9 10" d="M 30 13.5 h -2.5 q -5 0 -5 -5"></path><path class="air" stroke="#949699" d="M 31 33 h -10"></path><path class="air" stroke="#949699" d="M 29.5 23 h -12"></path><path class="air" stroke="#949699" d="M 13.5 23 h -6"></path><path class="air" stroke="#E85725" d="M 28 28 h -27.5"></path></g></svg></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline"><a href="/omv6-install" class="link external" itemprop="url">debian 11 桌面安装 OMV 6<i class="ic i-link-alt"></i></a></h1><div class="meta"><span class="item" title="创建时间：2024-01-13 21:04:04"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-01-13T21:04:04+08:00">2024-01-13</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>29k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>30 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Arachnid's blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://arachnid.cc/picture/(30).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(13).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(21).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(8).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(15).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(33).webp"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="cn"><link itemprop="mainEntityOfPage" href="https://arachnid.cc/omv6-install/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.webp"><meta itemprop="name" content="夏沫の浅雨"><meta itemprop="description" content="Life is ...the time you did something you're afraid of doing, 不曾亏欠，不曾辜负，如此足矣"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="命运转轮"></span><div class="body md" itemprop="articleBody"><h1 id="debian-安装"><a class="anchor" href="#debian-安装">#</a> Debian 安装</h1><p>需要注意的几个点是：</p><ol><li>安装语言的时候选择英文安装，否者会造成部分乱码，至于后面想要使用中文，安装完成后再配置就好了。</li><li>配置软件包不需要选择网络镜像，后期再配置镜像源。</li><li>勾选 ssh 服务，以方便远程操作；至于是否选择图形界面，随个人喜好。</li></ol><h2 id="基本配置"><a class="anchor" href="#基本配置">#</a> 基本配置</h2><h3 id="添加-sudo-管理组"><a class="anchor" href="#添加-sudo-管理组">#</a> 添加 sudo 管理组</h3><p><code>your_name is not in the sudoers file. This incident will be reported.</code></p><p>出现这种情况一般是你用普通用户键入 <code>sudo</code> 命令，但这个用户又没有加入 <code>sudo</code> 组上面，导致权限不够。</p><p>解决：</p><figure class="highlight bash"><figcaption data-lang="bash"><span>添加设置默认网关</span></figcaption><table><tr><td data-num="1"></td><td data-command="[your_name@localhost] $"></td><td><pre><span class="token function">su</span> -</pre></td></tr><tr><td data-num="2"></td><td data-command></td><td><pre>Password: </pre></td></tr><tr><td data-num="3"></td><td data-command="[root@localhost] $"></td><td><pre>visudo</pre></td></tr></table></figure><p>然后移动光标，添加 <code>your_name ALL=(ALL:ALL) ALL</code> 在 <code># User privilege specification</code> 下面，根据提示 <code>写入 ^O</code> ， <code>回车 Enter</code> 确认保存， <code>退出 ^X</code> ，得到：</p><figure class="highlight bash"><figcaption data-lang="bash"><span>添加设置默认网关</span></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">cat</span> /etc/sudoers</pre></td></tr><tr><td data-num="2"></td><td data-command></td><td><pre><span class="token punctuation">\</span>#</pre></td></tr><tr><td data-num="3"></td><td data-command></td><td><pre><span class="token punctuation">\</span># This <span class="token function">file</span> MUST be edited with the <span class="token string">'visudo'</span> <span class="token builtin class-name">command</span> as root.</pre></td></tr><tr><td data-num="4"></td><td data-command></td><td><pre><span class="token punctuation">\</span>#</pre></td></tr><tr><td data-num="5"></td><td data-command></td><td><pre><span class="token punctuation">\</span># Please consider adding <span class="token builtin class-name">local</span> content <span class="token keyword">in</span> /etc/sudoers.d/ instead of</pre></td></tr><tr><td data-num="6"></td><td data-command></td><td><pre><span class="token punctuation">\</span># directly modifying this file.</pre></td></tr><tr><td data-num="7"></td><td data-command></td><td><pre><span class="token punctuation">\</span>#</pre></td></tr><tr><td data-num="8"></td><td data-command></td><td><pre><span class="token punctuation">\</span># See the <span class="token function">man</span> page <span class="token keyword">for</span> details on how to <span class="token function">write</span> a sudoers file.</pre></td></tr><tr><td data-num="9"></td><td data-command></td><td><pre><span class="token punctuation">\</span>#</pre></td></tr><tr><td data-num="10"></td><td data-command></td><td><pre>Defaults	env_reset</pre></td></tr><tr><td data-num="11"></td><td data-command></td><td><pre>Defaults	mail_badpass</pre></td></tr><tr><td data-num="12"></td><td data-command></td><td><pre>Defaults	<span class="token assign-left variable">secure_path</span><span class="token operator">=</span><span class="token string">"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></pre></td></tr><tr><td data-num="13"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td data-command></td><td><pre><span class="token punctuation">\</span># Host <span class="token builtin class-name">alias</span> specification</pre></td></tr><tr><td data-num="15"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td data-command></td><td><pre><span class="token punctuation">\</span># User <span class="token builtin class-name">alias</span> specification</pre></td></tr><tr><td data-num="17"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td data-command></td><td><pre><span class="token punctuation">\</span># Cmnd <span class="token builtin class-name">alias</span> specification</pre></td></tr><tr><td data-num="19"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td data-command></td><td><pre><span class="token punctuation">\</span># User privilege specification</pre></td></tr><tr><td data-num="21"></td><td data-command></td><td><pre>root	<span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL:ALL<span class="token punctuation">)</span> ALL</pre></td></tr><tr><td data-num="22"></td><td data-command></td><td><pre>your_name	<span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL:ALL<span class="token punctuation">)</span> ALL</pre></td></tr><tr><td data-num="23"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td data-command></td><td><pre><span class="token punctuation">\</span># Allow members of group <span class="token function">sudo</span> to execute any <span class="token builtin class-name">command</span></pre></td></tr><tr><td data-num="25"></td><td data-command></td><td><pre>%sudo	 <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL:ALL<span class="token punctuation">)</span> ALL</pre></td></tr><tr><td data-num="26"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td data-command></td><td><pre><span class="token punctuation">\</span># See sudoers<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token function">more</span> information on <span class="token string">"@include"</span> directives:</pre></td></tr><tr><td data-num="28"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td data-command></td><td><pre>@includedir /etc/sudoers.d</pre></td></tr></table></figure><p>note：</p><p><code>su</code> 带有 <code>-</code> ，这和 <code>su</code> 是不同的，在用命令 <code>su</code> 的时候只是切换到 root，但没有把 root 的环境变量传过去，还是当前用户的环境变量，用 <code>su -</code> 命令会将环境变量也一起带过去，就像和 <code>root</code> 登录一样。关于 <code>su -</code> 的分析可参看：<span class="exturl" data-url="aHR0cHM6Ly9jbG91ZGJvb2wuY29tL2Rwa2ctcmVjb25maWd1cmUtYmFzaC1jb21tYW5kLW5vdC1mb3VuZC5odG1s">dpkg-reconfigure 命令找不到问题解决</span></p><h3 id="避免提示光盘安装软件包"><a class="anchor" href="#避免提示光盘安装软件包">#</a> 避免提示光盘安装软件包</h3><p><code>Media change: please insert the disc labeled 'Debian GNU/Linux xxx DVD' Media change: please insert the disc labeled.</code></p><p>在 Debian 系统中，如果您碰巧使用 DVD 安装，当你调用 <code>apt</code> 时，会抛出一个错误消息，表示存储库 cdrom 没有发布文件，并要求插入 Debian 光盘来离线安装软件包，这时候我们需要绕过去掉提示，以便使用网络安装。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> <span class="token function">nano</span> /etc/apt/sources.list</pre></td></tr></table></figure><p>得到：</p><figure class="highlight wiki"><figcaption data-lang="Wiki markup"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">#</span> deb cdrom:<span class="token url">[Debian GNU/Linux 11.8.0 _Bullseye_ - Official amd64 DVD Binary-1 20231007-14:05]</span>/ bullseye contrib main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>deb cdrom:<span class="token url">[Debian GNU/Linux 11.8.0 _Bullseye_ - Official amd64 DVD Binary-1 20231007-14:05]</span>/ bullseye contrib main</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">#</span> Line commented out by installer because it failed to verify:</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">#</span>deb http://security.debian.org/debian-security bullseye-security main contrib</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">#</span> Line commented out by installer because it failed to verify:</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">#</span>deb-src http://security.debian.org/debian-security bullseye-security main contrib</pre></td></tr></table></figure><p>可以看到，默认是先通过 <code>deb cdrom:...</code> 安装软件的。所以在前面加一个 <code>#</code> 把这行注释掉即可；最后 <code>写入 ^O</code> ， <code>回车 Enter</code> 确认保存， <code>退出 ^X</code> 。</p><h3 id="更换软件包镜像源"><a class="anchor" href="#更换软件包镜像源">#</a> 更换软件包镜像源</h3><p><code>E: Package 'xxx' has no installation candidate.</code></p><p>这种情况一般是软件包获取不到，可能是网络问题，也可能是因为源的问题，换个好一点的镜像源就行了。</p><p>例如：更换为 <span class="exturl" data-url="aHR0cHM6Ly9taXJyb3JzLnR1bmEudHNpbmdodWEuZWR1LmNuL2hlbHAvZGViaWFuLw==">清华源地址</span></p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> <span class="token function">cp</span> /etc/apt/sources.list /etc/apt/sources.list.back</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">sudo</span> <span class="token function">nano</span> /etc/apt/sources.list</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt</span> update</pre></td></tr></table></figure><p>note：</p><p>先找到镜像源文件并备份，然后使用 <code>nano</code> 编辑，把获取到的镜像源地址全部覆盖替换原有的文本，最后再执行 <code>apt update</code> 更新软件包，至此就可以安装原本装失败的软件了。如果用不习惯 <code>nano</code> 编辑器，可以安装 <code>vim</code> 。</p><h3 id="内核编译工具"><a class="anchor" href="#内核编译工具">#</a> 内核编译工具</h3><p><code>make[n]: *** /lib/modules/kernel_version-amd64/build: No such file or directory.</code></p><p>在编译部署内核模块的时候，如果报这个错误，是因为没有 <code>linux-headers</code> 导致。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt</span> update</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> linux-headers-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-r</span><span class="token variable">)</span></span>-amd64</pre></td></tr></table></figure><p>note：</p><p>命令 <code>uname -r</code> 就是用来获取当前内核版本的。</p><p>一般编译驱动会用到 <code>sudo apt-get install build-essential linux-headers-$(uname -r)-amd64</code></p><h3 id="网卡驱动添加"><a class="anchor" href="#网卡驱动添加">#</a> 网卡驱动添加</h3><p>获取网卡型号：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>lspci <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> net</pre></td></tr><tr><td data-num="2"></td><td><pre>02:00.0 Network controller: Realtek Semiconductor Co., Ltd. RTL8723BE PCIe Wireless Network Adapter</pre></td></tr><tr><td data-num="3"></td><td><pre>03:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller <span class="token punctuation">(</span>rev <span class="token number">15</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>其中 <code>Ethernet controller</code> 后面的表示以太网有线网卡，这里是 RTL8111/8168/8411； <code>Network controller</code> 后面表示无线网卡，这里则是 RTL8723BE。</p><ul><li><p>有线网卡</p><p>一般主板上的有线网卡都是自带驱动的，但不排除驱动不管用或者另类没有，这个时候就需要自己找驱动，当然，如果有现成编译好打好包的驱动，那么只需要用 U 盘 copy 到系统然后进行安装即可，如果没有，那么就需要自己编译驱动了，这是一个很麻烦的事，特别是你完全没网的时候，光是安装一堆依赖都得一个个找。。。</p><p>当然你也可以找个联网的虚拟机，安装一样的系统，编译好再 copy 过去；或者利用 <code>apt-cache depends package_name</code> 获取安装依赖，然后一个个安装；对于 <code>.deb</code> 文件，可以用 <code>dpkg --info path_deb_file</code> 查看。</p></li><li><p>无线网卡</p><p>在 Debian 最小安装中，是不存在无线网卡驱动的，只能自己安装：</p><ul><li><p>intel 的无线网卡驱动：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">apt</span> <span class="token function">install</span> firmware-iwlwifi</pre></td></tr></table></figure><p>支持型号：<span class="exturl" data-url="aHR0cHM6Ly9wYWNrYWdlcy5kZWJpYW4ub3JnL2J1bGxzZXllL2Zpcm13YXJlLWl3bHdpZmk=">https://packages.debian.org/bullseye/firmware-iwlwifi</span></p></li><li><p>realtek（小螃蟹）的无线网卡驱动：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">apt</span> <span class="token function">install</span> firmware-realtek</pre></td></tr></table></figure><p>支持型号：<span class="exturl" data-url="aHR0cHM6Ly9wYWNrYWdlcy5kZWJpYW4ub3JnL2J1bGxzZXllL2Zpcm13YXJlLXJlYWx0ZWs=">https://packages.debian.org/bullseye/firmware-realtek</span></p></li><li><p>高通的无线网卡驱动：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">apt</span> <span class="token function">install</span> firmware-atheros</pre></td></tr></table></figure><p>支持型号：<span class="exturl" data-url="aHR0cHM6Ly9wYWNrYWdlcy5kZWJpYW4ub3JnL2J1bGxzZXllL2Zpcm13YXJlLWF0aGVyb3M=">https://packages.debian.org/bullseye/firmware-atheros</span></p></li><li><p>other：</p><p>当然，如果你像一劳永逸，可以直接安装 <code>firmware-nonfree</code> 整个大包，或者在里面找相应的型号子包安装：<span class="exturl" data-url="aHR0cHM6Ly9wYWNrYWdlcy5kZWJpYW4ub3JnL3NvdXJjZS9idWxsc2V5ZS9maXJtd2FyZS1ub25mcmVlJUVGJUJDJTlCJUU4JTgwJThDJUU1JUFGJUI5JUU0JUJBJThFJUU1JTg1JUI2JUU1JUFFJTgzJUU2JUFGJTk0JUU4JUJFJTgzJUU2JTk2JUIwJUU3JTlBJTg0JUU4JUFFJUJFJUU1JUE0JTg3JUU2JTg4JTk2JUU4JTgwJTg1JUU0JUI4JThEJUU1JTlDJUE4JUU2JUI4JTg1JUU1JThEJTk1JUU0JUI4JThBJUU3JTlBJTg0JUU4JUFFJUJFJUU1JUE0JTg3JUVGJUJDJThDJUU1JThGJUFGJUU0JUJCJUE1JUU1JThFJUJCJUU1JUFFJTk4JUU3JUJEJTkxJUU2JTg4JTk2JUU4JTgwJTg1JUU1JUJDJTgwJUU2JUJBJTkwJUU1JUI5JUJGJUU1JTlDJUJBJUU0JUI4JThBJUU2JTg5JUJFJUVGJUJDJThDJUU0JUJEJTg2JUU1JUE0JUE3JUU5JTgzJUE4JUU1JTg4JTg2JUU5JTlDJTgwJUU4JUE2JTgxJUU4JTg3JUFBJUU1JUI3JUIxJUU3JUJDJTk2JUU4JUFGJTkxJUU5JUE5JUIxJUU1JThBJUE4JUUzJTgwJTgy">https://packages.debian.org/source/bullseye/firmware-nonfree；而对于其它比较新的设备或者不在清单上的设备，可以去官网或者开源广场上找，但大部分需要自己编译驱动。</span></p></li></ul></li></ul><p>关于网卡驱动安装完后，可以 <code>reboot</code> 重启，然后执行 <code>dmesg -l err</code> 查看日志，看驱动是否生效，如果没有，将会出现 error，然后排查解决就好了。</p><h3 id="引导时间修改"><a class="anchor" href="#引导时间修改">#</a> 引导时间修改</h3><p>如果你是单系统，可以更改引导时间缩短跳转启动系统的时间。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">nano</span> /etc/default/grub</pre></td></tr></table></figure><p>更改 <code>GRUB_TIMEOUT</code> 数值为 1，这里建议不要改成 0，留出 1s 的时间，防止以后有用到。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">cat</span> /etc/default/grub</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># If you change this file, run 'update-grub' afterwards to update</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># /boot/grub/grub.cfg.</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># For full documentation of the options in this file, see:</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">#   info -f grub -n 'Simple configuration'</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token assign-left variable">GRUB_DEFAULT</span><span class="token operator">=</span><span class="token number">0</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token assign-left variable">GRUB_TIMEOUT</span><span class="token operator">=</span><span class="token number">1</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token assign-left variable">GRUB_DISTRIBUTOR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>lsb_release <span class="token parameter variable">-i</span> <span class="token parameter variable">-s</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span> /dev/null <span class="token operator">||</span> <span class="token builtin class-name">echo</span> Debian<span class="token variable">`</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token assign-left variable">GRUB_CMDLINE_LINUX_DEFAULT</span><span class="token operator">=</span><span class="token string">"quiet"</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token assign-left variable">GRUB_CMDLINE_LINUX</span><span class="token operator">=</span><span class="token string">""</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># Uncomment to enable BadRAM filtering, modify to suit your needs</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># This works with Linux (no patch required) and with any kernel that obtains</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># the memory map information from GRUB (GNU Mach, kernel of FreeBSD ...)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">#GRUB_BADRAM="0x01234567,0xfefefefe,0x89abcdef,0xefefefef"</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># Uncomment to disable graphical terminal (grub-pc only)</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">#GRUB_TERMINAL=console</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># The resolution used on graphical terminal</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment"># note that you can use only modes which your graphic card supports via VBE</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment"># you can see them in real GRUB with the command `vbeinfo'</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment">#GRUB_GFXMODE=640x480</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment"># Uncomment if you don't want GRUB to pass "root=UUID=xxx" parameter to Linux</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment">#GRUB_DISABLE_LINUX_UUID=true</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token comment"># Uncomment to disable generation of recovery mode menu entries</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment">#GRUB_DISABLE_RECOVERY="true"</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment"># Uncomment to get a beep at grub start</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment">#GRUB_INIT_TUNE="480 440 1"</span></pre></td></tr></table></figure><p>最后更新 Grub：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">update-grub</span></pre></td></tr></table></figure><p>note：</p><p>可以通过 <code>systemd-analyze time</code> 查看开机时间，通过 <code>systemd-analyze blame</code> 查看开机服务占用时间。</p><h3 id="ssh-配置"><a class="anchor" href="#ssh-配置">#</a> ssh 配置</h3><p>在安装的时候有勾选 ssh 服务的话，那么只需要配置一下文件即可，否则就需要自己去下载。（当然，这里只是前置使用，后期安装 OMV 后，将由 OMV 接管）</p><h3 id="安装中文输入法"><a class="anchor" href="#安装中文输入法">#</a> 安装中文输入法</h3><p>在 linux 系统中，常见的两大输入法框架：ibus 和 fcitx，而这里使用 Fcitx5，是用来接替 Fcitx 的。</p><blockquote><p>注意： fcitx5 包仅提供基本框架，且仅支持英文。如果要输入其他语言（例如中文或日文），则需要安装输入法引擎（IME）。</p></blockquote><p>Fcitx5 输入法引擎有以下几种：</p><p><strong>中文</strong></p><ul><li><p>fcitx5-chewing 包：是流行的繁体中文注音输入引擎，它基于 libchewing 包。</p></li><li><p>fcitx5-chinese-addons 包：包含与中文相关的 addon，例如拼音、双拼和五笔。</p></li><li><p>fcitx5-rime 包：使用 Rime 引擎。</p></li></ul><p><strong>日文</strong></p><ul><li><p>fcitx5-anthy 包：是流行的日文输入引擎。但是，它已不再受到积极开发。</p></li><li><p>fcitx5-kkc 包：是日文假名输入引擎，它基于 libkkc 包。</p></li><li><p>fcitx5-mozc 包：基于 Mozc（Google 日文输入法的开源版本）。</p></li><li><p>fcitx5-skk 包：是日文假名输入引擎，它基于 libskk 包。</p></li></ul><p><strong>其他语言</strong></p><ul><li>fcitx5-hangul 包：用于输入韩文，基于 libhangul 包。</li><li>fcitx5-unikey 包：可用于输入越南语字符。</li><li>fcitx5-m17n 包：可用于各种语言。</li></ul><p>1、卸载旧版及其余输入法</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">apt</span> purge fcitx* ibus*</pre></td></tr></table></figure><p>2、安装 Fcitx5 简体中文输入</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">apt</span> <span class="token function">install</span> fcitx5 fcitx5-chinese-addons</pre></td></tr></table></figure><p>3、重启配置</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">reboot</span></pre></td></tr></table></figure><p>开机后查看 fcitx5 是否随桌面环境自动启动，如无，则添加开机自启：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> <span class="token string">"~/.config/autostart/"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token function">mkdir</span>  ~/.config/autostart/</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">fi</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token function">cp</span> /usr/share/applications/org.fcitx.Fcitx5.desktop ~/.config/autostart/</pre></td></tr></table></figure><p>4、添加拼音输入</p><p>在应用中打开 Fcitx5 配置，然后在输入法中添加中文拼音，同时在全局选项中配置输入法切换快捷键（默认是 <code>Ctrl + 空格键</code> 切换）。</p><p>5、修改全局变量</p><ul><li>使用 <code>im-config</code> 组件配置</li></ul><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">apt</span> <span class="token function">install</span> im-config</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>im-config</pre></td></tr></table></figure><p>进入图形界面选择 Fcitx5 输入法。</p><ul><li>编辑 <code>/etc/environment</code></li></ul><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">vim</span> /etc/environment</pre></td></tr></table></figure><p>添加如下全局配置：</p><figure class="highlight wiki"><figcaption data-lang="Wiki markup"></figcaption><table><tr><td data-num="1"></td><td><pre>GTK_IM_MODULE=fcitx</pre></td></tr><tr><td data-num="2"></td><td><pre>QT_IM_MODULE=fcitx</pre></td></tr><tr><td data-num="3"></td><td><pre>XMODIFIERS=@im=fcitx</pre></td></tr><tr><td data-num="4"></td><td><pre>SDL_IM_MODULE=fcitx</pre></td></tr><tr><td data-num="5"></td><td><pre>INPUT_METHOD=fcitx</pre></td></tr><tr><td data-num="6"></td><td><pre>GLFW_IM_MODULE=ibus</pre></td></tr></table></figure><p>资料：</p><p><span class="exturl" data-url="aHR0cHM6Ly93aWtpLmFyY2hsaW51eGNuLm9yZy93aWtpL0ZjaXR4NQ==">https://wiki.archlinuxcn.org/wiki/Fcitx5</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93aWtpLmRlYmlhbi5vcmcvemhfQ04vSTE4bi9GY2l0eDU=">https://wiki.debian.org/zh_CN/I18n/Fcitx5</span></p><h2 id="节电处理"><a class="anchor" href="#节电处理">#</a> 节电处理</h2><h3 id="无线"><a class="anchor" href="#无线">#</a> 无线</h3><p>软件关闭蓝牙功能：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>rfkill block bluetooth</pre></td></tr></table></figure><p>软件关闭 wifi 功能：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>rfkill block wifi</pre></td></tr></table></figure><h3 id="usb"><a class="anchor" href="#usb">#</a> USB</h3><p>添加 USB 空闲自动挂起处理，空闲等待时间为 2S， <code>reboot</code> 重启生效：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">'ACTION=="add", SUBSYSTEM=="usb",  ATTR&#123;power/control&#125;="auto", ATTR&#123;power/autosuspend_delay_ms&#125;="2000"'</span> <span class="token operator">></span> /etc/udev/rules.d/50-usb_power_save.rules</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">reboot</span></pre></td></tr></table></figure><p>其它控制：</p><p><code>ATTR&#123;power/control&#125;=&quot;on&quot;</code> or <code>ATTR&#123;power/autosuspend_delay_ms&#125;=&quot;-1&quot;</code> ，表示禁用挂起； <code>ATTR&#123;power/wakeup&#125;=&quot;enable&quot;</code> ，表示使能 usb 唤醒，写入 <code>disable</code> 则关闭。</p><p>如果想要单独设置，可以如下查看 usb 设备对应的 udev 字段，eg：查看 Logitech 鼠标：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>lsusb</pre></td></tr><tr><td data-num="2"></td><td><pre>Bus 002 Device 001: ID 1d6b:0003 Linux Foundation <span class="token number">3.0</span> root hub</pre></td></tr><tr><td data-num="3"></td><td><pre>Bus 001 Device 003: ID 0bda:b728 Realtek Semiconductor Corp. RTL8723B Bluetooth</pre></td></tr><tr><td data-num="4"></td><td><pre>Bus 001 Device 002: ID 046d:c52b Logitech, Inc. Unifying Receiver</pre></td></tr><tr><td data-num="5"></td><td><pre>Bus 001 Device 001: ID 1d6b:0002 Linux Foundation <span class="token number">2.0</span> root hub</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>lsusb <span class="token parameter variable">-tvv</span></pre></td></tr><tr><td data-num="8"></td><td><pre>/:  Bus 02.Port <span class="token number">1</span>: Dev <span class="token number">1</span>, <span class="token assign-left variable">Class</span><span class="token operator">=</span>root_hub, <span class="token assign-left variable">Driver</span><span class="token operator">=</span>xhci_hcd/7p, 5000M</pre></td></tr><tr><td data-num="9"></td><td><pre>    ID 1d6b:0003 Linux Foundation <span class="token number">3.0</span> root hub</pre></td></tr><tr><td data-num="10"></td><td><pre>    /sys/bus/usb/devices/usb2  /dev/bus/usb/002/001</pre></td></tr><tr><td data-num="11"></td><td><pre>/:  Bus 01.Port <span class="token number">1</span>: Dev <span class="token number">1</span>, <span class="token assign-left variable">Class</span><span class="token operator">=</span>root_hub, <span class="token assign-left variable">Driver</span><span class="token operator">=</span>xhci_hcd/9p, 480M</pre></td></tr><tr><td data-num="12"></td><td><pre>    ID 1d6b:0002 Linux Foundation <span class="token number">2.0</span> root hub</pre></td></tr><tr><td data-num="13"></td><td><pre>    /sys/bus/usb/devices/usb1  /dev/bus/usb/001/001</pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token operator">|</span>__ Port <span class="token number">4</span>: Dev <span class="token number">2</span>, If <span class="token number">1</span>, <span class="token assign-left variable">Class</span><span class="token operator">=</span>Human Interface Device, <span class="token assign-left variable">Driver</span><span class="token operator">=</span>usbhid, 12M</pre></td></tr><tr><td data-num="15"></td><td><pre>        ID 046d:c52b Logitech, Inc. Unifying Receiver</pre></td></tr><tr><td data-num="16"></td><td><pre>        /sys/bus/usb/devices/1-4  /dev/bus/usb/001/002</pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token operator">|</span>__ Port <span class="token number">4</span>: Dev <span class="token number">2</span>, If <span class="token number">2</span>, <span class="token assign-left variable">Class</span><span class="token operator">=</span>Human Interface Device, <span class="token assign-left variable">Driver</span><span class="token operator">=</span>usbhid, 12M</pre></td></tr><tr><td data-num="18"></td><td><pre>        ID 046d:c52b Logitech, Inc. Unifying Receiver</pre></td></tr><tr><td data-num="19"></td><td><pre>        /sys/bus/usb/devices/1-4  /dev/bus/usb/001/002</pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token operator">|</span>__ Port <span class="token number">4</span>: Dev <span class="token number">2</span>, If <span class="token number">0</span>, <span class="token assign-left variable">Class</span><span class="token operator">=</span>Human Interface Device, <span class="token assign-left variable">Driver</span><span class="token operator">=</span>usbhid, 12M</pre></td></tr><tr><td data-num="21"></td><td><pre>        ID 046d:c52b Logitech, Inc. Unifying Receiver</pre></td></tr><tr><td data-num="22"></td><td><pre>        /sys/bus/usb/devices/1-4  /dev/bus/usb/001/002</pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token operator">|</span>__ Port <span class="token number">8</span>: Dev <span class="token number">3</span>, If <span class="token number">0</span>, <span class="token assign-left variable">Class</span><span class="token operator">=</span>Wireless, <span class="token assign-left variable">Driver</span><span class="token operator">=</span>btusb, 12M</pre></td></tr><tr><td data-num="24"></td><td><pre>        ID 0bda:b728 Realtek Semiconductor Corp. RTL8723B Bluetooth</pre></td></tr><tr><td data-num="25"></td><td><pre>        /sys/bus/usb/devices/1-8  /dev/bus/usb/001/003</pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token operator">|</span>__ Port <span class="token number">8</span>: Dev <span class="token number">3</span>, If <span class="token number">1</span>, <span class="token assign-left variable">Class</span><span class="token operator">=</span>Wireless, <span class="token assign-left variable">Driver</span><span class="token operator">=</span>btusb, 12M</pre></td></tr><tr><td data-num="27"></td><td><pre>        ID 0bda:b728 Realtek Semiconductor Corp. RTL8723B Bluetooth</pre></td></tr><tr><td data-num="28"></td><td><pre>        /sys/bus/usb/devices/1-8  /dev/bus/usb/001/003</pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>udevadm info <span class="token parameter variable">-a</span> /dev/bus/usb/001/002</pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre>Udevadm info starts with the device specified by the devpath and <span class="token keyword">then</span></pre></td></tr><tr><td data-num="33"></td><td><pre>walks up the chain of parent devices. It prints <span class="token keyword">for</span> every device</pre></td></tr><tr><td data-num="34"></td><td><pre>found, all possible attributes <span class="token keyword">in</span> the udev rules key format.</pre></td></tr><tr><td data-num="35"></td><td><pre>A rule to match, can be composed by the attributes of the device</pre></td></tr><tr><td data-num="36"></td><td><pre>and the attributes from one single parent device.</pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre>  looking at device <span class="token string">'/devices/pci0000:00/0000:00:15.0/usb1/1-4'</span><span class="token builtin class-name">:</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token assign-left variable">KERNEL</span><span class="token operator">==</span><span class="token string">"1-4"</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token assign-left variable">SUBSYSTEM</span><span class="token operator">==</span><span class="token string">"usb"</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token assign-left variable">DRIVER</span><span class="token operator">==</span><span class="token string">"usb"</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>authorized<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"1"</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>avoid_reset_quirk<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"0"</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>bConfigurationValue<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"1"</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>bDeviceClass<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"00"</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>bDeviceProtocol<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"00"</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>bDeviceSubClass<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"00"</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>bMaxPacketSize0<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"8"</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>bMaxPower<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"98mA"</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>bNumConfigurations<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"1"</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>bNumInterfaces<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">" 3"</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>bcdDevice<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"1211"</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>bmAttributes<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"a0"</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>busnum<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"1"</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>configuration<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"RQR12.11_B0032"</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>devnum<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"2"</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>devpath<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"4"</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>idProduct<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"c52b"</span></pre></td></tr><tr><td data-num="59"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>idVendor<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"046d"</span></pre></td></tr><tr><td data-num="60"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>ltm_capable<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"no"</span></pre></td></tr><tr><td data-num="61"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>manufacturer<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"Logitech"</span></pre></td></tr><tr><td data-num="62"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>maxchild<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"0"</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/active_duration<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"5486884"</span></pre></td></tr><tr><td data-num="64"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/async<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"enabled"</span></pre></td></tr><tr><td data-num="65"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/autosuspend<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"2"</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/autosuspend_delay_ms<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"2000"</span></pre></td></tr><tr><td data-num="67"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/connected_duration<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"5486884"</span></pre></td></tr><tr><td data-num="68"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/control<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"on"</span></pre></td></tr><tr><td data-num="69"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/level<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"on"</span></pre></td></tr><tr><td data-num="70"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/persist<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"1"</span></pre></td></tr><tr><td data-num="71"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/runtime_active_kids<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"0"</span></pre></td></tr><tr><td data-num="72"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/runtime_active_time<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"5486602"</span></pre></td></tr><tr><td data-num="73"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/runtime_enabled<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"forbidden"</span></pre></td></tr><tr><td data-num="74"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/runtime_status<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"active"</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/runtime_suspended_time<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"0"</span></pre></td></tr><tr><td data-num="76"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/runtime_usage<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"1"</span></pre></td></tr><tr><td data-num="77"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/wakeup<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"enabled"</span></pre></td></tr><tr><td data-num="78"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/wakeup_abort_count<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"0"</span></pre></td></tr><tr><td data-num="79"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/wakeup_active<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"0"</span></pre></td></tr><tr><td data-num="80"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/wakeup_active_count<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"0"</span></pre></td></tr><tr><td data-num="81"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/wakeup_count<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"0"</span></pre></td></tr><tr><td data-num="82"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/wakeup_expire_count<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"0"</span></pre></td></tr><tr><td data-num="83"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/wakeup_last_time_ms<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"0"</span></pre></td></tr><tr><td data-num="84"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/wakeup_max_time_ms<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"0"</span></pre></td></tr><tr><td data-num="85"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>power/wakeup_total_time_ms<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"0"</span></pre></td></tr><tr><td data-num="86"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>product<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"USB Receiver"</span></pre></td></tr><tr><td data-num="87"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>quirks<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"0x0"</span></pre></td></tr><tr><td data-num="88"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>removable<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"removable"</span></pre></td></tr><tr><td data-num="89"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>rx_lanes<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"1"</span></pre></td></tr><tr><td data-num="90"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>speed<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"12"</span></pre></td></tr><tr><td data-num="91"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>tx_lanes<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"1"</span></pre></td></tr><tr><td data-num="92"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>urbnum<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">"34"</span></pre></td></tr><tr><td data-num="93"></td><td><pre>    ATTR<span class="token punctuation">&#123;</span>version<span class="token punctuation">&#125;</span><span class="token operator">==</span><span class="token string">" 2.00"</span></pre></td></tr><tr><td data-num="94"></td><td><pre></pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr></table></figure><p><strong>参看：</strong></p><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmtlcm5lbC5vcmcvZHJpdmVyLWFwaS91c2IvcG93ZXItbWFuYWdlbWVudC5odG1s">https://docs.kernel.org/driver-api/usb/power-management.html</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvVWRldiNXYWtpbmdfZnJvbV9zdXNwZW5kX3dpdGhfVVNCX2RldmljZQ==">https://wiki.archlinux.org/title/Udev#Waking_from_suspend_with_USB_device</span></p><p><span class="exturl" data-url="aHR0cDovL3d3dy5yZWFjdGl2YXRlZC5uZXQvd3JpdGluZ191ZGV2X3J1bGVzLmh0bWwjZXhhbXBsZS1wcmludGVy">http://www.reactivated.net/writing_udev_rules.html#example-printer</span></p><h3 id="cpu-调度"><a class="anchor" href="#cpu-调度">#</a> cpu 调度</h3><p>一般支持以下几种策略，旧内核可能不支持 <code>schedutil</code> ：</p><table><thead><tr><th>Governor</th><th>Description</th></tr></thead><tbody><tr><td>performance</td><td>Run the CPU at the maximum frequency, obtained from <code>/sys/devices/system/cpu/cpuX/cpufreq/scaling_max_freq</code> .</td></tr><tr><td>powersave</td><td>Run the CPU at the minimum frequency, obtained from <code>/sys/devices/system/cpu/cpuX/cpufreq/scaling_min_freq</code> .</td></tr><tr><td>userspace</td><td>Run the CPU at user specified frequencies, configurable via <code>/sys/devices/system/cpu/cpuX/cpufreq/scaling_setspeed</code> .</td></tr><tr><td>ondemand</td><td>Scales the frequency dynamically according to current load. Jumps to the highest frequency and then possibly back off as the idle time increases.</td></tr><tr><td>conservative</td><td>Scales the frequency dynamically according to current load. Scales the frequency more gradually than ondemand.</td></tr><tr><td>schedutil</td><td>Scheduler-driven CPU frequency selection.</td></tr></tbody></table><p>关于 <code>schedutil</code> 的原理可看：<span class="exturl" data-url="aHR0cHM6Ly9kZWVwaW5vdXQuY29tL2FuZHJvaWQtc3lzdGVtLWFuYWx5c2lzL2FuZHJvaWQtY3B1LXJlbGF0ZWQvcHJpbmNpcGxlLWFuYWx5c2lzLW9mLWNwdS1nb3Zlcm5vci1zY2hlZHV0aWwuaHRtbA==">https://deepinout.com/android-system-analysis/android-cpu-related/principle-analysis-of-cpu-governor-schedutil.html</span></p><p>查看 cpu 支持的调度策略及当前使用的模式：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">cat</span> /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors</pre></td></tr><tr><td data-num="2"></td><td><pre>conservative ondemand performance schedutil</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">cat</span> /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor</pre></td></tr><tr><td data-num="4"></td><td><pre>schedutil</pre></td></tr></table></figure><p>修改所有 cpu 的策略：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">echo</span> governor <span class="token operator">|</span> <span class="token function">tee</span> /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor</pre></td></tr><tr><td data-num="2"></td><td><pre>governor</pre></td></tr></table></figure><p>note： <code>governor</code> 为支持的策略之一，选你需要更改的就好了。</p><p><strong>注意，该操作只在当前生效，任何复位或重启后，都将恢复默认操作，因此如果要让每次生效，那么需要编写开机脚本或写入内核。</strong></p><p>查看各 cpu 频率：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">cat</span> /proc/cpuinfo <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token string">'^model name|^cpu MHz'</span></pre></td></tr><tr><td data-num="2"></td><td><pre>model name      <span class="token builtin class-name">:</span> Intel<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Pentium<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Silver J5040 CPU @ <span class="token number">2</span>.00GHz</pre></td></tr><tr><td data-num="3"></td><td><pre>cpu MHz         <span class="token builtin class-name">:</span> <span class="token number">1029.564</span></pre></td></tr><tr><td data-num="4"></td><td><pre>model name      <span class="token builtin class-name">:</span> Intel<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Pentium<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Silver J5040 CPU @ <span class="token number">2</span>.00GHz</pre></td></tr><tr><td data-num="5"></td><td><pre>cpu MHz         <span class="token builtin class-name">:</span> <span class="token number">1168.290</span></pre></td></tr><tr><td data-num="6"></td><td><pre>model name      <span class="token builtin class-name">:</span> Intel<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Pentium<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Silver J5040 CPU @ <span class="token number">2</span>.00GHz</pre></td></tr><tr><td data-num="7"></td><td><pre>cpu MHz         <span class="token builtin class-name">:</span> <span class="token number">818.342</span></pre></td></tr><tr><td data-num="8"></td><td><pre>model name      <span class="token builtin class-name">:</span> Intel<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Pentium<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Silver J5040 CPU @ <span class="token number">2</span>.00GHz</pre></td></tr><tr><td data-num="9"></td><td><pre>cpu MHz         <span class="token builtin class-name">:</span> <span class="token number">960.974</span></pre></td></tr></table></figure><p>资料：</p><p><span class="exturl" data-url="aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvQ1BVX2ZyZXF1ZW5jeV9zY2FsaW5nI1NjYWxpbmdfZ292ZXJub3Jz">https://wiki.archlinux.org/title/CPU_frequency_scaling#Scaling_governors</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmtlbHUub3JnL3RlY2gvMjAyMS8wNS8xMy9iaW9zLWNvbmZpZy1yZW1hcmsuaHRtbA==">https://blog.kelu.org/tech/2021/05/13/bios-config-remark.html</span></p><h3 id="睡眠与休眠"><a class="anchor" href="#睡眠与休眠">#</a> 睡眠与休眠</h3><p>关于 Suspend，Linux 内核提供了四种电源模式，如下表：</p><table><thead><tr><th>模式</th><th>描述</th></tr></thead><tbody><tr><td>freeze</td><td>冻结 I/O 设备，将它们置于低功耗状态，使处理器进入空闲状态，唤醒最快，耗电比其它 standby, mem, disk 方式高。</td></tr><tr><td>standby</td><td>除了冻结 I/O 设备外，还会暂停系统，唤醒较快，耗电比其它 mem, disk 方式高。</td></tr><tr><td>mem</td><td>将运行状态数据存到内存，并关闭外设，进入等待模式，唤醒较慢，耗电比 disk 方式高。（实际由 <code>/sys/power/mem_sleep</code> 抉择）</td></tr><tr><td>disk</td><td>将运行状态数据存到硬盘，然后关机，唤醒最慢；对于嵌入式系统，由于没有硬盘，所以一般不支持。（实际由 <code>/sys/power/disk</code> 抉择）</td></tr></tbody></table><p>然，虽然 linux 内核支持，但实际上不同的平台，对应的支持也是不一样的；可以使用以下命令查看对 Suspend 支持：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">cat</span> /sys/power/state</pre></td></tr><tr><td data-num="2"></td><td><pre>freeze mem disk</pre></td></tr></table></figure><p>在这里，就只支持 3 种： <code>freeze</code> 、 <code>mem</code> 、 <code>disk</code> 。</p><p>在 linux 中，有两个比较特殊的 Suspend 管理，那就是 <code>mem</code> 和 <code>disk</code> ，分别是 <strong>Suspend to RAM（挂起到内存，通称睡眠）</strong> 和 <strong>Suspend to disk（挂起到硬盘，通称休眠）</strong> 这两种电源管理模式，它们默认使用的 ACPI 定义如下：</p><ul><li><p>Suspend to RAM（挂起到内存，通称睡眠）</p><p>ACPI 定义的 <strong>S3</strong> 睡眠状态。通过将机器中大多数和 RAM 不相关的部件断电来工作，RAM 是恢复机器状态所必需的。由于可以节省大量电力，建议笔记本电脑在使用电池运行且盖子关闭时（或用户在一段时间内处于非活动状态）自动进入此模式。</p></li><li><p>Suspend to disk（挂起到硬盘，通称休眠）</p><p>ACPI 定义的 <strong>S4</strong> 睡眠状态。将机器状态保存到交换空间并关闭机器。再次开机后，恢复状态。直到开机前，机器都不会有任何待机功耗。</p></li></ul><p>note：实际上， <code>mem</code> 和 <code>disk</code> 是由它们对应的配置文件决定的，但一般默认会使用上面的 ACPI 状态。</p><p>对于 <code>mem</code> 和 <code>disk</code> 的控制：</p><p><code>mem</code> 模式的操作由 <code>/sys/power/mem_sleep</code> 抉择，常见以下几种睡眠处理：</p><ul><li>deep：Suspend-To-RAM，对应 ACPI 为 S3；</li><li>shallow：Power-On Suspend，对应 ACPI 为 S1；</li><li>s2idle：Suspend-To-Idle，对应 ACPI 为 S0；</li></ul><p><code>disk</code> 模式的操作则由 <code>/sys/power/disk</code> 抉择，常见以下几种休眠处理：</p><ul><li>platform：使用平台（BIOS 支持）提供的方法将把系统置于超低功耗状态（如 ACPI S4），使得额外的唤醒选项可用，并且让平台固件在唤醒之后可能允许做一个简简的初始化；</li><li>shutdown：顾名思义就是关闭系统设备断电；</li><li>reboot：这个。。。不用说了吧；</li><li>suspend：系统混合挂起，是的没错，可以将睡眠和休眠混合，可以通过在 <code>/etc/systemd/sleep.conf</code> 文件进行配置以达到效果，可参考：<span class="exturl" data-url="aHR0cHM6Ly93aWtpLmFyY2hsaW51eGNuLm9yZy93aWtpLyVFNyU5NCVCNSVFNiVCQSU5MCVFNyVBRSVBMSVFNyU5MCU4NiMlRTYlOEMlODIlRTglQjUlQjclRTYlODglOTYlRTQlQkMlOTElRTclOUMlQTAlRTglQUYlQjclRTYlQjElODIlRTYlOTclQjYlRTclOUElODQlRTYlQjclQjclRTUlOTAlODglRTclOUQlQTElRTclOUMlQTA=">挂起或休眠请求时的混合睡眠</span> ；</li><li>test_resume：诊断操作。先是加载镜像（就好像系统刚从休眠中醒来，当前运行的内核实例是还原内核），然后再恢复整个系统。</li></ul><p>查看支持：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">cat</span> /sys/power/mem_sleep</pre></td></tr><tr><td data-num="2"></td><td><pre>s2idle <span class="token punctuation">[</span>deep<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">cat</span> /sys/power/disk</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>platform<span class="token punctuation">]</span> <span class="token function">shutdown</span> <span class="token function">reboot</span> <span class="token function">suspend</span> test_resume</pre></td></tr></table></figure><p>如果想要切换相应的控制，只需往写入你要的处理模式就好了；当然，这只是在下一次中生效，当执行完一次后将会恢复；若要设成永久处理，那么可以通过修改内核属性来达到效果。</p><p><strong>自动休眠：</strong></p><p>一般作为服务器，是不需要自动休眠的，但对于一周也用不了多少次的，可能使用自动休眠会省电一点，配合唤醒功能即可达到快速恢复工作环境的效果。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">vim</span> /etc/default/grub</pre></td></tr></table></figure><p>然后添加 <code>GRUB_CMDLINE_LINUX=&quot;mem_sleep_default=deep&quot;</code> ，然后重新生成 <code>grub.cfg</code> 文件，重启生效：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">grub-mkconfig</span> <span class="token parameter variable">-o</span> /boot/grub/grub.cfg</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">reboot</span></pre></td></tr></table></figure><p>资料：</p><p><span class="exturl" data-url="aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvUG93ZXJfbWFuYWdlbWVudC9TdXNwZW5kX2FuZF9oaWJlcm5hdGU=">https://wiki.archlinux.org/title/Power_management/Suspend_and_hibernate</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9tYW4uYXJjaGxpbnV4Lm9yZy9tYW4vc2xlZXAuY29uZi5kLjU=">https://man.archlinux.org/man/sleep.conf.d.5</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvUG93ZXJfbWFuYWdlbWVudCNTdXNwZW5kX2FuZF9oaWJlcm5hdGU=">https://wiki.archlinux.org/title/Power_management#Suspend_and_hibernate</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cudW5peHR1dG9yaWFsLm9yZy9kaXNhYmxlLXNsZWVwLW9uLXVidW50dS1zZXJ2ZXIv">https://www.unixtutorial.org/disable-sleep-on-ubuntu-server/</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cua2VybmVsLm9yZy9kb2MvaHRtbC9sYXRlc3QvYWRtaW4tZ3VpZGUvcG0vc2xlZXAtc3RhdGVzLmh0bWw=">https://www.kernel.org/doc/html/latest/admin-guide/pm/sleep-states.html</span></p><p>更多电源管理：<span class="exturl" data-url="aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvUG93ZXJfbWFuYWdlbWVudCNQb3dlcl9zYXZpbmc=">https://wiki.archlinux.org/title/Power_management#Power_saving</span></p><p>Kernel 参数：<span class="exturl" data-url="aHR0cHM6Ly93d3cua2VybmVsLm9yZy9kb2MvRG9jdW1lbnRhdGlvbi9hZG1pbi1ndWlkZS9rZXJuZWwtcGFyYW1ldGVycy50eHQ=">https://www.kernel.org/doc/Documentation/admin-guide/kernel-parameters.txt</span></p><h2 id="图形环境切换"><a class="anchor" href="#图形环境切换">#</a> 图形环境切换</h2><p>前提：系统已经安装了桌面环境，需要禁止桌面环境，以纯命令行启动，以节约性能。</p><p>获取当前系统运行的界面模式：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>systemctl get-default</pre></td></tr></table></figure><p>纯命令行启动：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>systemctl set-default multi-user.target</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">reboot</span></pre></td></tr></table></figure><p>note：如果想从命令行中启动桌面，可以通过相应的图形界面启动命令来启动，例如启动 xfce4 的桌面： <code>startxfce4</code> .</p><p>桌面环境启动：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>systemctl set-default graphical.target</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">reboot</span></pre></td></tr></table></figure><p>对于多桌面，可以使用下面命令，然后选择对应的桌面系统，输入序号确认：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>update-alternatives <span class="token parameter variable">--config</span> x-session-manager</pre></td></tr></table></figure><p>如果要删除 <code>x-session-manager</code> 的某个选项，可以先通过以下方式列出其路径，然后通过删除选项（eg：gnome-session）：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>update-alternatives <span class="token parameter variable">--list</span> x-session-manager</pre></td></tr><tr><td data-num="2"></td><td><pre>update-alternatives <span class="token parameter variable">--remove</span> x-session-manager /usr/bin/gnome-session</pre></td></tr></table></figure><p>参考：</p><p><span class="exturl" data-url="aHR0cHM6Ly91bml4LnN0YWNrZXhjaGFuZ2UuY29tL3F1ZXN0aW9ucy8zNjcyOTQvaG93LWRvLWktY2hhbmdlLW15LWRlZmF1bHQtc2Vzc2lvbg==">https://unix.stackexchange.com/questions/367294/how-do-i-change-my-default-session</span></p><h2 id="远程唤醒"><a class="anchor" href="#远程唤醒">#</a> 远程唤醒</h2><p>首先，查看系统主板 BIOS 是否支持 Wake-On-LAN ，要是支持的话，必须先启动它，因为它被默认设禁用。</p><p>然后，需要一个支持 Wake-On-LAN 的网卡；<mark>无线网卡并不支持</mark>。你需要运行 <code>ethtool</code> 命令查看网卡是否支持 Wake-On-LAN ：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">apt</span> <span class="token function">install</span> <span class="token function">ethtool</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">ethtool</span> eno1 <span class="token operator">|</span> <span class="token function">grep</span> Wake-on</pre></td></tr><tr><td data-num="3"></td><td><pre>        Supports Wake-on: pumbg</pre></td></tr><tr><td data-num="4"></td><td><pre>        Wake-on: d</pre></td></tr></table></figure><p>这条命令输出的 <code>Supports Wake-on</code> 字段会告诉你你的网卡支持哪些功能，同时 <code>Wake-on</code> 指示着当前配置的模式，一般有以下几种选项：</p><ul><li>d -- 禁用（disable）</li><li>p -- 物理活动唤醒（Wake on PHY activity）</li><li>u -- 单播消息唤醒（Wake on unicast activity）</li><li>m -- 多播（组播）消息唤醒（Wake on multicast activity）</li><li>b -- 广播消息唤醒（Wake on broadcast activity）</li><li>a -- ARP 唤醒（Wake on ARP activity）</li><li>g -- 特定数据包唤醒（magic packet activity）</li></ul><p>修改 wol 功能：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">ethtool</span> <span class="token parameter variable">-s</span> eno1 wol g</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">ethtool</span> eno1 <span class="token operator">|</span> <span class="token function">grep</span> Wake-on</pre></td></tr><tr><td data-num="3"></td><td><pre>        Supports Wake-on: pumbg</pre></td></tr><tr><td data-num="4"></td><td><pre>        Wake-on: g</pre></td></tr></table></figure><p>此刻已经开启 magic packet 唤醒了，然后执行 <code>ip a</code> 查看网卡的 mac 地址和 ip 并记录，再写入 <code>echo mem &gt; /sys/power/state</code> ，让系统进入休眠，再在另一台主机测试网络唤醒。</p><ul><li><p>Windows</p><p>可以选择该工具使用：<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGVwaWN1cy5jb20vd2FrZS1vbi1sYW4vd2FrZS1vbi1sYW4tY21k">Wake On Lan Command Line</span> 。</p></li><li><p>Linux</p><p>可以安装对应的 pack 包（eg：etherwake），这里就不多说了。</p></li></ul><p>当你能成功唤醒后，就证明你的主板支持，bios 上的 wol 有启用，系统配置上也打开了。</p><p>最后，对于部分系统，可能有些在设置完显示 <code>Wake-on: g</code> 后，重启会变回默认配置，这时可以编写一个开机启动服务：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">vim</span> /etc/systemd/system/wol@.service</pre></td></tr></table></figure><p>添加如下内容：</p><figure class="highlight wiki"><figcaption data-lang="Wiki markup"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token url">[Unit]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Description=Wake-on-LAN for %i</pre></td></tr><tr><td data-num="3"></td><td><pre>Requires=network.target</pre></td></tr><tr><td data-num="4"></td><td><pre>After=network.target</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token url">[Service]</span></pre></td></tr><tr><td data-num="7"></td><td><pre>ExecStart=/usr/bin/ethtool -s %i wol g</pre></td></tr><tr><td data-num="8"></td><td><pre>Type=oneshot</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token url">[Install]</span></pre></td></tr><tr><td data-num="11"></td><td><pre>WantedBy=multi-user.target</pre></td></tr></table></figure><p>然后 [Install] 区块中的 <code>WantedBy</code> 字段，是表示该服务所在的 Target。如 <code>WantedBy=multi-user.target</code> 指的是该服务所属于 <code>multi-user.target</code> ；当执行 <code>systemctl enable xxx.service</code> 命令时， <code>xxx.service</code> 的符号链接就会被创建在 <code>/etc/systemd/system/multi-user.target</code> 目录下。可以通过 <code>systemctl get-default</code> 命令查看系统默认启动的 target，一般为 <code>multi-user</code> 或者是 <code>graphical</code> 。因此配置好相应的 <code>WantedBy</code> 字段，可以实现服务的开机启动。</p><p><code>multi-user.target</code> 表示多用户命令行状态； <code>graphical.target</code> 表示图形用户状态，它依赖于 <code>multi-user.target</code> 。官方文档有一张非常清晰的 [Target 依赖关系图](<span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZWRlc2t0b3Aub3JnL3NvZnR3YXJlL3N5c3RlbWQvbWFuL2Jvb3R1cC5odG1sI1N5c3RlbQ==">https://www.freedesktop.org/software/systemd/man/bootup.html#System</span> Manager Bootup)。</p><p>嘛，如果你是用图形界面的，也是可以用 <code>multi-user.target</code> 的，因为 <code>graphical.target</code> 依赖 <code>multi-user.target</code> ，可以利用命令 <code>systemctl list-units --type=target</code> 查看到 <code>multi-user.target</code> 是处于 Active 状态的。</p><p>最后，重新加载所有的 systemd 服务，打开自启动并启动服务，其中 <code>@</code> 后面跟随的是你的 wol 网卡名称：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> systemctl daemon-reload</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> wol@eno1</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">sudo</span> systemctl start wol@eno1</pre></td></tr></table></figure><p>note：</p><p>对于 systemd 服务的控制，可以使用如下命令：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>systemctl <span class="token punctuation">[</span>command<span class="token punctuation">]</span> <span class="token punctuation">[</span>unit<span class="token punctuation">]</span></pre></td></tr></table></figure><p>[command]：</p><ul><li><p>start：立刻启动后面接的 unit。</p></li><li><p>stop：立刻关闭后面接的 unit。</p></li><li><p>restart：立刻关闭后启动后面接的 unit，亦即执行 stop 再 start 的意思。</p></li><li><p>reload：不关闭 unit 的情况下，重新载入配置文件，让设置生效。</p></li><li><p>enable：设置下次开机时，后面接的 unit 会被启动。</p></li><li><p>disable：设置下次开机时，后面接的 unit 不会被启动。</p></li><li><p>status：目前后面接的这个 unit 的状态，会列出有没有正在执行、开机时是否启动等信息。</p></li><li><p>is-active：目前有没有正在运行中。</p></li><li><p>is-enable：开机时有没有默认要启用这个 unit。</p></li><li><p>kill ：不要被 kill 这个名字吓着了，它其实是向运行 unit 的进程发送信号。</p></li><li><p>show：列出 unit 的配置。</p></li><li><p>mask：注销 unit，注销后你就无法启动这个 unit 了。</p></li><li><p>unmask：取消对 unit 的注销。</p></li></ul><p>一些其它命令：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>systemctl poweroff <span class="token comment"># 系统关机</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>systemctl <span class="token function">reboot</span> <span class="token comment"># 重新开机</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>systemctl <span class="token function">suspend</span> <span class="token comment"># 进入暂停模式</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>systemctl hibernate <span class="token comment"># 进入休眠模式</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>systemctl rescue <span class="token comment"># 强制进入救援模式</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>systemctl emergency <span class="token comment"># 强制进入紧急救援模式</span></pre></td></tr></table></figure><p>资料：</p><p><span class="exturl" data-url="aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvV2FrZS1vbi1MQU4=">https://wiki.archlinux.org/title/Wake-on-LAN</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93aWtpLmRlYmlhbi5vcmcvV2FrZU9uTGFu">https://wiki.debian.org/WakeOnLan</span></p><h2 id="异常记录查看"><a class="anchor" href="#异常记录查看">#</a> 异常记录查看</h2><p>使用 <code>last -x shutdown reboot</code> 命令可以查看系统的关机和重启记录，包括异常关机。该命令会显示每次关机或重启的时间、持续时间。</p><p>使用 <code>dmesg | grep &quot;shutdown&quot;</code> 命令可以查看内核的消息缓冲区，筛选出关机的相关信息。</p><p>参考：</p><p><span class="exturl" data-url="aHR0cHM6Ly91bml4LnN0YWNrZXhjaGFuZ2UuY29tL3F1ZXN0aW9ucy85ODE5L2hvdy10by1maW5kLW91dC1mcm9tLXRoZS1sb2dzLXdoYXQtY2F1c2VkLXN5c3RlbS1zaHV0ZG93bg==">https://unix.stackexchange.com/questions/9819/how-to-find-out-from-the-logs-what-caused-system-shutdown</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4MzQ1NjU3L2FydGljbGUvZGV0YWlscy8xMjY4MzMxMzE=">https://blog.csdn.net/qq_28345657/article/details/126833131</span></p><h2 id="系统备份"><a class="anchor" href="#系统备份">#</a> 系统备份</h2><p>linux 系统说白了就是一个强大的文件系统，既然是文件，哪能不能像日常备份文件那样直接压缩备份呢？答案是可以，只是在备份压缩的时候注意把各个文件的权限都保留下来。</p><p>在备份之前先了解一下 linux 的系统目录结构：</p><table><thead><tr><th>文件夹</th><th>英文全称</th><th>文件夹作用</th></tr></thead><tbody><tr><td>/boot</td><td>Boot</td><td>存放的启动 Linux 时使用的内核文件，包括连接文件以及镜像文件。</td></tr><tr><td>/bin</td><td>Binaries</td><td>存放着最常用的程序和指令，所有用户都可以执行。是 <code>/usr/bin</code> 目录的软连接。</td></tr><tr><td>/sbin</td><td>Super User Binaries</td><td>保存和系统环境设置相关的命令，只有超级用户可以使用这些命令，有些命令可以允许普通用户查看。是 <code>/usr/sbin</code> 目录的软连接。</td></tr><tr><td>/usr</td><td>Unix Software Resources</td><td>用户的很多应用程序和文件都放在这个目录下，类似于 windows 下的 program files 目录。</td></tr><tr><td>/usr/bin</td><td>Unix Software Resources Binaries</td><td>系统用户使用的应用程序与指令。</td></tr><tr><td>/usr/sbin</td><td>Unix Software Resources Superuser Binaries</td><td>超级用户使用的比较高级的管理程序和系统守护程序。</td></tr><tr><td>/usr/local</td><td>Unix Software Resources Local</td><td>安装第三方软件的安装目录，一般是通过编译源码的方式安装的程序。</td></tr><tr><td>/usr/src</td><td>Unix Software Resources Source</td><td>内核源代码默认的放置目录。</td></tr><tr><td>/dev</td><td>Devices</td><td>存放的是 Linux 的外部设备。注意：在 Linux 中访问设备和访问文件的方式是相同的。</td></tr><tr><td>/etc</td><td>Editable Text Configuration Chest</td><td>存放所有的系统需要的配置文件和子目录列表，更改目录下的文件可能会导致系统不能启动。</td></tr><tr><td>/opt</td><td>Optional Application Software Packages</td><td>可选应用软件包，第三方安装的软件保存位置，存放软件安装包。</td></tr><tr><td>/lib</td><td>Library</td><td>存放基本代码库（比如 c++ 库），其作用类似于 Windows 里的 DLL 文件。几乎所有的应用程序都需要用到这些共享库。</td></tr><tr><td>/proc</td><td>Processes</td><td>虚拟文件系统，数据保存在内存中，存放当前进程信息</td></tr><tr><td>/root</td><td>Root</td><td>系统管理员的用户主目录。</td></tr><tr><td>/tmp</td><td>Temporary</td><td>存放临时文件</td></tr><tr><td>/var</td><td>Variable</td><td>存放经常修改的数据，比如程序运行的日志文件（ <code>/var/log</code> 目录下）。</td></tr><tr><td>/home</td><td>Home</td><td>用户缺省宿主目录。</td></tr><tr><td>/lost+found</td><td>Lost And Found</td><td>一般情况下为空的，存放一些系统出错的检查结果</td></tr><tr><td>/srv</td><td>Server</td><td>服务数据目录</td></tr><tr><td>/sys</td><td>System</td><td>这是 linux2.6 内核的一个很大的变化。该目录下安装了 2.6 内核中新出现的一个文件系统 sysfs。sysfs 文件系统集成了下面 3 种文件系统的信息：针对进程信息的 proc 文件系统、针对设备的 devfs 文件系统以及针对伪终端的 devpts 文件系统。该文件系统是内核设备树的一个直观反映。当一个内核对象被创建的时候，对应的文件和目录也在内核对象子系统中。</td></tr><tr><td>/mnt</td><td>Mount</td><td>挂载目录。临时文件系统的安装点，默认挂载光驱和软驱的目录</td></tr><tr><td>/media</td><td>Media</td><td>挂载目录。 挂载媒体设备，如软盘和光盘</td></tr><tr><td>/misc</td><td>Miscellaneous Device</td><td>挂载目录。 挂载 NFS 服务</td></tr><tr><td>/run</td><td>Run</td><td>里面的东西是系统运行时需要的，不能随便删除。当系统重启时，这个目录下的文件应该被删掉或清除；下次系统运行时重新生成。</td></tr></tbody></table><p>备份系统：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">su</span> -</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">cd</span> /</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">tar</span> <span class="token parameter variable">-zcvpf</span> backup.tgz <span class="token parameter variable">--exclude</span><span class="token operator">=</span>/proc <span class="token parameter variable">--exclude</span><span class="token operator">=</span>/lost+found <span class="token parameter variable">--exclude</span><span class="token operator">=</span>/backup.tgz <span class="token parameter variable">--exclude</span><span class="token operator">=</span>/mnt <span class="token parameter variable">--exclude</span><span class="token operator">=</span>/sys <span class="token parameter variable">--exclude</span><span class="token operator">=</span>/media /</pre></td></tr></table></figure><h1 id="安装-openmediavault-6x"><a class="anchor" href="#安装-openmediavault-6x">#</a> 安装 openmediavault 6.x</h1><p>在操作如下流程前，要进行备份！备份！备份！</p><p>具体安装以 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm9wZW5tZWRpYXZhdWx0Lm9yZy9lbi9sYXRlc3QvaW5zdGFsbGF0aW9uL29uX2RlYmlhbi5odG1s">https://docs.openmediavault.org/en/latest/installation/on_debian.html</span> 为准。</p><p>1、临时配置环境变量</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">DEBIAN_FRONTEND</span><span class="token operator">=</span>noninteractive</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">APT_LISTCHANGES_FRONTEND</span><span class="token operator">=</span>none</pre></td></tr></table></figure><p>2、添加软件包存储库</p><p>进入文件编辑：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">vim</span> /etc/apt/sources.list.d/openmediavault.list</pre></td></tr></table></figure><p>然后粘贴以下存储库链接（这里使用的是 <span class="exturl" data-url="aHR0cHM6Ly9taXJyb3JzLmJmc3UuZWR1LmNuL2hlbHAvb3Blbm1lZGlhdmF1bHQv">北外镜像</span>，以加快国内访问速度，当然你也可以使用源链接），保存退出：</p><figure class="highlight wiki"><figcaption data-lang="Wiki markup"></figcaption><table><tr><td data-num="1"></td><td><pre>deb https://mirrors.bfsu.edu.cn/OpenMediaVault/public shaitan main</pre></td></tr><tr><td data-num="2"></td><td><pre>deb https://mirrors.bfsu.edu.cn/OpenMediaVault/packages shaitan main</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">#</span><span class="token punctuation">#</span> Uncomment the following line to add software from the proposed repository.</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">#</span> deb https://mirrors.bfsu.edu.cn/OpenMediaVault/public shaitan-proposed main</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">#</span> deb https://mirrors.bfsu.edu.cn/OpenMediaVault/packages shaitan-proposed main</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">#</span><span class="token punctuation">#</span> This software is not part of OpenMediaVault, but is offered by third-party</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">#</span><span class="token punctuation">#</span> developers as a service to OpenMediaVault users.</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">#</span> deb https://mirrors.bfsu.edu.cn/OpenMediaVault/public shaitan partner</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">#</span> deb https://mirrors.bfsu.edu.cn/OpenMediaVault/packages shaitan partner</pre></td></tr></table></figure><p>3、添加 openmediavault 密钥</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">--yes</span> gnupg</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">wget</span> <span class="token parameter variable">--quiet</span> --output-document<span class="token operator">=</span>- https://packages.openmediavault.org/public/archive.key <span class="token operator">|</span> gpg <span class="token parameter variable">--dearmor</span> <span class="token parameter variable">--yes</span> <span class="token parameter variable">--output</span> <span class="token string">"/usr/share/keyrings/openmediavault-archive-keyring.gpg"</span></pre></td></tr></table></figure><p>4、更新软件包源并安装 omv</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">apt-get</span> update</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">apt-get</span> <span class="token parameter variable">--yes</span> --auto-remove --show-upgraded <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    --allow-downgrades --allow-change-held-packages <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    --no-install-recommends <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token parameter variable">--option</span> DPkg::Options::<span class="token operator">=</span><span class="token string">"--force-confdef"</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token parameter variable">--option</span> DPkg::Options::<span class="token operator">=</span><span class="token string">"--force-confold"</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">install</span> openmediavault</pre></td></tr></table></figure><p>5、同步系统配置</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>omv-confdbadm populate</pre></td></tr></table></figure><p>note：</p><p>对于网络服务，现在只解析 <code>/etc/network/interfaces</code> 以获取当前的网络配置。 如果以不同的方式配置网络（例如通过 <code>systemd</code> 或 <code>NetworkManager</code> ），则不会填充数据库，并且不包含使用 <code>netplan for systemd-networkd 和 systemd-resolved</code> 部署网络配置所需的信息。 在这种情况下，请使用 <code>omv-firstaid</code> 命令执行初始网络配置。</p><p>如果想通过 openmediavault 使用的服务重新部署网络配置，则执行：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">vim</span> /etc/network/interfaces</pre></td></tr></table></figure><p>然后把里面的网卡配置用 <code>#</code> 注释掉，接着：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">rm</span> /etc/systemd/network/*</pre></td></tr><tr><td data-num="2"></td><td><pre>netplan apply</pre></td></tr><tr><td data-num="3"></td><td><pre>omv-salt deploy run systemd-networkd</pre></td></tr></table></figure><h2 id="omv6-基本配置"><a class="anchor" href="#omv6-基本配置">#</a> omv6 基本配置</h2><h2 id="用户账户设置"><a class="anchor" href="#用户账户设置">#</a> 用户账户设置</h2><p>安装完 omv 后，如果有使用 <code>同步系统配置</code> 操作，那么，在 <code>用户</code> -&gt; <code>用户</code> 管理中可以看到前面安装系统时创建的用户，之后，你可以在这里创建或修改各类用户；为了安全你也可以删除掉 root 用户，以避免 root 登录，需要注意权限问题，避免登录 omv web 无法操作。</p><p>note：如果存在多个用户，在众多用户里，至少要有一个用户添加到 <code>openmediavault-admin</code> 的 <code>ssh group</code> 中，这将决定在登录 omv web 后是否拥有配置操作，否则任意用户登录 omv web 上都不存完整的配置操作。具体可看 <strong>omv 登陆后界面只剩仪表盘</strong> 。</p><h2 id="配置-ssh"><a class="anchor" href="#配置-ssh">#</a> 配置 SSH</h2><p>进入 <code>服务</code> -&gt; <code>SSH</code> ，选择勾选 <code>已启用</code> 选项，接着按个人需求修改配置，同时为能 SSH 登录操作的用户添加到 <code>ssh group</code> ；如果你想为了安全，而选择关闭 <code>允许 root 登陆</code> 和 <code>密码验证</code> 选项，那么需要注意的是，至少要为一个用户添加 <code>ssh group</code> ，否则将没有用户可以登录 SSH，同时为用户配置好 SSH 密钥对。</p><p>note：SSH 密钥对生成，需要先在本机系统中（即需要控制的机器上，一般就是我们的 windows 系统上），输入 <code>ssh-keygen</code> 命令，然后输入存储的路径及命名 <code>~/.ssh/omv-id_rsa</code> ，如果需要为调用私钥而添加密码认证，则输入密码，否者直接留空回车，不设密码，最后再次确认回车，至此就生成了 SSH 密钥对了；紧接着在 omv web 的 <code>用户</code> -&gt; <code>用户</code> 中选择你需要进行 SSH 密钥登录的账户，然后编辑，在 <code>SSH 公钥</code> 中添加刚才生成的密钥对中的公钥（即 <code>omv-id_rsa.pub</code> ），至此就完成了。</p><h2 id="替换更新镜像源"><a class="anchor" href="#替换更新镜像源">#</a> 替换更新镜像源</h2><p>配置基本链接的镜像源（原因是在你安装完 omv 后，前面配置的软件包存储库链接将会修改为官方默认的链接，此时需要重新设置镜像）：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>omv-env <span class="token builtin class-name">set</span> OMV_APT_REPOSITORY_URL <span class="token string">"https://mirrors.bfsu.edu.cn/OpenMediaVault/public"</span></pre></td></tr><tr><td data-num="2"></td><td><pre>omv-env <span class="token builtin class-name">set</span> OMV_APT_ALT_REPOSITORY_URL <span class="token string">"https://mirrors.bfsu.edu.cn/OpenMediaVault/packages"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>omv-env <span class="token builtin class-name">set</span> OMV_APT_KERNEL_BACKPORTS_REPOSITORY_URL <span class="token string">"https://mirrors.bfsu.edu.cn/debian"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>omv-env <span class="token builtin class-name">set</span> OMV_APT_SECURITY_REPOSITORY_URL <span class="token string">"https://mirrors.bfsu.edu.cn/debian-security"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>omv-salt stage run all</pre></td></tr></table></figure><p>然后执行：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">apt</span> update</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">reboot</span></pre></td></tr></table></figure><p>重启后回到 omv 网页，你会看到有提示显示可以更新软件。</p><p>note：</p><p>对于使用 <code>omv-env set</code> 更换源，其实是在不同的 <code>openmediavault</code> 文件写入，这些文件可以在 <code>/etc/apt/sources.list.d/</code> 中找到。</p><h2 id="安装-omv-extras"><a class="anchor" href="#安装-omv-extras">#</a> 安装 omv-extras</h2><p>由于国内原因，防 github 解析错误，执行以下操作，如果这时候已经出现网络问题，则使用手动方法，查看 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLzUyMXh1ZXdlaWhhbi9HaXRIdWI1MjA=">GitHub520</span> ：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">"/# GitHub520 Host Start/Q"</span> /etc/hosts <span class="token operator">&amp;&amp;</span> <span class="token function">curl</span> https://raw.hellogithub.com/hosts <span class="token operator">>></span> /etc/hosts</pre></td></tr></table></figure><p>根据<span class="exturl" data-url="aHR0cHM6Ly93aWtpLm9tdi1leHRyYXMub3JnL2Rva3UucGhwP2lkPW9tdjY6bmV3X3VzZXJfZ3VpZGUjb212LWV4dHJhcw==">官方</span>提供，安装 omv-extras：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">wget</span> <span class="token parameter variable">-O</span> - https://github.com/OpenMediaVault-Plugin-Developers/packages/raw/master/install <span class="token operator">|</span> <span class="token function">bash</span></pre></td></tr></table></figure><p>然后刷新 omv 网页，即可在 <code>系统</code> 中找到 omv-extras。</p><p>如果网络不好可以手动安装：</p><ol><li>进入 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL09wZW5NZWRpYVZhdWx0LVBsdWdpbi1EZXZlbG9wZXJzL3BhY2thZ2Vz">https://github.com/OpenMediaVault-Plugin-Developers/packages</span> 下载对应的插件包，然后把插件包放到 omv 上，路径自己决定，然后进入该路径执行：</li></ol><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>dpkg <span class="token parameter variable">-i</span> openmediavault-omvextrasorg_xxx.deb</pre></td></tr></table></figure><p>更新 omv-extras 镜像源：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>omv-env <span class="token builtin class-name">set</span> OMV_EXTRAS_APT_REPOSITORY_URL <span class="token string">"https://mirrors.bfsu.edu.cn/OpenMediaVault/openmediavault-plugin-developers"</span></pre></td></tr><tr><td data-num="2"></td><td><pre>omv-env <span class="token builtin class-name">set</span> OMV_DOCKER_APT_REPOSITORY_URL <span class="token string">"https://mirrors.bfsu.edu.cn/docker-ce/linux/debian"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>omv-env <span class="token builtin class-name">set</span> OMV_PROXMOX_APT_REPOSITORY_URL <span class="token string">"https://mirrors.bfsu.edu.cn/proxmox/debian"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>omv-salt stage run all</pre></td></tr></table></figure><h2 id="安装-docker"><a class="anchor" href="#安装-docker">#</a> 安装 docker</h2><p>进入 <code>系统</code> -&gt; <code>插件</code> ，搜索 <code>compose</code> ，点击选择下载，然后等待下载完成；</p><p>进入 <code>系统</code> -&gt; <code>omv-extras</code> ，勾选 <code>Docker repo</code> ，点保存；</p><p>最后在 <code>服务</code> -&gt; <code>Compose</code> 中可以找到 <code>设置</code> ，查看 Docker 状态是否为 <code>Installed and running</code> ，如果不是，可以尝试重启 Docker 或者重新安装 Docker；再不行就回到第二点先取消勾选接着保存，然后再把 <code>Docker repo</code> 勾选上保存并重复后面操作。</p><p>参考：<span class="exturl" data-url="aHR0cHM6Ly93aWtpLm9tdi1leHRyYXMub3JnL2Rva3UucGhwP2lkPW9tdjY6ZG9ja2VyX2luX29tdiNkb2t1d2lraV9fdG9w">https://wiki.omv-extras.org/doku.php?id=omv6:docker_in_omv#dokuwiki__top</span></p><p>如果 Docker 无法运行，输入 <code>systemctl status docker</code> 查看状态，然后再执行 <code>systemctl restart docker</code> 看是否成功，如果显示如下错误：</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>Job for docker.service failed because the control process exited with error code.</pre></td></tr><tr><td data-num="2"></td><td><pre>See "systemctl status docker.service" and "journalctl -xe" for details.</pre></td></tr></table></figure><p>可以使用命令 <code>journalctl -xe</code> 和 <code>dockerd --debug</code> 来分析无法运行的错误。</p><p>参考：<span class="exturl" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNTU5MDY1MDMvZG9ja2VyLWhvdy10by1maXgtam9iLWZvci1kb2NrZXItc2VydmljZS1mYWlsZWQtYmVjYXVzZS10aGUtY29udHJvbC1wcm9jZXNzLWV4">https://stackoverflow.com/questions/55906503/docker-how-to-fix-job-for-docker-service-failed-because-the-control-process-ex</span></p><h3 id="docker-换源"><a class="anchor" href="#docker-换源">#</a> docker 换源</h3><p>编辑 <code>/etc/docker/daemon.json</code> 配置文件：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">vim</span> /etc/docker/daemon.json</pre></td></tr></table></figure><p>更改为以下信息：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"data-root"</span><span class="token operator">:</span><span class="token string">"/var/lib/docker"</span><span class="token punctuation">,</span> <span class="token comment">//docker 存储路径</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"registry-mirrors"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token string">"https://docker.mirrors.ustc.edu.cn"</span> <span class="token comment">// 更改换源</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>note：如果是在 <code>/etc/docker/daemon.json</code> 文件上指定 Docker 存储路径，那么，在 <code>服务</code> -&gt; <code>Compose</code> -&gt; <code>设置</code> -&gt; <code>Docker</code> 中的 <code>Docker 存储</code> 上留空配置（该下方有备注说明）。</p><p>最后，使用如下命令重启生效：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>systemctl daemon-reload</pre></td></tr><tr><td data-num="2"></td><td><pre>systemctl restart <span class="token function">docker</span></pre></td></tr></table></figure><p>完成后使用 <code>docker info</code> 命令，查看 <code>Registry Mirrors:</code> 是否为配置的镜像源。</p><h3 id="安装管理面板"><a class="anchor" href="#安装管理面板">#</a> 安装管理面板</h3><p>如果你喜欢敲命令来操作 Docker，那么这点你可以跳过了，否则可以安装 portainer 对 Docker 进行页面管理。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 拉取汉化版镜像</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">docker</span> pull <span class="token number">6053537</span>/portainer-ce:latest</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 启动容器</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token parameter variable">--name</span> portainer <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token parameter variable">-p</span> <span class="token number">9000</span>:9000 <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token parameter variable">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token parameter variable">-v</span> /app/portainer_data:/data <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token parameter variable">--restart</span> always <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token number">6053537</span>/portainer-ce:latest</pre></td></tr></table></figure><p>note：在 <code>docker run</code> 执行后面加入 <code>--restart=always</code> 可以使开机后会自动启动面板，否者还要自己连到设备启动。</p><p>最后通过访问 <code>http://localhost:9000</code> 来访问 portainer 的 Web 界面。</p><h2 id="安装-komga-漫画管理"><a class="anchor" href="#安装-komga-漫画管理">#</a> 安装 komga 漫画管理</h2><p>为你的 komga 存放创建数据和配置目录：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># $PATH 为你存储盘的路径</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /<span class="token operator">&lt;</span><span class="token environment constant">$PATH</span><span class="token operator">></span>/komga/config /<span class="token operator">&lt;</span><span class="token environment constant">$PATH</span><span class="token operator">></span>/komga/data</pre></td></tr></table></figure><p>根据官方提示，输入如下命令：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> /<span class="token environment constant">$PATH</span>/</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">docker</span> pull gotson/komga:latest</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token parameter variable">--name</span> komga <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token parameter variable">-v</span> /<span class="token operator">&lt;</span><span class="token environment constant">$PATH</span><span class="token operator">></span>/komga/data:/data <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token parameter variable">-v</span> /<span class="token operator">&lt;</span><span class="token environment constant">$PATH</span><span class="token operator">></span>/komga/config:/config <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token parameter variable">-p</span> <span class="token number">25600</span>:25600 <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token parameter variable">-e</span> <span class="token assign-left variable">TZ</span><span class="token operator">=</span>Asia/Shanghai <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token parameter variable">--restart</span> always <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token parameter variable">--user</span> <span class="token string">"0:0"</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  gotson/komga</pre></td></tr></table></figure><p>参数解释：</p><ul><li><code>-d</code> ：以后台模式运行容器。</li><li><code>--name komga</code> ：设置容器的名称为 <code>komga</code> 。</li><li><code>-v $(pwd)/data:/data</code> 和 <code>-v $(pwd)/config:/config</code> ：将主机的当前目录下的 <code>data</code> 和 <code>config</code> 目录分别映射到容器的 <code>/data</code> 和 <code>/config</code> 路径，用于数据和配置的持久化。</li><li><code>-p 25600:25600</code> ：将容器的 25600 端口映射到主机的 25600 端口，使得 Komga 的 Web 界面可以通过主机的端口访问。</li><li><code>-e TZ=Asia/Shanghai</code> ：设置容器的环境变量 <code>TZ</code> ，用于指定时区。</li><li><code>--restart always</code> ：确保容器在退出时自动重启。</li><li><code>--user &quot;0:0&quot;</code> ：以 root 用户运行容器，这对于某些环境的权限管理是必要的。</li><li><code>gotson/komga</code> ：指定使用的 Docker 镜像。</li></ul><p>最后通过访问 <code>http://localhost:25600</code> 来访问 Komga 的 Web 界面。</p><p>note：用 docker 容器安装的话，在 <code>添加库</code> 时选择的根文件夹填写的是容器内部的路径（即上面的 <code>/data</code> 目录下）。</p><p>拓展：<span class="exturl" data-url="aHR0cHM6Ly93d3cuaGltaWt1LmNvbS9hcmNoaXZlcy9rb21nYS5odG1s">https://www.himiku.com/archives/komga.html</span></p><h2 id="创建-raid-软阵列"><a class="anchor" href="#创建-raid-软阵列">#</a> 创建 Raid 软阵列</h2><p>在这里，不选择在 omv 页面上创建，而是使用命令创建。以 Raid 1 为例：</p><ol><li><p>准备两个硬盘，最好使用同型号的不同批次跟产期的，如果选择不同型号的，那么要考虑转速、缓存、容量这些尽可能一致。</p></li><li><p><code>lsblk</code> 获取需要建立 Raid 的磁盘名称 <code>sdx</code> （sdx 可以为 sda、sdb 等）。</p></li><li><p>使用 <code>fdisk /dev/sdx</code> 分别为两块磁盘创建单一分区。</p><ul><li><code>m</code> ：查看命令操作。</li><li><code>d</code> ：删除已有分区。</li><li><code>n</code> ：创建新的分区。</li><li><code>p</code> ：查看创建分区。</li><li><code>w</code> ：应用分区信息。</li></ul><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>按 n 创建新的分区。</pre></td></tr><tr><td data-num="2"></td><td><pre>然后按 p 选择主分区。</pre></td></tr><tr><td data-num="3"></td><td><pre>接下来选择分区号为 1。</pre></td></tr><tr><td data-num="4"></td><td><pre>按两次回车键默认将整个容量分配给它。</pre></td></tr><tr><td data-num="5"></td><td><pre>然后，按 p 来打印创建好的分区。</pre></td></tr><tr><td data-num="6"></td><td><pre>按 l，列出所有可用的类型。</pre></td></tr><tr><td data-num="7"></td><td><pre>按 t 修改分区类型。</pre></td></tr><tr><td data-num="8"></td><td><pre>键入 29 设置为 Linux 的 RAID 类型，然后按 Enter 确认。</pre></td></tr><tr><td data-num="9"></td><td><pre>然后再次使用 p 查看我们所做的更改。</pre></td></tr><tr><td data-num="10"></td><td><pre>使用 w 保存更改。</pre></td></tr></table></figure></li><li><p>利用 <code>mdadm</code> 命令建立 Raid 软阵列。</p><ul><li><p>检查 sdx 分区并确认 Raid 分区的类型 <code>mdadm -E /dev/sdx</code> 。</p></li><li><p>假设用 <code>dev/sdb1</code> 和 <code>dev/sdc1</code> 两个磁盘创建一个名为 <code>/dev/md0</code> 的 Raid 1 设备 <code>mdadm --create /dev/md0 --level=1 --raid-device=2 /dev/sd[b-c]1</code> 。</p></li><li><p>查看 Raid 同步状态 <code>cat /proc/mdstat</code> 。初次建立构建，需要很长一段时间。可以通过以下命令调整 Raid 同步速度：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sysctl</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">dev.raid.speed_limit_max</span><span class="token operator">=</span><span class="token number">2000000</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">sysctl</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">dev.raid.speed_limit_min</span><span class="token operator">=</span><span class="token number">100000</span></pre></td></tr></table></figure></li><li><p>使用 <code>mdadm -E /dev/sdx1</code> 分别查看 Raid 设备类型。</p></li><li><p>为 <code>dev/md0</code> 创建 ext4 文件系统 <code>mkfs.ext4 /dev/md0</code> ，最好等初始化构建完成后操作。</p></li><li><p>检查 Raid 信息 <code>mdadm -D /dev/md0</code> 。</p></li></ul></li></ol><p>常见的 RAID 磁盘阵列：</p><table><thead><tr><th>阵列</th><th>描述</th><th>特点</th></tr></thead><tbody><tr><td>JBOD（线性）</td><td>JBOD 不是标准的 RAID 级别，它只是在近几年才被一些厂家提出，并被广泛采用。虽然 JBOD 让多个磁盘看来似乎只有一个，但它是通过把多个驱动器合并成一个大的逻辑磁盘来做到这一点的。</td><td>- 任意一块硬盘损坏，整个 JBOD 都无法使用。&lt;br/&gt;- 未损坏的硬盘上的数据不会丢失，但恢复数据存在门槛。</td></tr><tr><td>RAID 0</td><td>RAID 0 是组建磁盘阵列中最简单的一种形式，只需要 2 块以上的硬盘即可。 RAID 0 是 RAID 磁盘阵列中性能最好的硬盘组合方式，但没有提供冗余或错误修复能力。</td><td>按照一定规则，将文件拆分存储在 RAID 0 中，一旦一块硬盘损坏，整个 RAID 0 的所有数据全部丢失。</td></tr><tr><td>RAID 1（镜像）</td><td>RAID 1 称为磁盘镜像，由至少 2 块硬盘组成。原理是把一个磁盘的数据镜像到另一个磁盘上，也就是说数据在写入一块磁盘的同时，会在另一块闲置的磁盘上生成镜像文件。只要系统中任何一对镜像盘中至少有一块磁盘可以使用，甚至可以在一半数量的硬盘出现问题时系统都可以正常运行。它是 RAID 磁盘阵列中性能最差，数据安全性最佳的。</td><td>会损失一半硬盘容量。</td></tr><tr><td>RAID 5</td><td>RAID 5 被称为 “分布式奇偶校验的独立磁盘结构” ，需最低 3 块硬盘组成。&lt;br/&gt; 每在 RAID 5 中存入一个文件，3 块硬盘中：1 块用于存储该文件；2 块用于生成奇偶校验信息。</td><td>只要 RAID 5 中只有 1 块硬盘损坏，就可以替换该硬盘并恢复数据；会损失 1 块硬盘容量。</td></tr><tr><td>RAID 6</td><td>RAID 6 是对 RAID 5 的扩展，需最低 4 块硬盘组成。&lt;br/&gt; 每在 RAID 6 中存入一个文件，4 块硬盘中：2 块用于存储该文件；2 块用于生成奇偶校验信息。</td><td>只要 RAID 6 中有任意 2 块硬盘损坏，就可以替换这 2 块硬盘并恢复数据；会损失 2 块硬盘容量。</td></tr><tr><td>RAID 10</td><td>RAID 10 需要至少 4 块硬盘组成，每 2 块硬盘组成一个 RAID 1 ，2 个 RAID 1 组成一个 RAID 0 。性能与安全性在 RAID 0 和 RAID 1 中取得了一个平衡。</td><td>性能比 RAID 0 差，比 RAID 1 高；安全性同于 RAID 1 。</td></tr></tbody></table><p>扩展：</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vZmVsaXgtenAvcC85NzM4NzI0Lmh0bWw=">https://www.cnblogs.com/felix-zp/p/9738724.html</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZmx5c2ZlcS5zaXRlL2luZGV4LnBocC9hcmNoaXZlcy82NS8=">https://www.flysfeq.site/index.php/archives/65/</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vMzd5YW4vcC83NDg5NTk3Lmh0bWw=">https://www.cnblogs.com/37yan/p/7489597.html</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbHBmdXR1cmUvcC82Mzg1NjU3Lmh0bWw=">https://www.cnblogs.com/lpfuture/p/6385657.html</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC1hdGxhcy5yZWFkdGhlZG9jcy5pby96aC1jbi9sYXRlc3QvbGludXgvc3RvcmFnZS9zb2Z0d2FyZV9yYWlkL3JhaWQtY2hlY2suaHRtbA==">https://cloud-atlas.readthedocs.io/zh-cn/latest/linux/storage/software_raid/raid-check.html</span></p><h2 id="安装-gitea-代码管理"><a class="anchor" href="#安装-gitea-代码管理">#</a> 安装 gitea 代码管理</h2><p>为你的 gitea 存放创建数据和配置目录：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># $PATH 为你存储盘的路径</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /<span class="token operator">&lt;</span><span class="token environment constant">$PATH</span><span class="token operator">></span>/gitea/data</pre></td></tr></table></figure><p>运行 Docker：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> pull gitea/gitea:latest</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token parameter variable">--name</span> gitea <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token parameter variable">-v</span> /<span class="token operator">&lt;</span><span class="token environment constant">$PATH</span><span class="token operator">></span>/gitea/data:/data <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token parameter variable">-v</span> /etc/timezone:/etc/timezone:ro <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token parameter variable">-v</span> /etc/localtime:/etc/localtime:ro <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token parameter variable">-p</span> <span class="token number">3000</span>:3000 <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token parameter variable">-p</span> <span class="token number">2220</span>:22 <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token parameter variable">--restart</span> always <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  gitea/gitea</pre></td></tr></table></figure><p>官方安装：<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmdpdGVhLmNvbS96aC1jbi9pbnN0YWxsYXRpb24vaW5zdGFsbC13aXRoLWRvY2tlcg==">https://docs.gitea.com/zh-cn/installation/install-with-docker</span></p><h2 id="安装-calibre-web-图书管理"><a class="anchor" href="#安装-calibre-web-图书管理">#</a> 安装 calibre-web 图书管理</h2><p>为你的 calibre-web 存放创建数据和配置目录：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># $PATH 为你存储盘的路径</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /<span class="token operator">&lt;</span><span class="token environment constant">$PATH</span><span class="token operator">></span>/calibre/config /<span class="token operator">&lt;</span><span class="token environment constant">$PATH</span><span class="token operator">></span>/calibre/book</pre></td></tr></table></figure><p>运行 Docker：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> pull ghcr.io/gshang2017/calibre-web:latest</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token parameter variable">--name</span><span class="token operator">=</span>calibre-web <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token parameter variable">-e</span> <span class="token assign-left variable">PUID</span><span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token parameter variable">-e</span> <span class="token assign-left variable">PGID</span><span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token parameter variable">-e</span> <span class="token assign-left variable">TZ</span><span class="token operator">=</span>Asia/Shanghai <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token parameter variable">-e</span> <span class="token assign-left variable">DOCKER_MODS</span><span class="token operator">=</span>linuxserver/calibre-web:calibre <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token parameter variable">-p</span> <span class="token number">8083</span>:8083 <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token parameter variable">-v</span> /<span class="token operator">&lt;</span><span class="token environment constant">$PATH</span><span class="token operator">></span>/calibre/config:/config <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token parameter variable">-v</span> /<span class="token operator">&lt;</span><span class="token environment constant">$PATH</span><span class="token operator">></span>/calibre/library:/books <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token parameter variable">--restart</span> always <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  ghcr.io/gshang2017/calibre-web</pre></td></tr></table></figure><h1 id="other"><a class="anchor" href="#other">#</a> other</h1><h2 id="omv-登陆后界面只剩仪表盘"><a class="anchor" href="#omv-登陆后界面只剩仪表盘">#</a> omv 登陆后界面只剩仪表盘</h2><p>一般会出现这种情况是因为更换了用户，但管理权限没有给过去，或者以非管理员登录等，总之就是登录用户没有足够的权限，如果你还禁止了 root 登录，那么你可以使用如下命令把权限给到你要登录的用户 <code>USER_NAME</code> 上：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> <span class="token function">usermod</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-G</span> openmediavault-admin USER_NAME</pre></td></tr></table></figure><p>参考：<span class="exturl" data-url="aHR0cHM6Ly9mb3J1bS5vcGVubWVkaWF2YXVsdC5vcmcvaW5kZXgucGhwP3RocmVhZC80NTQ0My1vbXY2LXdlYi1ndWktb25seS13aXRoLWRhc2hib2FyZC1sb3N0LWV2ZXJ5dGhpbmctYW5kLWktbS1hZG1pbi11c2VyLw==">https://forum.openmediavault.org/index.php?thread/45443-omv6-web-gui-only-with-dashboard-lost-everything-and-i-m-admin-user/</span></p><h2 id="devdm-文件系统"><a class="anchor" href="#devdm-文件系统">#</a> /dev/dm-* 文件系统</h2><p>dm 是 Device Mapper 的缩写，Device Mapper 是 Linux 2.6 内核中提供的一种从逻辑设备到物理设备的映射框架机制，在该机制下，用户可以很方便的根据自己的需要制定实现存储资源的管理策略，当前比较流行的 Linux 下的逻辑卷管理器如 LVM2（Linux Volume Manager 2 version)、EVMS (Enterprise Volume Management System)、dmraid (Device Mapper Raid Tool) 等都是基于该机制实现的。</p><p>既然是映射，那么就有对应关系，那到底对应着什么，可以使用如下命令查看：</p><ol><li><code>dm-*</code> 一般是在 <code>/dev</code> 文件夹里，而且还不止一个，可以使用 <code>ls /dev/dm*</code> 查看所有 <code>dm</code> 设备映射。</li><li>使用命令 <code>dmsetup ls</code> 查看 <code>dm-*</code> 对应的设备，其中 <code>dm</code> 后面的数字对应（xxx， xx）里的第二个数字。如果想详细查看信息，可以使用 <code>dmsetup info</code> 命令，而 <code>Major, minor:</code> 对应 （xxx， xx）。</li><li>输入 <code>more /etc/fstab</code> 命令查找对应关系，如此便能找到映射点。</li></ol><h2 id="挂载新硬盘文件系统失败"><a class="anchor" href="#挂载新硬盘文件系统失败">#</a> 挂载新硬盘文件系统失败</h2><p>这里导致出现的问题是新硬盘替换旧硬盘，然后旧硬盘可能有共享、引用之类的，因此在旧硬盘不存在的情况下，当你为新硬盘建立了文件系统后，并为其挂载保存的的时候，会出现无法保存并挂载成功，这时候就必须先把旧的不存在的硬盘的文件系统卸载掉先，否者会影响新的文件系统挂载；而如果旧的文件系统是有使用共享服务的，那么需要根据其依赖关系（ <code>磁盘</code> -&gt; <code>文件系统</code> -&gt; <code>共享文件夹</code> -&gt; <code>服务(SMB, FTP等)</code> ）逐步解除并保证卸载成功，这样才可以为新的硬盘挂载文件系统。</p><h2 id="手动测试硬盘"><a class="anchor" href="#手动测试硬盘">#</a> 手动测试硬盘</h2><ol><li>使用 <span class="exturl" data-url="aHR0cHM6Ly9tYW4uYXJjaGxpbnV4Lm9yZy9tYW4vc21hcnRjdGwuOA==">smartctl</span> 分析硬盘<ul><li><code>smartctl -i /dev/sdxy</code> 显示磁盘基本信息。</li><li><code>smartctl -H /dev/sdxy</code> 显示硬盘的健康状况。</li><li><code>smartctl -A /dev/sdxy</code> 显示硬盘的详细信息。</li><li><code>smartctl -t short /dev/sdxy</code> 后台检测硬盘，消耗时间短，用第二条命令查看结果。</li><li><code>smartctl -t long /dev/sdxy</code> 后台检测硬盘，消耗时间长，用第二条命令查看结果。</li><li><code>smartctl -l selftest /dev/sdxy</code> 显示硬盘检测日志。</li><li><code>smartctl -l error /dev/sda</code> 显示硬盘错误汇总。</li></ul></li><li>使用 <span class="exturl" data-url="aHR0cHM6Ly9tYW4uYXJjaGxpbnV4Lm9yZy9tYW4vYmFkYmxvY2tzLjg=">badblocks</span> 扫描硬盘<ul><li><code>badblocks -sv -o ~/sdxy_blocks.txt /dev/sdxy</code> 前台显示扫描进度，并将结果保存到文档上。</li></ul></li><li>使用 <span class="exturl" data-url="aHR0cHM6Ly9tYW4uYXJjaGxpbnV4Lm9yZy9tYW4vaGRwYXJtLjg=">hdparm</span> 测硬盘读速<ul><li><code>hdparm -Ttv /dev/sdxy</code> 该命令将显示磁盘的缓存和读性能。</li><li><code>hdparm -tv --direct /dev/sdxy</code> 添加 <code>--direct</code> 选项将绕过硬盘驱动器的缓冲区高速缓存，从而直接从磁盘读取。</li></ul></li><li>使用 <span class="exturl" data-url="aHR0cHM6Ly9tYW4uYXJjaGxpbnV4Lm9yZy9tYW4vZGQuMQ==">dd</span> 测硬盘写速<ul><li><code>sync; dd if=/dev/zero of=/srv/dev-disk-by-uuid-xxx/tempfile bs=1M count=5120; sync</code> 以 1MByte 为单位，写入 5120 次，即写入往 tempfile 文件写入 5GB 大小的零数据值。</li></ul></li></ol><div class="tags"><a href="/tags/Linux/" rel="tag"><i class="ic i-tag"></i> Linux</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-08-29 21:21:41" itemprop="dateModified" datetime="2024-08-29T21:21:41+08:00">2024-08-29</time></span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="omv6-install/" class="item leancloud_visitors" data-flag-title="debian 11 桌面安装 OMV 6" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span id="busuanzi_value_page_pv"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 投喂</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.webp" alt="夏沫の浅雨 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.webp" alt="夏沫の浅雨 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>夏沫の浅雨 <i class="ic i-at"><em>@</em></i>命运转轮</li><li class="link"><strong>本文链接：</strong> <a href="https://arachnid.cc/omv6-install/" title="debian 11 桌面安装 OMV 6">https://arachnid.cc/omv6-install/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/summary-of-keil-tool-use/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;arachnid.cc&#x2F;picture&#x2F;(26).webp" title="关于 Keil 的一些总结性使用"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>关于 Keil 的一些总结性使用</h3></a></div><div class="item right"><a href="/linux-environment-variables/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;arachnid.cc&#x2F;picture&#x2F;(24).webp" title="Linux 环境变量的增删改"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>Linux 环境变量的增删改</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#debian-%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">Debian 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.</span> <span class="toc-text">基本配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-sudo-%E7%AE%A1%E7%90%86%E7%BB%84"><span class="toc-number">1.1.1.</span> <span class="toc-text">添加 sudo 管理组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E6%8F%90%E7%A4%BA%E5%85%89%E7%9B%98%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="toc-number">1.1.2.</span> <span class="toc-text">避免提示光盘安装软件包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%8D%A2%E8%BD%AF%E4%BB%B6%E5%8C%85%E9%95%9C%E5%83%8F%E6%BA%90"><span class="toc-number">1.1.3.</span> <span class="toc-text">更换软件包镜像源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E5%B7%A5%E5%85%B7"><span class="toc-number">1.1.4.</span> <span class="toc-text">内核编译工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E5%8D%A1%E9%A9%B1%E5%8A%A8%E6%B7%BB%E5%8A%A0"><span class="toc-number">1.1.5.</span> <span class="toc-text">网卡驱动添加</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%AF%BC%E6%97%B6%E9%97%B4%E4%BF%AE%E6%94%B9"><span class="toc-number">1.1.6.</span> <span class="toc-text">引导时间修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ssh-%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.7.</span> <span class="toc-text">ssh 配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%B8%AD%E6%96%87%E8%BE%93%E5%85%A5%E6%B3%95"><span class="toc-number">1.1.8.</span> <span class="toc-text">安装中文输入法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8A%82%E7%94%B5%E5%A4%84%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">节电处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E7%BA%BF"><span class="toc-number">1.2.1.</span> <span class="toc-text">无线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#usb"><span class="toc-number">1.2.2.</span> <span class="toc-text">USB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cpu-%E8%B0%83%E5%BA%A6"><span class="toc-number">1.2.3.</span> <span class="toc-text">cpu 调度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9D%A1%E7%9C%A0%E4%B8%8E%E4%BC%91%E7%9C%A0"><span class="toc-number">1.2.4.</span> <span class="toc-text">睡眠与休眠</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E7%8E%AF%E5%A2%83%E5%88%87%E6%8D%A2"><span class="toc-number">1.3.</span> <span class="toc-text">图形环境切换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E5%94%A4%E9%86%92"><span class="toc-number">1.4.</span> <span class="toc-text">远程唤醒</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E8%AE%B0%E5%BD%95%E6%9F%A5%E7%9C%8B"><span class="toc-number">1.5.</span> <span class="toc-text">异常记录查看</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%A4%87%E4%BB%BD"><span class="toc-number">1.6.</span> <span class="toc-text">系统备份</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-openmediavault-6x"><span class="toc-number">2.</span> <span class="toc-text">安装 openmediavault 6.x</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#omv6-%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-number">2.1.</span> <span class="toc-text">omv6 基本配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%B4%A6%E6%88%B7%E8%AE%BE%E7%BD%AE"><span class="toc-number">2.2.</span> <span class="toc-text">用户账户设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-ssh"><span class="toc-number">2.3.</span> <span class="toc-text">配置 SSH</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2%E6%9B%B4%E6%96%B0%E9%95%9C%E5%83%8F%E6%BA%90"><span class="toc-number">2.4.</span> <span class="toc-text">替换更新镜像源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-omv-extras"><span class="toc-number">2.5.</span> <span class="toc-text">安装 omv-extras</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-docker"><span class="toc-number">2.6.</span> <span class="toc-text">安装 docker</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-%E6%8D%A2%E6%BA%90"><span class="toc-number">2.6.1.</span> <span class="toc-text">docker 换源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E7%AE%A1%E7%90%86%E9%9D%A2%E6%9D%BF"><span class="toc-number">2.6.2.</span> <span class="toc-text">安装管理面板</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-komga-%E6%BC%AB%E7%94%BB%E7%AE%A1%E7%90%86"><span class="toc-number">2.7.</span> <span class="toc-text">安装 komga 漫画管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-raid-%E8%BD%AF%E9%98%B5%E5%88%97"><span class="toc-number">2.8.</span> <span class="toc-text">创建 Raid 软阵列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-gitea-%E4%BB%A3%E7%A0%81%E7%AE%A1%E7%90%86"><span class="toc-number">2.9.</span> <span class="toc-text">安装 gitea 代码管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-calibre-web-%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86"><span class="toc-number">2.10.</span> <span class="toc-text">安装 calibre-web 图书管理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#other"><span class="toc-number">3.</span> <span class="toc-text">other</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#omv-%E7%99%BB%E9%99%86%E5%90%8E%E7%95%8C%E9%9D%A2%E5%8F%AA%E5%89%A9%E4%BB%AA%E8%A1%A8%E7%9B%98"><span class="toc-number">3.1.</span> <span class="toc-text">omv 登陆后界面只剩仪表盘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#devdm-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">3.2.</span> <span class="toc-text">&#x2F;dev&#x2F;dm-* 文件系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD%E6%96%B0%E7%A1%AC%E7%9B%98%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%A4%B1%E8%B4%A5"><span class="toc-number">3.3.</span> <span class="toc-text">挂载新硬盘文件系统失败</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E6%B5%8B%E8%AF%95%E7%A1%AC%E7%9B%98"><span class="toc-number">3.4.</span> <span class="toc-text">手动测试硬盘</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="夏沫の浅雨" data-src="/images/avatar.webp"><p class="name" itemprop="name">夏沫の浅雨</p><div class="description" itemprop="description">不曾亏欠，不曾辜负，如此足矣</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">80</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">5</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">23</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FyYWNobmlkLTk3" title="https:&#x2F;&#x2F;github.com&#x2F;Arachnid-97"><i class="ic i-github"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMjM2MTA4MzU=" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;23610835"><i class="ic i-bilibili"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友人帐</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-info-circle"></i>关于</a></li><li class="item"><a href="/atom.xml" rel="section"><i class="ic i-rss"></i>RSS</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/summary-of-keil-tool-use/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/linux-environment-variables/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/Cortex-M-abnormal" title="Cortex-M3&#x2F;M4&#x2F;M7 故障异常分析">Cortex-M3/M4/M7 故障异常分析<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/linux-command-summary" title="Linux 命令简述总结">Linux 命令简述总结<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/kicad-summary" title="Kicad 应用总结">Kicad 应用总结<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/vscode-config" title="vscode 常用配置">vscode 常用配置<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/ubuntu-ftp-create" title="Ubuntu 下 FTP 的搭建配置">Ubuntu 下 FTP 的搭建配置<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Hexo/" title="分类于 Hexo-shoka">Hexo-shoka</a></div><span><a href="/shoka-function-expansion" title="博客搭建笔记之功能扩展">博客搭建笔记之功能扩展<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/RTOS/" title="分类于 FreeRTOS">FreeRTOS</a></div><span><a href="/freertos-queue" title="FreeRTOS 篇章之队列管理">FreeRTOS 篇章之队列管理<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a></div><span><a href="/md5-algorithm" title="MD5 算法">MD5 算法<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/x-ymodem-protocol" title="X&#x2F;YModem 传输协议">X/YModem 传输协议<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/RTOS/" title="分类于 FreeRTOS">FreeRTOS</a></div><span><a href="/freertos-config" title="FreeRTOS 篇章之 FreeRTOSConfig.h 分析">FreeRTOS 篇章之 FreeRTOSConfig.h 分析<i class="ic i-link-alt"></i></a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">夏沫の浅雨 @ Arachnid's blog</span></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="count"><span class="icon"><i class="ic i-person"></i> <span id="busuanzi_value_site_uv"></span>人 <span class="post-meta-divider">|</span> <span class="icon"><i class="ic i-eye"></i> <span id="busuanzi_value_site_pv"></span>次 <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">620k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">10:32</span></span></span></div><div class="create_time"><span class="icon"><i class="ic i-clock"></i> <span id="timeDate">正在加载</span> <span id="times">...</span><script>function createtime(){var n=new Date("04/28/2022 15:45:50");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML=" 本站存活 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}var now=new Date;setInterval("createtime()",250)</script></span></div><div class="powered-by">Powered-by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"omv6-install/",favicon:{show:"ψ(｀∇´)ψ 欢迎回来!",hide:"《原子弹入门及制造》"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',isOutdated:!0,format_year_as_prefix:"{{year}}年",format_month_as_prefix:"{{month}}个月",format_month_as_suffix:"零{{month}}个月",format_day_as_prefix:"{{day}}天",format_day_as_suffix:"零{{day}}天",template:"<div class='note warning'><p><span class='label primary'><strong>文章时效性提示</strong></span><br>这是一篇发布于 <span class='pink'>{{publish}}</span> 前，最后一次更新距今已经 <span class='pink'>{{updated}}</span> 的文章，部分内容可能已经过时，请注意甄别。</p></div>",ignores:[function(a){return a.includes("#")},function(a){return new RegExp(LOCAL.path+"$").test(a)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="/js/combined-file.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->