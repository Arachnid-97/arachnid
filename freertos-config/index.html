<!-- build time:Wed Feb 15 2023 23:06:09 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="命运转轮" href="https://arachnid.cc/rss.xml"><link rel="alternate" type="application/atom+xml" title="命运转轮" href="https://arachnid.cc/atom.xml"><link rel="alternate" type="application/json" title="命运转轮" href="https://arachnid.cc/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="history,FreeRTOS,RTOS"><link rel="canonical" href="https://arachnid.cc/freertos-config/"><title>FreeRTOS 篇章之 FreeRTOSConfig.h 分析 - FreeRTOS | Arachnid's blog = 命运转轮 = Life is ...the time you did something you're afraid of doing</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline"><a href="/freertos-config" class="link external" itemprop="url">FreeRTOS 篇章之 FreeRTOSConfig.h 分析<i class="ic i-link-alt"></i></a></h1><div class="meta"><span class="item" title="创建时间：2020-02-17 15:51:45"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2020-02-17T15:51:45+08:00">2020-02-17</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>27k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>28 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Arachnid's blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://arachnid.cc/picture/(22).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(16).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(15).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(20).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(8).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(23).webp"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/RTOS/" itemprop="item" rel="index" title="分类于 FreeRTOS"><span itemprop="name">FreeRTOS</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="cn"><link itemprop="mainEntityOfPage" href="https://arachnid.cc/freertos-config/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="夏沫の浅雨"><meta itemprop="description" content="Life is ...the time you did something you're afraid of doing, 不曾亏欠，不曾辜负，如此足矣"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="命运转轮"></span><div class="body md" itemprop="articleBody"><h1 id="移植修改"><a class="anchor" href="#移植修改">#</a> 移植修改</h1><p>在 <a href="https://arachnid.cc/docs/RTOS/FreeRTOS%20%E7%AF%87%E7%AB%A0%E4%B9%8B%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D/">FreeRTOS 篇章之系统移植</a> 中，我们有把 <code>FreeRTOSv9.0.0\FreeRTOS\Demo\CORTEX_STM32F103_Keil</code> 路径下的 <code>FreeRTOSConfig.h</code> 文件复制到我们用户可修改的 <code>App</code> 文件夹下，并且导入了工程，但是，该 <code>FreeRTOSConfig.h</code> 文件的内容并不是我们真正想要了内容，需要我们进行更改，而源文件内容就只有下面这么点内容</p><p><img data-src="20200216134014732.png" alt="img"></p><p>虽然能满足 FreeRTOS 跑起来，但是往往随着功能的添加，我们需要 FreeRTOS 的更多支持，而这里也只是展示了个别裁剪功能；为了物尽其用，避免以后还要继续添加，所以我们直接就导入 FreeRTOS 所提供的功能选择，修改成如下内容：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">FREERTOS_CONFIG_H</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">FREERTOS_CONFIG_H</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">/* Here is a good place to include header files that are required across</span></pre></td></tr><tr><td data-num="5"></td><td><pre>your application. */</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"something.h"</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_PREEMPTION</span>                    <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_PORT_OPTIMISED_TASK_SELECTION</span> <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_TICKLESS_IDLE</span>                 <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configCPU_CLOCK_HZ</span>                      <span class="token expression"><span class="token number">60000000</span></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configTICK_RATE_HZ</span>                      <span class="token expression"><span class="token number">250</span></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configMAX_PRIORITIES</span>                    <span class="token expression"><span class="token number">5</span></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configMINIMAL_STACK_SIZE</span>                <span class="token expression"><span class="token number">128</span></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configMAX_TASK_NAME_LEN</span>                 <span class="token expression"><span class="token number">16</span></span></span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_16_BIT_TICKS</span>                  <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configIDLE_SHOULD_YIELD</span>                 <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_TASK_NOTIFICATIONS</span>            <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_MUTEXES</span>                       <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_RECURSIVE_MUTEXES</span>             <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_COUNTING_SEMAPHORES</span>           <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_ALTERNATIVE_API</span>               <span class="token expression"><span class="token number">0</span> </span><span class="token comment">/* Deprecated! */</span></span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configQUEUE_REGISTRY_SIZE</span>               <span class="token expression"><span class="token number">10</span></span></span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_QUEUE_SETS</span>                    <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_TIME_SLICING</span>                  <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_NEWLIB_REENTRANT</span>              <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configENABLE_BACKWARD_COMPATIBILITY</span>     <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configNUM_THREAD_LOCAL_STORAGE_POINTERS</span> <span class="token expression"><span class="token number">5</span></span></span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configSTACK_DEPTH_TYPE</span>                  <span class="token expression"><span class="token keyword">uint16_t</span></span></span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configMESSAGE_BUFFER_LENGTH_TYPE</span>        <span class="token expression">size_t</span></span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment">/* Memory allocation related definitions. */</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configSUPPORT_STATIC_ALLOCATION</span>         <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configSUPPORT_DYNAMIC_ALLOCATION</span>        <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configTOTAL_HEAP_SIZE</span>                   <span class="token expression"><span class="token number">10240</span></span></span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configAPPLICATION_ALLOCATED_HEAP</span>        <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment">/* Hook function related definitions. */</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_IDLE_HOOK</span>                     <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_TICK_HOOK</span>                     <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configCHECK_FOR_STACK_OVERFLOW</span>          <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_MALLOC_FAILED_HOOK</span>            <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_DAEMON_TASK_STARTUP_HOOK</span>      <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token comment">/* Run time and task stats gathering related definitions. */</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configGENERATE_RUN_TIME_STATS</span>           <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_TRACE_FACILITY</span>                <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_STATS_FORMATTING_FUNCTIONS</span>    <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token comment">/* Co-routine related definitions. */</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_CO_ROUTINES</span>                   <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configMAX_CO_ROUTINE_PRIORITIES</span>         <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="53"></td><td><pre></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token comment">/* Software timer related definitions. */</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_TIMERS</span>                        <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configTIMER_TASK_PRIORITY</span>               <span class="token expression"><span class="token number">3</span></span></span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configTIMER_QUEUE_LENGTH</span>                <span class="token expression"><span class="token number">10</span></span></span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configTIMER_TASK_STACK_DEPTH</span>            <span class="token expression">configMINIMAL_STACK_SIZE</span></span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token comment">/* Interrupt nesting behaviour configuration. */</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configKERNEL_INTERRUPT_PRIORITY</span>         <span class="token expression"><span class="token punctuation">[</span>dependent of processor<span class="token punctuation">]</span></span></span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configMAX_SYSCALL_INTERRUPT_PRIORITY</span>    <span class="token expression"><span class="token punctuation">[</span>dependent on processor <span class="token operator">and</span> application<span class="token punctuation">]</span></span></span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configMAX_API_CALL_INTERRUPT_PRIORITY</span>   <span class="token expression"><span class="token punctuation">[</span>dependent on processor <span class="token operator">and</span> application<span class="token punctuation">]</span></span></span></pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token comment">/* Define to trap errors during development. */</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">configASSERT</span><span class="token expression"><span class="token punctuation">(</span> <span class="token punctuation">(</span> x <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">(</span> x <span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token function">vAssertCalled</span><span class="token punctuation">(</span> <span class="token constant">__FILE__</span><span class="token punctuation">,</span> <span class="token constant">__LINE__</span> <span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token comment">/* FreeRTOS MPU specific definitions. */</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configINCLUDE_APPLICATION_DEFINED_PRIVILEGED_FUNCTIONS</span> <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="70"></td><td><pre></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token comment">/* Optional functions - most linkers will remove unused functions anyway. */</span></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_vTaskPrioritySet</span>                <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_uxTaskPriorityGet</span>               <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_vTaskDelete</span>                     <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_vTaskSuspend</span>                    <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_xResumeFromISR</span>                  <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_vTaskDelayUntil</span>                 <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="78"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_vTaskDelay</span>                      <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_xTaskGetSchedulerState</span>          <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="80"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_xTaskGetCurrentTaskHandle</span>       <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="81"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_uxTaskGetStackHighWaterMark</span>     <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_xTaskGetIdleTaskHandle</span>          <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_eTaskGetState</span>                   <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_xEventGroupSetBitFromISR</span>        <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_xTimerPendFunctionCall</span>          <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_xTaskAbortDelay</span>                 <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_xTaskGetHandle</span>                  <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_xTaskResumeFromISR</span>              <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="89"></td><td><pre></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token comment">/* A header file that defines trace macro can be included here. */</span></pre></td></tr><tr><td data-num="91"></td><td><pre></pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">/* FREERTOS_CONFIG_H */</span></span></pre></td></tr></table></figure><p>当然，这只是官方提供的，较为完整的配置模版；具体实现什么功能还是要我们对相应的宏进行修改的。</p><h1 id="配置项详解"><a class="anchor" href="#配置项详解">#</a> 配置项详解</h1><p><strong>1、configUSE_PREEMPTION</strong></p><p>置 <code>1</code> ：RTOS 使用抢占式调度器，即当进程位于内核空间时，有一个更高优先级的任务出现时，如果当前内核允许抢占，则可以将当前任务挂起，执行优先级更高的进程；</p><p>置 <code>0</code> ：RTOS 使用协作式调度器（时间片），协作式操作系统是任务主动释放 CPU 后，切换到下一个任务，任务切换的时机完全取决于正在运行的任务，因此，高优先级的进程不能中止正在内核中运行的低优先级的进程而抢占 CPU 运行。</p><p><strong>2、configUSE_PORT_OPTIMISED_TASK_SELECTION</strong></p><p>一些 FreeRTOS 硬件端口在选择下一个要执行的任务，具有两种的方法：通用方法和特定于该硬件端口的方法。</p><p>通用方法：</p><ul><li>在 <code>configUSE_PORT_OPTIMISED_TASK_SELECTION</code> 设置为 <code>0</code> （显式）或未实现特定于硬件端口的方法（隐式）时使用。</li><li>可以与所有 FreeRTOS 硬件端口一起使用。</li><li>完全用 C 编写，使其效率低于使用特定硬件端口的方法。</li><li>不限制可用优先级的最大数量。</li></ul><p>特定于硬件端口的方法：</p><ul><li>不适用于所有硬件端口。</li><li>在 <code>configUSE_PORT_OPTIMISED_TASK_SELECTION</code> 设置为 <code>1</code> 时使用。</li><li>依赖于一个或多个特定于体系结构的汇编指令（通常为计数前导零 [CLZ] 或等效指令），因此只能与专门为其编写的体系结构一起使用。</li><li>比通用方法更有效。</li><li>通常，最大可用优先级数限制为 32。</li></ul><p><strong>3、configUSE_TICKLESS_IDLE</strong></p><p>置 <code>1</code> ：使能低功耗 tickless 模式；</p><p>置 <code>0</code> ：保持系统节拍（tick）中断一直运行。</p><p>在低功耗 tickless 模式，通常使用空闲钩子函数设置 CPU 进入低功耗模式来达到省电的目的。</p><p><strong>4、configUSE_IDLE_HOOK</strong></p><p>置 <code>1</code> ：使用空闲钩子（Idle Hook 类似于回调函数）；</p><p>置 <code>0</code> ：忽略空闲钩子。</p><p>空闲任务钩子是一个函数，这个函数由用户来实现，FreeRTOS 规定了函数的名字和参数： <code>void vApplicationIdleHook(void)</code> ，这个函数在每个空闲任务周期都会被调用。</p><p><strong>5、configUSE_MALLOC_FAILED_HOOK</strong></p><p>每次创建任务，队列或信号量时，内核都会使用对 <code>pvPortMalloc()</code> 的调用从堆中分配内存。FreeRTOS 的官方下载包中包含五个堆内存分配方案；这些方案分别在 <code>heap_1.c</code> ， <code>heap_2.c</code> ， <code>heap_3.c</code> ， <code>heap_4.c</code> 和 <code>heap_5.c</code> 源文件中进行实现； <code>configUSE_MALLOC_FAILED_HOOK</code> 仅在使用这五个堆内存分配方案之一时才有意义。</p><p>如果定义并正确配置 <code>malloc()</code> 申请失败的钩子函数，则这个函数会在 <code>pvPortMalloc()</code> 函数返回 NULL 时被调用；注意：仅当 FreeRTOS 在响应内存分配请求时发现堆内存不足时，才返回 NULL。</p><p>置 <code>1</code> ：则应用程序必须定义一个 <code>malloc()</code> 申请失败的挂钩函数；</p><p>置 <code>0</code> ：则忽略 <code>malloc()</code> 申请失败的挂钩函数，即使定义了这个挂钩函数。</p><p><code>malloc()</code> 申请失败的挂钩函数必须具有如下所示的名称和原型：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">vApplicationMallocFailedHook</span><span class="token punctuation">(</span> <span class="token keyword">void</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>6、configUSE_DAEMON_TASK_STARTUP_HOOK</strong></p><p>置 <code>1</code> ：则应用程序必须定义一个具有确切名称和原型的钩子函数；</p><p>置 <code>0</code> ：则忽略该钩子函数。</p><p>其名称和原型如下所示：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">vApplicationDaemonTaskStartupHook</span><span class="token punctuation">(</span> <span class="token keyword">void</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>首次执行 RTOS 守护程序任务（也称为 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL1JUT1Mtc29mdHdhcmUtdGltZXItc2VydmljZS1kYWVtb24tdGFzay5odG1s">计时器服务任务</span> ）时，钩子函数将被精确调用一次 。任何需要运行 RTOS 的应用程序初始化代码都可以放在挂钩函数中。</p><p><strong>7、configUSE_TICK_HOOK</strong></p><p>置 <code>1</code> ：使用时间片钩子（Tick Hook）；</p><p>置 <code>0</code> ：忽略时间片钩子。</p><p>时间片钩子是一个函数，这个函数由用户来实现，FreeRTOS 规定了函数的名字和参数： <code>void vApplicationTickHook(void)</code> ，时间片中断可以周期性的调用。</p><p><strong>8、configCPU_CLOCK_HZ</strong></p><p>输入以 Hz 为单位的频率，该驱动频率将用于系统滴答中断的外设驱动的内部时钟，通常与驱动内部 CPU 时钟的时钟相同；配置此值是为了正确的配置系统节拍中断周期。</p><p><strong>9、configTICK_RATE_HZ</strong></p><p>配置 RTOS 滴答中断的频率；用于测量时间，即一秒中断的次数，每次中断 RTOS 都会进行任务调度。</p><p>更高的滴答频率意味着同一时间下可以测量到更高的分辨率；但是，较高的滴答频率也意味着 RTOS 内核将使用更多的 CPU 时间，因此使得效率降低。RTOS 演示例程均使用 1000Hz 的滴答频率，这是为了测试 RTOS 内核，因此比实际使用的高得多。（实际使用时不用这么高的系统节拍中断频率）</p><p>多个任务可以共享相同的优先级。通过在每个 RTOS 系统节拍中断到来时切换任务，RTOS 调度程序将在优先级相同的任务之间共享处理器时间；因此，较高的滴答频率会减少分配给每个任务的 “时间片” 。</p><p><strong>10、configMAX_PRIORITIES</strong></p><p>配置应用程序任务可用的优先级数；任何数量的任务都可以共享相同的优先级。协同例程的优先级是分开的，详情见 <code>configMAX_CO_ROUTINE_PRIORITIES</code> 。</p><p>每个可用的优先级都会消耗 RTOS 内核中的 RAM，因此该值不应设置为高于应用程序实际需要的值。</p><p>每一个任务都会被分配一个优先级，优先级值在 0 ~ (configMAX_PRIORITIES - 1) 之间。低优先级数表示低优先级任务，空闲任务的优先级为 0（tskIDLE_PRIORITY），因此它是最低优先级任务。</p><p><strong>11、configMINIMAL_STACK_SIZE</strong></p><p>空闲任务使用的堆栈大小。通常此值不应小于对应处理器演示例程文件 <code>FreeRTOSConfig.h</code> 中定义的数值</p><p>就像 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL2EwMDEyNS5odG1s">xTaskCreate()</span> 和 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL3hUYXNrQ3JlYXRlU3RhdGljLmh0bWw=">xTaskCreateStatic()</span> 函数的堆栈大小参数一样，堆栈大小以字为单位而不是字节；如果在 32 位处理器上，当堆栈大小为 100 则表示 400 字节的空间大小。</p><p><strong>12、configMAX_TASK_NAME_LEN</strong></p><p>创建任务时，描述任务信息的字符串的最大允许长度。长度包括 <code>\0</code> 字符串结束符。</p><p><strong>13、configUSE_TRACE_FACILITY</strong></p><p>置 <code>1</code> ：表示启动可视化跟踪调试，会激活一些其他的结构成员和函数；</p><p>置 <code>0</code> ：忽略。</p><p><strong>14、configUSE_STATS_FORMATTING_FUNCTIONS</strong></p><p>将 <code>configUSE_TRACE_FACILITY</code> 和 <code>configUSE_STATS_FORMATTING_FUNCTIONS</code> 都设置为 <code>1</code> ，则再构建中包含编译 <code>vTaskList()</code> 和 <code>vTaskGetRunTimeStats()</code> 函数；</p><p>否则，其中一个宏为 <code>0</code> ，就会从构建中省略这两个函数，不进行编译；通常只是在调试时才使用，用来观察各任务，跟 13 的宏连用。</p><p><strong>15、configUSE_16_BIT_TICKS</strong></p><p>时间是以 “ticks” 来衡量的，这是自 RTOS 内核启动以来滴答中断执行的次数；tick 计数保存在 <code>TickType_t</code> 类型的变量中。</p><p>置 <code>1</code> ： <code>TickType_t</code> 被定义为无符号的 16 位类型；</p><p>置 <code>0</code> ： <code>TickType_t</code> 被定义为无符号的 32 位类型。</p><p>使用 16 位类型将大大提高 8 位和 16 位处理器系统的性能，但会将最大的可指定时间段限制为 65535 个 “ticks” 。因此，假设滴答频率为 250Hz，则使用 16 位计数器时任务可以延迟或阻止的最长时间为 262 秒，而使用 32 位计数器时为 17179869 秒。</p><p><strong>16、configIDLE_SHOULD_YIELD</strong></p><p>此参数控制处于空闲优先级的任务的行为。它仅在以下情况下起作用：</p><ul><li>正在使用抢占式调度程序。</li><li>该应用程序创建以空闲优先级运行的任务。</li></ul><p>如果 <code>configUSE_TIME_SLICING</code> 被设置为 <code>1</code> （或未定义），则具有相同优先级的任务将共享使用时间片。如果具有相同优先级的任务，它的优先级高于空闲优先级，并且没有一个任务被抢占，则可以假定这些具有相同优先级的任务，它们分配等量的处理时间；</p><p>但当任务共享空闲优先级时，情况会稍微有些不同。如果 <code>configIDLE_SHOULD_YIELD</code> 设置为 <code>1</code> ，则任何跟空闲优先级相同的用户任务就绪时，空闲任务会立刻让出 CPU，使用户任务得以运行，这样确保了能最快响应用户任务。但是，此行为可能会产生不良影响（取决于您的应用程序的需求），如下所示：</p><p><img data-src="20200217156805236.png" alt="img"></p><p>上图描述了四个处于空闲优先级的任务的执行模式。任务 <code>A</code> ， <code>B</code> 和 <code>C</code> 是应用程序任务；任务 <code>I</code> 是空闲任务。在时间 T0，T1，…，T6 定期进行上下文切换；在空闲任务运行中，当任务 <code>A</code> 任务产生时，空闲任务立刻让出 CPU，开始执行任务 <code>A</code> ，但此刻空闲任务 <code>I</code> 已经消耗了当前时间片的一些时间了，这样的结果就是空闲任务 <code>I</code> 和任务 <code>A</code> 共享同一时间片。因此，应用程序任务 <code>B</code> 和 <code>C</code> 比应用程序任务 <code>A</code> 获得更多的处理时间。</p><p>可以通过以下方式避免这种情况：</p><ul><li>如果合适，请使用空闲钩子函数代替空闲优先级的单独任务。</li><li>以高于空闲优先级的优先级创建所有应用程序任务。</li><li>将 <code>configIDLE_SHOULD_YIELD</code> 设置为 <code>0</code> 。</li></ul><p>将 <code>configIDLE_SHOULD_YIELD</code> 设置为 <code>0</code> 可以防止空闲任务产生处理时间，直到其时间片结束为止。这样可以确保为所有处于空闲优先级的任务分配相等的处理时间（如果没有一个任务被抢占），但代价是将更大比例的总处理时间分配给空闲任务。</p><p><strong>17、configUSE_TASK_NOTIFICATIONS</strong></p><p>置 <code>1</code> （或未定义）：开启任务通知功能，有关的 API 函数会被包含编译；</p><p>置 <code>0</code> ：直接从程序中关闭任务通知功能及其关联的 API。</p><p>该功能默认是开启的。开启后，每个任务多增加 8 字节 RAM。</p><p><strong>18、configUSE_MUTEXES</strong></p><p>置 <code>1</code> ：使用互斥量；</p><p>置 <code>0</code> ：不使用互斥量。</p><p>读者应该了解在 FreeRTOS 中互斥量和二值信号量的区别。</p><p><strong>19、configUSE_RECURSIVE_MUTEXES</strong></p><p>置 <code>1</code> ：使用递归互斥量；</p><p>置 <code>0</code> ：不使用递归互斥量。</p><p><strong>20、configUSE_COUNTING_SEMAPHORES</strong></p><p>置 <code>1</code> ：使用计数信号量；</p><p>置 <code>0</code> ：不使用计数信号量。</p><p><strong>21、configUSE_ALTERNATIVE_API</strong></p><p>置 <code>1</code> ：使用 “alternative” 队列函数；</p><p>置 <code>0</code> ：不使用 “alternative” 队列函数。</p><p>“alternative” API 队列函数在 <code>queue.h</code> 头文件中有详细描述；<strong>“alternative” API 已被弃用，在新的设计中请不要使用它！</strong></p><p><strong>22、configCHECK_FOR_STACK_OVERFLOW</strong></p><p>在 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL1N0YWNrcy1hbmQtc3RhY2stb3ZlcmZsb3ctY2hlY2tpbmcuaHRtbA==">Stack Usage and Stack Overflow Checking</span> 链接中有详细描述堆栈使用情况和堆栈溢出检查的方法，这里就不详细说了。</p><p><strong>23、configQUEUE_REGISTRY_SIZE</strong></p><p>通过此定义来设置可以注册的信号量和消息队列个数。</p><p>队列注册表具有两个目的，这两个目的都与 RTOS 内核调试相关联：</p><ul><li>它允许将文本名称与队列关联，以便在调试 GUI 中轻松识别队列。</li><li>它包含调试器查找每个已注册队列和信号量所需的信息。</li></ul><p>除了进行内核调试外，队列注册表没有其它任何目的；只有注册后的队列和信号量才可以使用 RTOS 内核调试器查看，有关更多信息，请参见 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL3ZRdWV1ZUFkZFRvUmVnaXN0cnkuaHRtbA==">vQueueAddToRegistry()</span> 和 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL3ZRdWV1ZVVucmVnaXN0ZXJRdWV1ZS5odG1s">vQueueUnregisterQueue()</span> 的 API 参考文档。</p><p><strong>24、configUSE_QUEUE_SETS</strong></p><p>置 <code>1</code> ：使能队列集功能（可以阻塞、挂起到多个队列和信号量）；</p><p>置 <code>0</code> ：忽略队列集功能。</p><p><strong>25、configUSE_TIME_SLICING</strong></p><p>置 <code>1</code> （或未定义）：默认情况下，FreeRTOS 使用基于时间片的优先级抢占式调度器，这意味着 RTOS 调度器将始终运行处于最高优先级的 “就绪” 状态任务，并会在每个 RTOS 滴答中断时对在优先级相同的任务之间进行切换；</p><p>置 <code>0</code> ：RTOS 调度程序仍将运行处于最高优先级的 “就绪” 状态任务，但不会由于发生了滴答中断而在优先级相同的任务之间切换。</p><p><strong>26、configUSE_NEWLIB_REENTRANT</strong></p><p>置 <code>1</code> ：将为每个创建的任务分配一个 <span class="exturl" data-url="aHR0cDovL3NvdXJjZXdhcmUub3JnL25ld2xpYi8=">newlib</span>（一个嵌入式 C 库）进入结构；</p><p>置 <code>0</code> ：不分配。</p><p>注意 Newlib 支持是已经包含在普遍需求中了，但 FreeRTOS 维护者本身并未使用。FreeRTOS 是不负责由此产生的 newlib 操作的，因此用户必须熟悉 newlib，并且必须提供必要存根的系统级实现。请注意，（在撰写本文时）当前的 newlib 设计实现了一个系统级的 <code>malloc()</code> ，这个 <code>malloc()</code> 必须锁上。</p><p><strong>27、configENABLE_BACKWARD_COMPATIBILITY</strong></p><p><code>FreeRTOS.h</code> 头文件包含一组 #define 宏，这些宏将在 V8.0.0 之前的 FreeRTOS 版本中使用的数据类型的名称映射到在 FreeRTOS 的 V8.0.0 版本中使用的名称，这些宏可以确保 RTOS 内核升级到 V8.0.0 或以上版本时，不用对之前的应用代码做任何修改。</p><p>置 <code>1</code> ：包含这些 #define 宏；</p><p>置 <code>0</code> ：排除这些宏，从而允许进行验证，以确保未使用 V8.0.0 之前的版本。</p><p>各类型定义如下：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">configENABLE_BACKWARD_COMPATIBILITY <span class="token operator">==</span> <span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">eTaskStateGet</span> <span class="token expression">eTaskGetState</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">portTickType</span> <span class="token expression">TickType_t</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">xTaskHandle</span> <span class="token expression">TaskHandle_t</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">xQueueHandle</span> <span class="token expression">QueueHandle_t</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">xSemaphoreHandle</span> <span class="token expression">SemaphoreHandle_t</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">xQueueSetHandle</span> <span class="token expression">QueueSetHandle_t</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">xQueueSetMemberHandle</span> <span class="token expression">QueueSetMemberHandle_t</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">xTimeOutType</span> <span class="token expression">TimeOut_t</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">xMemoryRegion</span> <span class="token expression">MemoryRegion_t</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">xTaskParameters</span> <span class="token expression">TaskParameters_t</span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">xTaskStatusType</span>	<span class="token expression">TaskStatus_t</span></span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">xTimerHandle</span> <span class="token expression">TimerHandle_t</span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">xCoRoutineHandle</span> <span class="token expression">CoRoutineHandle_t</span></span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">pdTASK_HOOK_CODE</span> <span class="token expression">TaskHookFunction_t</span></span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">portTICK_RATE_MS</span> <span class="token expression">portTICK_PERIOD_MS</span></span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">pcTaskGetTaskName</span> <span class="token expression">pcTaskGetName</span></span></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">pcTimerGetTimerName</span> <span class="token expression">pcTimerGetName</span></span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">pcQueueGetQueueName</span> <span class="token expression">pcQueueGetName</span></span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">vTaskGetTaskInfo</span> <span class="token expression">vTaskGetInfo</span></span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token comment">/* Backward compatibility within the scheduler code only - these definitions</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	are not really required but are included for completeness. */</pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">tmrTIMER_CALLBACK</span> <span class="token expression">TimerCallbackFunction_t</span></span></pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">pdTASK_CODE</span> <span class="token expression">TaskFunction_t</span></span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">xListItem</span> <span class="token expression">ListItem_t</span></span></pre></td></tr><tr><td data-num="27"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">xList</span> <span class="token expression">List_t</span></span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">/* configENABLE_BACKWARD_COMPATIBILITY */</span></span></pre></td></tr></table></figure><p><strong>28、configNUM_THREAD_LOCAL_STORAGE_POINTERS</strong></p><p>设置每个任务的线程本地存储指针数组大小；详情请看链接 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL3RocmVhZC1sb2NhbC1zdG9yYWdlLXBvaW50ZXJzLmh0bWw=">Thread Local Storage Pointers</span> 。</p><p><strong>29、configSTACK_DEPTH_TYPE</strong></p><p>设置用于在调用 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL2EwMDEyNS5odG1s">xTaskCreate()</span> 时指定堆栈深度的类型，并使用其他各种堆栈大小（例如，在返回 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL3V4VGFza0dldFN0YWNrSGlnaFdhdGVyTWFyay5odG1s">堆栈高位标记时</span> ）。</p><p>在较旧的版本中，FreeRTOS 使用 <code>UBaseType_t</code> 类型的变量来指定堆栈大小，但是发现这对 8 位微控制器的限制太大。因此， <code>configSTACK_DEPTH_TYPE</code> 允许应用程序开发人员指定要使用的类型，从而消除了这个限制。</p><p><strong>30、configMESSAGE_BUFFER_LENGTH_TYPE</strong></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL1JUT1MtbWVzc2FnZS1idWZmZXItZXhhbXBsZS5odG1s">FreeRTOS 消息缓冲区</span> 使用 <code>configMESSAGE_BUFFER_LENGTH_TYPE</code> 类型的变量来存储每个消息的长度；如果未定义 <code>configMESSAGE_BUFFER_LENGTH_TYPE</code> ，则默认为 <code>size_t</code> 。</p><p>如果存储在消息缓冲区中的消息永远不会大于 255 个字节，那么在 32 位微控制器上将 <code>configMESSAGE_BUFFER_LENGTH_TYPE</code> 定义为 <code>uint8_t</code> 将为每个消息节省 3 个字节；同样，如果存储在消息缓冲区中的消息永远不会大于 65535 字节，则在 32 位微控制器上将 <code>configMESSAGE_BUFFER_LENGTH_TYPE</code> 定义为 <code>uint16_t</code> 将为每条消息节省 2 个字节。</p><p><strong>31、configSUPPORT_STATIC_ALLOCATION</strong></p><p>置 <code>1</code> ：可以使用应用程序编写者提供的 RAM 创建 RTOS 对象；</p><p>置 <code>0</code> （或未定义）：只能使用从 FreeRTOS 堆分配的 RAM 创建 RTOS 对象。</p><p>如果将 <code>configSUPPORT_STATIC_ALLOCATION</code> 设置为 <code>1</code> ，则应用程序编写者还必须提供两个回调函数： <code>vApplicationGetIdleTaskMemory()</code> 提供用于 RTOS 空闲任务的内存，以及（如果 <code>configUSE_TIMERS</code> 设置为 <code>1</code> ） <code>vApplicationGetTimerTaskMemory()</code> 提供用于以下目的的内存： RTOS 守护程序 / 计时器服务任务。</p><p>下面官方提供了示例：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/* configSUPPORT_STATIC_ALLOCATION is set to 1, so the application must provide an</span></pre></td></tr><tr><td data-num="2"></td><td><pre>implementation of vApplicationGetIdleTaskMemory() to provide the memory that is</pre></td></tr><tr><td data-num="3"></td><td><pre>used by the Idle task. */</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">void</span> <span class="token function">vApplicationGetIdleTaskMemory</span><span class="token punctuation">(</span> StaticTask_t <span class="token operator">*</span><span class="token operator">*</span>ppxIdleTaskTCBBuffer<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                                    StackType_t <span class="token operator">*</span><span class="token operator">*</span>ppxIdleTaskStackBuffer<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                                    <span class="token keyword">uint32_t</span> <span class="token operator">*</span>pulIdleTaskStackSize <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">/* If the buffers to be provided to the Idle task are declared inside this</span></pre></td></tr><tr><td data-num="9"></td><td><pre>function then they must be declared static – otherwise they will be allocated on</pre></td></tr><tr><td data-num="10"></td><td><pre>the stack and so not exists after this function exits. */</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">static</span> StaticTask_t xIdleTaskTCB<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">static</span> StackType_t uxIdleTaskStack<span class="token punctuation">[</span> configMINIMAL_STACK_SIZE <span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">/* Pass out a pointer to the StaticTask_t structure in which the Idle task’s</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    state will be stored. */</pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token operator">*</span>ppxIdleTaskTCBBuffer <span class="token operator">=</span> <span class="token operator">&amp;</span>xIdleTaskTCB<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token comment">/* Pass out the array that will be used as the Idle task’s stack. */</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token operator">*</span>ppxIdleTaskStackBuffer <span class="token operator">=</span> uxIdleTaskStack<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">/* Pass out the size of the array pointed to by *ppxIdleTaskStackBuffer.</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    Note that, as the array is necessarily of type StackType_t,</pre></td></tr><tr><td data-num="23"></td><td><pre>    configMINIMAL_STACK_SIZE is specified in words, not bytes. */</pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token operator">*</span>pulIdleTaskStackSize <span class="token operator">=</span> configMINIMAL_STACK_SIZE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment">/*———————————————————–*/</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment">/* configSUPPORT_STATIC_ALLOCATION and configUSE_TIMERS are both set to 1, so the</span></pre></td></tr><tr><td data-num="29"></td><td><pre>application must provide an implementation of vApplicationGetTimerTaskMemory()</pre></td></tr><tr><td data-num="30"></td><td><pre>to provide the memory that is used by the Timer service task. */</pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token keyword">void</span> <span class="token function">vApplicationGetTimerTaskMemory</span><span class="token punctuation">(</span> StaticTask_t <span class="token operator">*</span><span class="token operator">*</span>ppxTimerTaskTCBBuffer<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                                     StackType_t <span class="token operator">*</span><span class="token operator">*</span>ppxTimerTaskStackBuffer<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                                     <span class="token keyword">uint32_t</span> <span class="token operator">*</span>pulTimerTaskStackSize <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token comment">/* If the buffers to be provided to the Timer task are declared inside this</span></pre></td></tr><tr><td data-num="36"></td><td><pre>function then they must be declared static – otherwise they will be allocated on</pre></td></tr><tr><td data-num="37"></td><td><pre>the stack and so not exists after this function exits. */</pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token keyword">static</span> StaticTask_t xTimerTaskTCB<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token keyword">static</span> StackType_t uxTimerTaskStack<span class="token punctuation">[</span> configTIMER_TASK_STACK_DEPTH <span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token comment">/* Pass out a pointer to the StaticTask_t structure in which the Timer</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    task’s state will be stored. */</pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token operator">*</span>ppxTimerTaskTCBBuffer <span class="token operator">=</span> <span class="token operator">&amp;</span>xTimerTaskTCB<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token comment">/* Pass out the array that will be used as the Timer task’s stack. */</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token operator">*</span>ppxTimerTaskStackBuffer <span class="token operator">=</span> uxTimerTaskStack<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token comment">/* Pass out the size of the array pointed to by *ppxTimerTaskStackBuffer.</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    Note that, as the array is necessarily of type StackType_t,</pre></td></tr><tr><td data-num="50"></td><td><pre>    configTIMER_TASK_STACK_DEPTH is specified in words, not bytes. */</pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token operator">*</span>pulTimerTaskStackSize <span class="token operator">=</span> configTIMER_TASK_STACK_DEPTH<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="55"></td><td><pre> * Examples of the callback functions that must be provided by the application to</pre></td></tr><tr><td data-num="56"></td><td><pre> * supply the RAM used by the Idle and Timer Service tasks if </pre></td></tr><tr><td data-num="57"></td><td><pre> * configSUPPORT_STATIC_ALLOCATION is set to 1.</pre></td></tr><tr><td data-num="58"></td><td><pre> */</pre></td></tr></table></figure><p>有关更多信息，请参见 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL1N0YXRpY19Wc19EeW5hbWljX01lbW9yeV9BbGxvY2F0aW9uLmh0bWw=">Static Vs Dynamic Memory Allocation</span> 页面。</p><p><strong>32、configSUPPORT_DYNAMIC_ALLOCATION</strong></p><p>置 <code>1</code> （或未定义）：可以使用从 FreeRTOS 堆自动分配的 RAM 创建 RTOS 对象；</p><p>置 <code>0</code> ：只能使用应用程序编写器提供的 RAM 创建 RTOS 对象。</p><p>有关更多信息，请参见 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL1N0YXRpY19Wc19EeW5hbWljX01lbW9yeV9BbGxvY2F0aW9uLmh0bWw=">Static Vs Dynamic Memory Allocation</span> 页面。</p><p><strong>33、configTOTAL_HEAP_SIZE</strong></p><p>FreeRTOS 堆中可用的 RAM 总量；仅当 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL2EwMDExMC5odG1sI2NvbmZpZ1NVUFBPUlRfRFlOQU1JQ19BTExPQ0FUSU9O">configSUPPORT_DYNAMIC_ALLOCATION</span> 设置为 <code>1</code> 且应用程序使用 FreeRTOS 源代码下载中的四个堆内存分配方案之一（ <code>heap_1.c</code> 、 <code>heap_2.c</code> 、 <code>heap_4.c</code> 或 <code>heap_5.c</code> ）时，才使用此值。</p><p>注意，当使用 <code>heap_3</code> 时，该值的设置无效。</p><p>有关更多详细信息，请参见 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL2EwMDExMS5odG1s">内存配置</span> 部分。</p><p><strong>34、configAPPLICATION_ALLOCATED_HEAP</strong></p><p>默认情况下，<span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL2EwMDExMS5odG1s">FreeRTOS 堆</span> 由 FreeRTOS 声明，并由链接器放置在内存中；将 <code>configAPPLICATION_ALLOCATED_HEAP</code> 设置为 <code>1</code> 可以使堆改为由应用程序编写者声明，这允许应用程序编写者将堆放置在内存中任意位置。</p><p>如果使用 <code>heap_1.c</code> 、 <code>heap_2.c</code> 或 <code>heap_4.c</code> ，并且 <code>configAPPLICATION_ALLOCATED_HEAP</code> 设置为 <code>1</code> ，那么应用程序编写者必须提供一个 <code>uint8_t</code> 类型的数组，其名称和维数如下所示；该数组将用作 FreeRTOS 堆：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">uint8_t</span> ucHeap <span class="token punctuation">[</span>configTOTAL_HEAP_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>如何将数组放置在特定的内存位置取决于所使用的编译器，请参阅编译器的文档。</p><p><strong>35、configGENERATE_RUN_TIME_STATS</strong></p><p>该 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL3J0b3MtcnVuLXRpbWUtc3RhdHMuaHRtbA==">Run Time Stats</span> 页面描述了此参数的用法。</p><p><strong>36、configUSE_CO_ROUTINES</strong></p><p>置 <code>1</code> ：使用协程；</p><p>置 <code>0</code> ：不使用协程。</p><p>如果使用协程，必须在工程中包含 <code>croutine.c</code> 文件。</p><p>注意：协程（Co-routines）主要用于资源发非常受限的嵌入式系统（RAM 非常少），通常不会用于 32 位微处理器；<strong>在当前嵌入式硬件环境下，不建议使用协程，FreeRTOS 的开发者早已经停止开发协程</strong> 。</p><p><strong>37、configMAX_CO_ROUTINE_PRIORITIES</strong></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL2NvLXJvdXRpbmUtcHJpb3JpdGllcy5odG1s">应用程序协程（Co-routines）的有效优先级数目</span> 。任意数量的协同例程可以共享相同的优先级，使用协程可以单独的分配给任务优先级，请参阅 <code>configMAX_PRIORITIES</code> 。</p><p><strong>38、configUSE_TIMERS</strong></p><p>置 <code>1</code> ：使用软件定时器；</p><p>置 <code>0</code> ：不使用软件定时器</p><p>有关完整说明，请参见 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL1JUT1Mtc29mdHdhcmUtdGltZXIuaHRtbA==">FreeRTOS software timers</span> 页面。</p><p><strong>39、configTIMER_TASK_PRIORITY</strong></p><p>设置软件计时器服务 / 守护程序任务的优先级。</p><p>有关完整说明，请参见 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL1JUT1Mtc29mdHdhcmUtdGltZXIuaHRtbA==">FreeRTOS software timers</span> 页面。</p><p><strong>40、configTIMER_QUEUE_LENGTH</strong></p><p>设置软件计时器命令队列的长度。</p><p>有关完整说明，请参见 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL1JUT1Mtc29mdHdhcmUtdGltZXIuaHRtbA==">FreeRTOS software timers</span> 页面。</p><p><strong>41、configTIMER_TASK_STACK_DEPTH</strong></p><p>设置分配给软件计时器服务 / 守护程序任务的堆栈深度。</p><p>有关完整说明，请参见 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL1JUT1Mtc29mdHdhcmUtdGltZXIuaHRtbA==">FreeRTOS software timers</span> 页面。</p><p><strong>42、configKERNEL_INTERRUPT_PRIORITY 、configMAX_SYSCALL_INTERRUPT_PRIORITY 和 configMAX_API_CALL_INTERRUPT_PRIORITY</strong></p><p>包含 <code>configKERNEL_INTERRUPT_PRIORITY</code> 设置的硬件端口有 ARM Cortex-M3，PIC24，dsPIC，PIC32，SuperH 和 RX600。</p><p>包含 <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> 设置的硬件端口有 PIC32，RX600，ARM Cortex-A 和 ARM Cortex-M。</p><p><code>configMAX_API_CALL_INTERRUPT_PRIORITY</code> 是 <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> 的新名称，仅由较新的端口使用，两者是等效的。</p><p><code>configKERNEL_INTERRUPT_PRIORITY</code> 应该设置为最低优先级。</p><p>请注意，在以下讨论中，只能从中断服务例程中调用以 “FromISR” 结尾的 API 函数。</p><p>对于仅支持 <code>configKERNEL_INTERRUPT_PRIORITY</code> 的硬件端口：<br><code>configKERNEL_INTERRUPT_PRIORITY</code> 设置 RTOS 内核本身使用的中断优先级。调用 API 函数的中断也必须以此优先级执行。不调用 API 函数的中断可以以更高的优先级执行，因此不会因 RTOS 内核活动（在硬件本身的限制内）而延迟执行。</p><p>对于同时支持 <code>configKERNEL_INTERRUPT_PRIORITY</code> 和 <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> 的硬件端口：<br><code>configKERNEL_INTERRUPT_PRIORITY</code> 设置 RTOS 内核本身使用的中断优先级。 <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> 设置最高的中断优先级，从中可以调用中断安全的 FreeRTOS API 函数。</p><p>通过设置 <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> 的优先级级别高于 <code>configKERNEL_INTERRUPT_PRIORITY</code> 可以实现完整的中断嵌套模式；<strong>这意味着即使在关键部分内部，FreeRTOS 内核也不会完全禁用中断</strong> 。</p><p>此外，这对于分段内核架构的微处理器是有利的。但是请注意，当一个新的中断被接受时，某些微控制器体系结构（在硬件中）将禁用中断，这意味着在硬件接受中断和 FreeRTOS 代码重新启用中断之间的短时间内不可避免地禁用中断。</p><p>不调用 API 函数的中断可以以高于 <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> 的优先级执行，因此不会因 RTOS 内核执行而延迟。</p><p>例如：假设一个微控制器有 8 个中断优先级别：0 表示最低优先级，7 表示最高优先级（Cortex-M3 和 Cortex-M4 内核优先数和优先级别正好与之相反，后续文章会专门介绍它们）下在图描述了如果将两个配置常量设置为 4 和 0，则在每个优先级上可以做什么和不能做什么，如下所示：</p><p><img data-src="20200217155104470.png" alt="img"></p><p>这些配置参数允许非常灵活的中断处理：</p><ul><li>在系统中可以像其它任务一样为中断处理任务分配优先级。这些任务通过一个相应中断唤醒。中断服务程序（ISR）本身应写得尽可能短，仅用于更新数据然后唤醒高优先级任务；然后，ISR 退出后，直接运行被唤醒的任务，因此中断处理（根据中断获取的数据来进行的相应处理）在时间上是连续的，就像 ISR 在完成这些工作。这样做的好处是，在执行处理程序任务时，所有中断都保持启用状态。</li><li>支持 <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> 的硬件端口将进一步扩展：允许使用完全嵌套的模型，其中 RTOS 内核中断优先级和 <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> 之间的中断可以嵌套并允许调用 API 函数；而优先级高于 <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> 的中断不会因 RTOS 内核活动而延迟。</li><li>在最高系统调用优先级之上运行的 ISR（大于 <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> 的优先级中断）不会被 RTOS 内核本身掩盖，因此它们的响应能力不受 RTOS 内核功能的影响。对于要求非常高的时间精度的中断（例如，执行电机转向的中断）而言，这是理想的选择；但是，在这类中断的中断服务例程中绝不可以调用 FreeRTOS 的 API 函数。</li></ul><p>要使用此方案，您的应用程序设计必须遵守以下规则：<strong>使用 FreeRTOS API 的任何中断必须设置为与 RTOS 内核相同的优先级（由 <code>configKERNEL_INTERRUPT_PRIORITY</code> 宏配置）；或者对于包含支持 <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> 功能的硬件端口，设置低于 <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> 定义的优先级</strong></p><p>针对 ARM Cortex-M3 和 ARM Cortex-M4 用户的特别说明：请阅读 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZXJ0b3Mub3JnL1JUT1MtQ29ydGV4LU0zLU00Lmh0bWw=">专门介绍 ARM Cortex-M 设备上的中断优先级设置的页面</span> 。至少要记住，ARM Cortex-M3 内核使用数字低优先级数字来表示高优先级中断，这看起来似乎违反直觉，而且很容易忘记！如果您希望为中断分配一个低优先级，请不要为其分配优先级 0（或其他低数值），因为这可能导致在系统中实际上是具有最高优先级中断的；因此，如果这个优先级高于 <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> ，将会导致系统崩溃。</p><p>实际上，ARM Cortex-M3 内核的最低优先级为 255，但是，不同的 ARM Cortex-M3 供应商实现了不同数量的优先级位，并提供了期望以不同方式指定优先级的库函数。例如，在 STM32 上，您可以在 ST 驱动程序库调用中，根据实际情况把最低优先级指定为 15，而最高优先级为 0。</p><p>总结一下就是，在 FreeRtos 中调用中断关闭和中断开启 API 函数（例如在临界区区域内），其控制只对 <code>configKERNEL_INTERRUPT_PRIORITY</code> 到 <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> 之间的优先级有效，其余的中断不受影响</p><p><strong>43、configASSERT</strong></p><p><code>configASSERT()</code> 宏的语义与标准 C <code>assert()</code> 宏相同。如果传递给 <code>configASSERT()</code> 的参数为零，则触发断言。</p><p>在整个 FreeRTOS 源文件中都会调用 <code>configASSERT()</code> 来检查应用程序是如何使用 FreeRTOS；因此强烈建议使用定义的 <code>configASSERT()</code> 开发 FreeRTOS 应用程序。</p><p>举一个例子，我们想把非法参数所在的文件名和代码行数打印出来，可以先定义一个函数 <code>vAssertCalled</code> ，并传入触发 <code>configASSERT()</code> 调用的文件名和行号（__FILE__和 __LINE__是大多数编译器提供的标准宏）：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/* Define configASSERT() to call vAssertCalled() if the assertion fails.  The assertion</span></pre></td></tr><tr><td data-num="2"></td><td><pre>has failed if the value of the parameter passed into configASSERT() equals zero. */</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">configASSERT</span><span class="token expression"><span class="token punctuation">(</span> <span class="token punctuation">(</span> x <span class="token punctuation">)</span> <span class="token punctuation">)</span>     <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">(</span> x <span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token function">vAssertCalled</span><span class="token punctuation">(</span> <span class="token constant">__FILE__</span><span class="token punctuation">,</span> <span class="token constant">__LINE__</span> <span class="token punctuation">)</span></span></span></pre></td></tr></table></figure><p>这里只是为了演示，因为 <code>vAssertCalled()</code> 不是 FreeRTOS 里面的函数，可以将 <code>configASSERT()</code> 定义为采取应用程序编写者认为适当的任何操作。通常以这样的方式定义 <code>configASSERT()</code> ，它可以防止应用程序进一步执行；这有两个原因：在断言停止的地方，应用程序编写者可以调试产生断言的原因；若继续执行触发断言之后的程序可能会导致系统崩溃。</p><p>请注意，定义 <code>configASSERT()</code> 会增加应用程序代码的大小和执行时间；当应用程序稳定后，只需注释掉 <code>FreeRTOSConfig.h</code> 中的 <code>configASSERT()</code> 定义，就可以消除额外的开销了。</p><p>如果在调试器的控制下运行 FreeRTOS，则可以把 <code>configASSERT()</code> 定义为禁用中断并处于循环中的状态，如下所示。这将导致在断言测试失败的行上停止代码的运行，应用程序编写者只需要暂停调试器，就会立即将您带到有问题的行，以便您查看失败的原因。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/* Define configASSERT() to disable interrupts and sit in a loop. */</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">configASSERT</span><span class="token expression"><span class="token punctuation">(</span> <span class="token punctuation">(</span> x <span class="token punctuation">)</span> <span class="token punctuation">)</span>     <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">(</span> x <span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">taskDISABLE_INTERRUPTS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></span></span></pre></td></tr></table></figure><p><strong>44、configINCLUDE_APPLICATION_DEFINED_PRIVILEGED_FUNCTIONS</strong></p><p><code>configINCLUDE_APPLICATION_DEFINED_PRIVILEGED_FUNCTIONS</code> 仅由 FreeRTOS MPU 使用。</p><p>如果 <code>configINCLUDE_APPLICATION_DEFINED_PRIVILEGED_FUNCTIONS</code> 设置为 <code>1</code> ，则应用程序编写者必须提供一个名为 “ <code>application_defined_privileged_functions.h</code> ” 的头文件，可以在其之中实现应用程序编写者需要以特权模式执行的功能。请注意，尽管扩展名为 <code>.h</code> ，但头文件应包含 C 函数的实现，而不仅仅是函数的原型。</p><p>在 “ <code>application_defined_privileged_functions.h</code> ” 中实现的函数必须分别使用 <code>prvRaisePrivilege()</code> 函数和 <code>portRESET_PRIVILEGE()</code> 宏来保存和恢复处理器的特权状态.</p><p>例如，如果库提供的打印功能访问了应用程序编写者无法控制的 RAM，因此无法分配给受内存保护的用户模式任务，则可以使用以下代码将打印功能封装在特权功能中：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">MPU_debug_printf</span><span class="token punctuation">(</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pcMessage <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">/* State the privilege level of the processor when the function was called. */</span></pre></td></tr><tr><td data-num="4"></td><td><pre>BaseType_t xRunningPrivileged <span class="token operator">=</span> <span class="token function">prvRaisePrivilege</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">/* Call the library function, which now has access to all RAM. */</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">debug_printf</span><span class="token punctuation">(</span> pcMessage <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">/* Reset the processor privilege level to its original value. */</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token function">portRESET_PRIVILEGE</span><span class="token punctuation">(</span> xRunningPrivileged <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>该技术只能在开发过程中使用，而不能在部署过程中使用，因为它会绕过内存保护。</p><h1 id="包含参数"><a class="anchor" href="#包含参数">#</a> 包含参数</h1><p>以 “INCLUDE” 开头的宏允许将实时内核中那些未被应用程序使用的组件从构建中排除，这样可以确保 RTOS 使用的 ROM 或 RAM 不会超出特定嵌入式应用程序所需的数量</p><p>每个宏采用以下形式：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>INCLUDE_FunctionName</pre></td></tr></table></figure><p>其中 FunctionName 表示可以选择排除的 API 函数（或函数集）</p><p>置 <code>1</code> ：使用该 API 函数；</p><p>置 <code>0</code> ：不使用该 API 函数。</p><p>例如，包含 <code>vTaskDelete()</code> API 函数，请使用：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_vTaskDelete</span>    <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr></table></figure><p>要从构建中排除 <code>vTaskDelete()</code> ，请使用：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_vTaskDelete</span>    <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr></table></figure><h1 id="配置项裁剪"><a class="anchor" href="#配置项裁剪">#</a> 配置项裁剪</h1><p>在了解完上面的各项参数后，就可以配置了，具体如下：</p><pre><code class="language-Swift">/*
    FreeRTOS V9.0.0 - Copyright (C) 2016 Real Time Engineers Ltd.
    All rights reserved

    VISIT http://www.FreeRTOS.org TO ENSURE YOU ARE USING THE LATEST VERSION.

    This file is part of the FreeRTOS distribution.

    FreeRTOS is free software; you can redistribute it and/or modify it under
    the terms of the GNU General Public License (version 2) as published by the
    Free Software Foundation &gt;&gt;&gt;&gt; AND MODIFIED BY &lt;&lt;&lt;&lt; the FreeRTOS exception.

    ***************************************************************************
    &gt;&gt;!   NOTE: The modification to the GPL is included to allow you to     !&lt;&lt;
    &gt;&gt;!   distribute a combined work that includes FreeRTOS without being   !&lt;&lt;
    &gt;&gt;!   obliged to provide the source code for proprietary components     !&lt;&lt;
    &gt;&gt;!   outside of the FreeRTOS kernel.                                   !&lt;&lt;
    ***************************************************************************

    FreeRTOS is distributed in the hope that it will be useful, but WITHOUT ANY
    WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
    FOR A PARTICULAR PURPOSE.  Full license text is available on the following
    link: http://www.freertos.org/a00114.html

    ***************************************************************************
     *                                                                       *
     *    FreeRTOS provides completely free yet professionally developed,    *
     *    robust, strictly quality controlled, supported, and cross          *
     *    platform software that is more than just the market leader, it     *
     *    is the industry's de facto standard.                               *
     *                                                                       *
     *    Help yourself get started quickly while simultaneously helping     *
     *    to support the FreeRTOS project by purchasing a FreeRTOS           *
     *    tutorial book, reference manual, or both:                          *
     *    http://www.FreeRTOS.org/Documentation                              *
     *                                                                       *
    ***************************************************************************

    http://www.FreeRTOS.org/FAQHelp.html - Having a problem?  Start by reading
    the FAQ page &quot;My application does not run, what could be wrong?&quot;.  Have you
    defined configASSERT()?

    http://www.FreeRTOS.org/support - In return for receiving this top quality
    embedded software for free we request you assist our global community by
    participating in the support forum.

    http://www.FreeRTOS.org/training - Investing in training allows your team to
    be as productive as possible as early as possible.  Now you can receive
    FreeRTOS training directly from Richard Barry, CEO of Real Time Engineers
    Ltd, and the world's leading authority on the world's leading RTOS.

    http://www.FreeRTOS.org/plus - A selection of FreeRTOS ecosystem products,
    including FreeRTOS+Trace - an indispensable productivity tool, a DOS
    compatible FAT file system, and our tiny thread aware UDP/IP stack.

    http://www.FreeRTOS.org/labs - Where new FreeRTOS products go to incubate.
    Come and try FreeRTOS+TCP, our new open source TCP/IP stack for FreeRTOS.

    http://www.OpenRTOS.com - Real Time Engineers ltd. license FreeRTOS to High
    Integrity Systems ltd. to sell under the OpenRTOS brand.  Low cost OpenRTOS
    licenses offer ticketed support, indemnification and commercial middleware.

    http://www.SafeRTOS.com - High Integrity Systems also provide a safety
    engineered and independently SIL3 certified version for use in safety and
    mission critical applications that require provable dependability.

    1 tab == 4 spaces!
*/

#ifndef FREERTOS_CONFIG_H
#define FREERTOS_CONFIG_H

/*-----------------------------------------------------------
 * Application specific definitions.
 *
 * These definitions should be adjusted for your particular hardware and
 * application requirements.
 *
 * THESE PARAMETERS ARE DESCRIBED WITHIN THE 'CONFIGURATION' SECTION OF THE
 * FreeRTOS API DOCUMENTATION AVAILABLE ON THE FreeRTOS.org WEB SITE. 
 *
 * See http://www.freertos.org/a00110.html.
 *----------------------------------------------------------*/

/* Here is a good place to include header files that are required across
your application. */
// #include &quot;stm32f10x.h&quot;


#if defined(__ICCARM__) || defined(__CC_ARM) || defined(__GNUC__)
    /* Clock manager provides in this variable system core clock frequency */
    #include &lt;stdint.h&gt;
	#include &lt;stdio.h&gt;
    extern uint32_t SystemCoreClock;
#endif

#define configUSE_PREEMPTION                    1
#define configUSE_PORT_OPTIMISED_TASK_SELECTION 1
#define configUSE_TICKLESS_IDLE                 0
#define configCPU_CLOCK_HZ                      ( ( unsigned long ) SystemCoreClock )
#define configTICK_RATE_HZ                      ( ( TickType_t ) 1000 )
#define configMAX_PRIORITIES                    ( 5 )
#define configMINIMAL_STACK_SIZE                ( ( unsigned short ) 128 )
#define configMAX_TASK_NAME_LEN                 ( 16 )
#define configUSE_16_BIT_TICKS                  0
#define configIDLE_SHOULD_YIELD                 1
#define configUSE_TASK_NOTIFICATIONS            1
#define configUSE_MUTEXES                       0
#define configUSE_RECURSIVE_MUTEXES             0
#define configUSE_COUNTING_SEMAPHORES           0
#define configUSE_ALTERNATIVE_API               0 /* Deprecated! */
#define configQUEUE_REGISTRY_SIZE               10
#define configUSE_QUEUE_SETS                    0
#define configUSE_TIME_SLICING                  1
#define configUSE_NEWLIB_REENTRANT              0
#define configENABLE_BACKWARD_COMPATIBILITY     0
#define configNUM_THREAD_LOCAL_STORAGE_POINTERS 5
#define configSTACK_DEPTH_TYPE                  uint16_t
#define configMESSAGE_BUFFER_LENGTH_TYPE        size_t

/* Memory allocation related definitions. */
#define configSUPPORT_STATIC_ALLOCATION         0
#define configSUPPORT_DYNAMIC_ALLOCATION        1
#define configTOTAL_HEAP_SIZE                   ( ( size_t ) ( 17 * 1024 ) )
#define configAPPLICATION_ALLOCATED_HEAP        0

/* Hook function related definitions. */
#define configUSE_IDLE_HOOK                     0
#define configUSE_TICK_HOOK                     0
#define configCHECK_FOR_STACK_OVERFLOW          0
#define configUSE_MALLOC_FAILED_HOOK            0
#define configUSE_DAEMON_TASK_STARTUP_HOOK      0

/* Run time and task stats gathering related definitions. */
#define configGENERATE_RUN_TIME_STATS           0
#define configUSE_TRACE_FACILITY                0
#define configUSE_STATS_FORMATTING_FUNCTIONS    1

/* Co-routine related definitions. */
#define configUSE_CO_ROUTINES                   0
#define configMAX_CO_ROUTINE_PRIORITIES         ( 2 )

/* Software timer related definitions. */
#define configUSE_TIMERS                        0
#define configTIMER_TASK_PRIORITY               (configMAX_PRIORITIES-1)
#define configTIMER_QUEUE_LENGTH                10
#define configTIMER_TASK_STACK_DEPTH            (configMINIMAL_STACK_SIZE*2)

/* Interrupt nesting behaviour configuration. */
#ifdef __NVIC_PRIO_BITS																	/* user add */
	#define configPRIO_BITS       			__NVIC_PRIO_BITS
#else
	#define configPRIO_BITS       			4                  
#endif /* __NVIC_PRIO_BITS */
/* This is the value being used as per the ST library which permits 16
priority values, 0 to 15.  This must correspond to the
configKERNEL_INTERRUPT_PRIORITY setting.  Here 15 corresponds to the lowest
NVIC value of 255. */
#define configLIBRARY_KERNEL_INTERRUPT_PRIORITY		15								// user add
#define configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY	11								// user add
/* This is the raw value as per the Cortex-M3 NVIC.  Values can be 255
(lowest) to 0 (1?) (highest). */
/* equivalent to 0xf0, or NVIC 240. */
#define configKERNEL_INTERRUPT_PRIORITY         (configLIBRARY_KERNEL_INTERRUPT_PRIORITY &lt;&lt; (8 - configPRIO_BITS))//[dependent of processor]
/* !!!! configMAX_SYSCALL_INTERRUPT_PRIORITY must not be set to zero !!!! */
/* equivalent to 0xb0, or priority 11. */
#define configMAX_SYSCALL_INTERRUPT_PRIORITY    (configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY &lt;&lt; (8 - configPRIO_BITS))//[dependent on processor and application]
#define configMAX_API_CALL_INTERRUPT_PRIORITY   //[dependent on processor and application]

/* Define to trap errors during development. */
#define vAssertCalled(char, int)			printf(&quot;Error:%s,%d\r\n&quot;,char,int)		// user add
//#define configASSERT( ( x ) ) if( ( x ) == 0 )	vAssertCalled( __FILE__, __LINE__ )
#define configASSERT( x )	  if( ( x ) == 0 ) 	vAssertCalled(__FILE__,__LINE__)		// The user needs to modify

/* FreeRTOS MPU specific definitions. */
#define configINCLUDE_APPLICATION_DEFINED_PRIVILEGED_FUNCTIONS 0

/* Optional functions - most linkers will remove unused functions anyway. */
#define INCLUDE_vTaskPrioritySet                1
#define INCLUDE_uxTaskPriorityGet               1
#define INCLUDE_vTaskDelete                     1
#define INCLUDE_vTaskSuspend                    1
#define INCLUDE_xResumeFromISR                  1
#define INCLUDE_vTaskDelayUntil                 1
#define INCLUDE_vTaskDelay                      1
#define INCLUDE_xTaskGetSchedulerState          1
#define INCLUDE_xTaskGetCurrentTaskHandle       1
#define INCLUDE_uxTaskGetStackHighWaterMark     0
#define INCLUDE_xTaskGetIdleTaskHandle          0
#define INCLUDE_eTaskGetState                   1
#define INCLUDE_xEventGroupSetBitFromISR        1
#define INCLUDE_xTimerPendFunctionCall          0
#define INCLUDE_xTaskAbortDelay                 0
#define INCLUDE_xTaskGetHandle                  0
#define INCLUDE_xTaskResumeFromISR              1

/* A header file that defines trace macro can be included here. */

#define xPortPendSVHandler   			PendSV_Handler
#define xPortSysTickHandler 			SysTick_Handler
#define vPortSVCHandler      			SVC_Handler


#endif /* FREERTOS_CONFIG_H */
</code></pre><p>然后，值得注意的是，在 Cortex-M3 硬件端口下，FreeRTOS 使用 SysTick 作为系统节拍时钟，使用 SVC 和 PendSVC 进行上下文切换；异常中断服务代码位于 port.c 文件中，FreeRTOS 的作者已经为各种架构的 CPU 写好了这些代码，可以直接拿来用，因此我们只需要进行更改调用；这里有两种方法：</p><ul><li><strong>第一种是在 Cortex-M3 启动文件中进行替换，将这些异常中断入口地址挂接到启动代码中</strong></li></ul><p><img data-src="20200217153706659.png" alt="img"></p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>DCD     SVC_Handler            换成：   DCD     vPortSVCHandler</pre></td></tr><tr><td data-num="2"></td><td><pre>DCD     PendSV_Handler         换成：   DCD     xPortPendSVHandler</pre></td></tr><tr><td data-num="3"></td><td><pre>DCD     SysTick_Handler        换成：   DCD     xPortSysTickHandler</pre></td></tr></table></figure><p>在方框中，按照上面的信息把向量地址名替换掉</p><ul><li><strong>第二种是利用宏重定义一下，并且要把 ST 官方预留的中断屏蔽掉，转而使用 FreeRTOS 中实现的函数功能</strong></li></ul><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">xPortPendSVHandler</span>   			<span class="token expression">PendSV_Handler</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">xPortSysTickHandler</span> 			<span class="token expression">SysTick_Handler</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">vPortSVCHandler</span>      			<span class="token expression">SVC_Handler</span></span></pre></td></tr></table></figure><p>在 <code>FreeRTOSConfig.h</code> 头文件中添加以上宏，看上面给出的应用代码，然后再注释掉 ST 预留的中断函数：</p><p><img data-src="20200217154404470.png" alt="img"></p><p>在这里是利用了宏 <code>_FreeRTOS</code> 来管理，当然你也可以直接注释，又或者设置成弱定义函数，随你喜欢，只要不出现重命名就好了。</p><div class="tags"><a href="/tags/history/" rel="tag"><i class="ic i-tag"></i> history</a> <a href="/tags/FreeRTOS/" rel="tag"><i class="ic i-tag"></i> FreeRTOS</a> <a href="/tags/RTOS/" rel="tag"><i class="ic i-tag"></i> RTOS</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-02-13 22:17:39" itemprop="dateModified" datetime="2023-02-13T22:17:39+08:00">2023-02-13</time></span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="freertos-config/" class="item leancloud_visitors" data-flag-title="FreeRTOS 篇章之 FreeRTOSConfig.h 分析" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span id="busuanzi_value_page_pv"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="夏沫の浅雨 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="夏沫の浅雨 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>夏沫の浅雨 <i class="ic i-at"><em>@</em></i>命运转轮</li><li class="link"><strong>本文链接：</strong> <a href="https://arachnid.cc/freertos-config/" title="FreeRTOS 篇章之 FreeRTOSConfig.h 分析">https://arachnid.cc/freertos-config/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/freertos-heap/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;arachnid.cc&#x2F;picture&#x2F;(30).webp" title="FreeRTOS 篇章之 heap 堆内存分配分析"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> FreeRTOS</span><h3>FreeRTOS 篇章之 heap 堆内存分配分析</h3></a></div><div class="item right"><a href="/freertos-task/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;arachnid.cc&#x2F;picture&#x2F;(1).webp" title="FreeRTOS 篇章之任务管理"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> FreeRTOS</span><h3>FreeRTOS 篇章之任务管理</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A7%BB%E6%A4%8D%E4%BF%AE%E6%94%B9"><span class="toc-number">1.</span> <span class="toc-text">移植修改</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%A1%B9%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.</span> <span class="toc-text">配置项详解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8C%85%E5%90%AB%E5%8F%82%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">包含参数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%A1%B9%E8%A3%81%E5%89%AA"><span class="toc-number">4.</span> <span class="toc-text">配置项裁剪</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/freertos-file-analyse/" rel="bookmark" title="FreeRTOS 篇章之官方源码文档分析">FreeRTOS 篇章之官方源码文档分析</a></li><li><a href="/freertos-system-transplant/" rel="bookmark" title="FreeRTOS 篇章之系统移植">FreeRTOS 篇章之系统移植</a></li><li><a href="/freertos-heap/" rel="bookmark" title="FreeRTOS 篇章之 heap 堆内存分配分析">FreeRTOS 篇章之 heap 堆内存分配分析</a></li><li class="active"><a href="/freertos-config/" rel="bookmark" title="FreeRTOS 篇章之 FreeRTOSConfig.h 分析">FreeRTOS 篇章之 FreeRTOSConfig.h 分析</a></li><li><a href="/freertos-task/" rel="bookmark" title="FreeRTOS 篇章之任务管理">FreeRTOS 篇章之任务管理</a></li><li><a href="/freertos-queue/" rel="bookmark" title="FreeRTOS 篇章之队列管理">FreeRTOS 篇章之队列管理</a></li><li><a href="/freertos-binary-semaphore/" rel="bookmark" title="FreeRTOS 篇章之二值信号量">FreeRTOS 篇章之二值信号量</a></li><li><a href="/freertos-mutex-semaphore/" rel="bookmark" title="FreeRTOS 篇章之互斥量">FreeRTOS 篇章之互斥量</a></li><li><a href="/freertos-critical-scheduler/" rel="bookmark" title="FreeRTOS 篇章之临界区与调度器">FreeRTOS 篇章之临界区与调度器</a></li><li><a href="/freertos-event/" rel="bookmark" title="FreeRTOS 篇章之事件位和事件组">FreeRTOS 篇章之事件位和事件组</a></li><li><a href="/freertos-task-notify/" rel="bookmark" title="FreeRTOS 篇章之任务通知">FreeRTOS 篇章之任务通知</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="夏沫の浅雨" data-src="/images/avatar.jpg"><p class="name" itemprop="name">夏沫の浅雨</p><div class="description" itemprop="description">不曾亏欠，不曾辜负，如此足矣</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">57</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">5</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">19</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FyYWNobmlkLTk3" title="https:&#x2F;&#x2F;github.com&#x2F;Arachnid-97"><i class="ic i-github"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友人帐</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-info-circle"></i>关于</a></li><li class="item"><a href="/atom.xml" rel="section"><i class="ic i-rss"></i>RSS</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/freertos-heap/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/freertos-task/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/inductor" title="三大无源器件之电感">三大无源器件之电感<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Hexo/" title="分类于 Hexo-shoka">Hexo-shoka</a></div><span><a href="/hexo-shoka-create" title="博客搭建笔记之 Hexo-shoka">博客搭建笔记之 Hexo-shoka<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/rt-thread-summarize" title="RT-Thread 应用总结">RT-Thread 应用总结<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/altium-designer-summary" title="Altium Designer 常用总结">Altium Designer 常用总结<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/logic-device" title="逻辑门、锁存器和触发器">逻辑门、锁存器和触发器<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/middleware/" title="分类于 middleware">middleware</a></div><span><a href="/cjson-api-next-part" title="cJSON库 API解析（下）">cJSON库 API解析（下）<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/RTOS/" title="分类于 FreeRTOS">FreeRTOS</a></div><span><a href="/freertos-queue" title="FreeRTOS 篇章之队列管理">FreeRTOS 篇章之队列管理<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/modbus/" title="分类于 modbus">modbus</a></div><span><a href="/modbus-ascii-protocol" title="Modbus家族之 ASCII">Modbus家族之 ASCII<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/resistor" title="三大无源器件之电阻">三大无源器件之电阻<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/using-git-command" title="git 应用速查">git 应用速查<i class="ic i-link-alt"></i></a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">夏沫の浅雨 @ Arachnid's blog</span></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="count"><span class="icon"><i class="ic i-person"></i> <span id="busuanzi_value_site_uv"></span>人 <span class="post-meta-divider">|</span> <span class="icon"><i class="ic i-eye"></i> <span id="busuanzi_value_site_pv"></span>次 <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">387k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">6:35</span></span></span></div><div class="create_time"><span class="icon"><i class="ic i-clock"></i> <span id="timeDate">正在加载</span> <span id="times">...</span><script>function createtime(){var n=new Date("04/28/2022 15:45:50");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML=" 本站存活 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}var now=new Date;setInterval("createtime()",250)</script></span></div><div class="powered-by">Powered-by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"freertos-config/",favicon:{show:"ψ(｀∇´)ψ 欢迎回来!",hide:"《原子弹入门及制造》"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script async src="/js/sakura-small.js"></script><script src="/js/combined-file.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"right",width:210,height:380,hOffset:50,vOffset:-25},mobile:{show:!1,scale:.5},react:{opacityDefault:.7,opacityOnHover:.8},log:!1})</script></body></html><!-- rebuild by hrmmi -->