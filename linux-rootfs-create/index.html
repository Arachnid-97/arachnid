<!-- build time:Mon Aug 25 2025 21:32:03 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="命运转轮" href="https://arachnid.cc/rss.xml"><link rel="alternate" type="application/atom+xml" title="命运转轮" href="https://arachnid.cc/atom.xml"><link rel="alternate" type="application/json" title="命运转轮" href="https://arachnid.cc/feed.json"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Linux,arm_linux"><link rel="canonical" href="https://arachnid.cc/linux-rootfs-create/"><title>Linux 根文件系统的构建 | Arachnid's blog = 命运转轮 = Life is ...the time you did something you're afraid of doing</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="loader-state"><div aria-label="Orange and tan hamster running in a metal wheel" role="img" class="wheel-and-hamster"><div class="wheel"></div><div class="hamster"><div class="hamster__body"><div class="hamster__head"><div class="hamster__ear"></div><div class="hamster__eye"></div><div class="hamster__nose"></div></div><div class="hamster__limb hamster__limb--fr"></div><div class="hamster__limb hamster__limb--fl"></div><div class="hamster__limb hamster__limb--br"></div><div class="hamster__limb hamster__limb--bl"></div><div class="hamster__tail"></div></div></div><div class="spoke"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Linux 根文件系统的构建<i class="ic i-link-alt"></i></h1><div class="meta"><span class="item" title="创建时间：2023-03-08 20:24:36"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-03-08T20:24:36+08:00">2023-03-08</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>17k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>17 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Arachnid's blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://arachnid.cc/picture/(6).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(14).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(10).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(32).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(11).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(12).webp"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="cn"><link itemprop="mainEntityOfPage" href="https://arachnid.cc/linux-rootfs-create/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.webp"><meta itemprop="name" content="夏沫の浅雨"><meta itemprop="description" content="Life is ...the time you did something you're afraid of doing, 不曾亏欠，不曾辜负，如此足矣"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="命运转轮"></span><div class="body md" itemprop="articleBody"><blockquote><p>开发平台：Ubuntu 18.04.6</p><p>目标平台：imx-6ull</p><p>busybox 版本：<span class="exturl" data-url="aHR0cHM6Ly9idXN5Ym94Lm5ldC9kb3dubG9hZHMvYnVzeWJveC0xLjMyLjAudGFyLmJ6Mg==">busybox-1.32.0.tar.bz2</span></p><p>编译工具链：gcc versions 10.3.1 20210621 (GNU Toolchain for the A-profile Architecture 10.3-2021.07 (arm-10.29))</p></blockquote><h1 id="环境搭建"><a class="anchor" href="#环境搭建">#</a> 环境搭建</h1><h2 id="交叉编译器"><a class="anchor" href="#交叉编译器">#</a> 交叉编译器</h2><p>关于 arm linux 交叉编译工具链的搭建，这里就再不展开说明了，毕竟在此之前如果有移植过 uboot，那么这里就可以省略了，对于没有搭过交叉编译工具链的，可以查看上一篇 <a href="https://arachnid.cc/6ull-uboot-transplant/">imx-6ULL uboot 移植</a> 的交叉编译搭建的环节。</p><h1 id="文件系统"><a class="anchor" href="#文件系统">#</a> 文件系统</h1><p>你可能听过这么一句 “Unix 系统中一切皆文件” 的话，它是指 Unix 系统中的所有的一切都可以通过文件的方式访问、管理，即使不是文件，也以文件的形式来管理；那么对于这些文件的管理，需要一个系统去管理集中访问，而这样一个系统称为文件系统，它可以使我们以文件 IO 的形式对文件目录进行访问，而非以 Flash 存储地址进行访问，在使用上更为方便轻松。</p><h2 id="组成"><a class="anchor" href="#组成">#</a> 组成</h2><p>对于现有的 Linux 版本，不同的 Linux 衍生版本其文件系统的根目录都略有不同，但整体上的组成没多大区别。</p><p><img data-src="image-20240817230144056.png" alt="image-20240817230144056"></p><p><img data-src="image-20240817230822485.png" alt="image-20240817230822485"></p><p>一般来说，在构成最小 rootfs 的目录结构会包含以下几个：</p><table><thead><tr><th style="text-align:left">目录</th><th style="text-align:left">说明</th><th style="text-align:left">补充</th></tr></thead><tbody><tr><td style="text-align:left">bin</td><td style="text-align:left">可执行文件，主要的是系统命令，普通用户和 root 都可以执行</td><td style="text-align:left">必须存在</td></tr><tr><td style="text-align:left">dev</td><td style="text-align:left">设备文件，设备树定义的节点就在这里</td><td style="text-align:left">必须存在</td></tr><tr><td style="text-align:left">etc</td><td style="text-align:left">存放着各配置文件</td><td style="text-align:left">必须存在</td></tr><tr><td style="text-align:left">home</td><td style="text-align:left">系统预设的使用者家目录</td><td style="text-align:left">非必须</td></tr><tr><td style="text-align:left">lib</td><td style="text-align:left">存放的是 32 bit 系统中的动态和静态链接库文件</td><td style="text-align:left">必须存在</td></tr><tr><td style="text-align:left">lib64</td><td style="text-align:left">64 bit 桌面系统存在的东西，存放着支持 64 bit 的运行库</td><td style="text-align:left">嵌入式系统不需要</td></tr><tr><td style="text-align:left">mnt</td><td style="text-align:left">临时挂载目录，一般是空目录</td><td style="text-align:left">非必须</td></tr><tr><td style="text-align:left">opt</td><td style="text-align:left">第三方软件安装存放目录 ，目前都安装在 /usr/local 目录里</td><td style="text-align:left">非必须</td></tr><tr><td style="text-align:left">proc</td><td style="text-align:left">虚拟文件系统，是系统内存的映射，主要存放系统的内核、进程和网络状态</td><td style="text-align:left">必须存在</td></tr><tr><td style="text-align:left">sbin</td><td style="text-align:left">系统管理命令存放目录，只有 root 可以使用，普通用户只可查看</td><td style="text-align:left">必须存在</td></tr><tr><td style="text-align:left">sys</td><td style="text-align:left">系统使用的目录，虚拟文件系统。和 /proc/ 相似，该目录中的数据都保存在内存中</td><td style="text-align:left">必须存在</td></tr><tr><td style="text-align:left">usr</td><td style="text-align:left">是 Unix Software Resource <code></code> 的缩写，也就是 Unix 操作系统软件资源目录</td><td style="text-align:left">非必须</td></tr><tr><td style="text-align:left">var</td><td style="text-align:left">存放一些可以改变的数据，包括系统运行中需调用或改变的数据</td><td style="text-align:left">必须存在</td></tr></tbody></table><h1 id="构建"><a class="anchor" href="#构建">#</a> 构建</h1><p>根文件系统的制作方法有很多，像在已知的系统中把整个根文件系统打包出来然后再进行裁剪，或者使用三大神器 busybox、buildroot、yocto 构建等。</p><p>利用已有的系统提取裁剪，这种方法一般适用于同平台版本的情况下，对于不同的平台版本下，可能会出现运行环境错误的情况；</p><p>使用 busybox 构建文件系统，则仅仅只是帮我们构建好一些 shell 命令程序集，像 lib 库、/etc 目录下的一些文件都需要自己手动创建，如果需要用到第三方软件，还需要去移植一些第三方软件库，比如 alsa、iperf、mplayer 等等；而且 busybox 构建的根文件系统默认没有用户名和密码设置；</p><p>buildroot，它不仅包含了 busybox 的功能，而且里面还集成了各种软件包，当需要什么软件就选择什么软件，不需要额外移植；buildroot 可以构建完整的根文件系统，因此极大的方便了嵌入式 Linux 开发人员对根文件系统进行制作；</p><p>至于 yocto 构建根文件系统，是一个古老的、很庞大的系统构建工具，其实其不单止可以构建根文件系统，还可以用来构建 u-boot、kernel、交叉编译工具链等等，一般为 SOC 厂家、设备厂商、系统开发这些用于统一发布标准套件，但由于操作复杂，开发学习时间也久，一般用户开发不会选择这一方式。</p><h2 id="busybox"><a class="anchor" href="#busybox">#</a> busybox</h2><p>官方下载：<span class="exturl" data-url="aHR0cHM6Ly9idXN5Ym94Lm5ldC9kb3dubG9hZHMv">https://busybox.net/downloads/</span></p><p>在这里选择下载 <span class="exturl" data-url="aHR0cHM6Ly9idXN5Ym94Lm5ldC9kb3dubG9hZHMvYnVzeWJveC0xLjMyLjAudGFyLmJ6Mg==">busybox-1.32.0.tar.bz2</span> 版本。</p><p>对下载下来的 busybox 进行解压：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[user@localhost] #"></td><td><pre><span class="token function">tar</span> <span class="token parameter variable">-jxvf</span> busybox-1.32.0.tar.bz2</pre></td></tr><tr><td data-num="2"></td><td data-command="[user@localhost] #"></td><td><pre><span class="token builtin class-name">cd</span> busybox-1.32.0</pre></td></tr></table></figure><h3 id="编译验证"><a class="anchor" href="#编译验证">#</a> 编译验证</h3><p>选择交叉编译工具对其进行默认编译：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[user@localhost] #"></td><td><pre><span class="token function">sudo</span> <span class="token parameter variable">-s</span></pre></td></tr><tr><td data-num="2"></td><td data-command="[root@localhost] #"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">ARCH</span><span class="token operator">=</span>arm</pre></td></tr><tr><td data-num="3"></td><td data-command="[root@localhost] #"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">CROSS_COMPILE</span><span class="token operator">=</span>arm-none-linux-gnueabihf-</pre></td></tr><tr><td data-num="4"></td><td data-command="[root@localhost] #"></td><td><pre><span class="token function">make</span> distclean</pre></td></tr><tr><td data-num="5"></td><td data-command="[root@localhost] #"></td><td><pre><span class="token function">make</span> defconfig</pre></td></tr><tr><td data-num="6"></td><td data-command="[root@localhost] #"></td><td><pre><span class="token function">make</span></pre></td></tr><tr><td data-num="7"></td><td data-command="[root@localhost] #"></td><td><pre><span class="token function">make</span> <span class="token function">install</span></pre></td></tr></table></figure><p>最后，生成一个名为 <code>_install</code> 的文件目录（当然，你也可以使用 <code>CONFIG_PREFIX=rootfs_dir</code> 指定文件目录名称及路径），该目录就是本次默认配置所构建的残缺文件系统，为什么说是残缺，是因为还缺少相关的文件及目录，这个下面再说。</p><h3 id="自主配置"><a class="anchor" href="#自主配置">#</a> 自主配置</h3><p>前面说了，上面的操作只是构建了一个默认的配置用以验证，实际过程中，往往根据需要选择必要的功能，而在 busybox 中支持以下几种快速配置模式：</p><ul><li>defconfig：缺省配置，也就是默认配置选项。</li><li>allyesconfi：全选配置，也就是选中 busybox 的所有功能。</li><li>allnoconfig：最小配置，什么都不选中，即空配置。</li></ul><p>在应用中，你可以先选择你最接近的快速配置进行初始化配置，然后再修改定制，这里笔者选择 <code>make allnoconfig</code> 进行配置初始化，配置完成后可通过查看是否有 <code>.config</code> 文件来验证配置成功。</p><p>同样的，跟 <a href="https://arachnid.cc/6ull-uboot-transplant/">uboot</a> 和 kernel 一样，在 busybox 中也存在图形界面配置操作（关于无法调出图形配置界面进行配置可看 <a href="https://arachnid.cc/6ull-kernel-transplant/">imx-6ULL kernel 移植</a> 的图形配置说明）：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">make</span> menuconfig</pre></td></tr></table></figure><p>关于其选项操作：</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>Settings ---> 			# BusyBox 的通用配置，一般采用默认值即可。</pre></td></tr><tr><td data-num="2"></td><td><pre>--- Applets</pre></td></tr><tr><td data-num="3"></td><td><pre>    Archival Utilities ---> 			# 压缩、解压缩相关工具。   </pre></td></tr><tr><td data-num="4"></td><td><pre>    Coreutils ---> 						# 最基本的命令，如cat、cp、ls等。   </pre></td></tr><tr><td data-num="5"></td><td><pre>    Console Utilities ---> 				# 控制台相关命令。   </pre></td></tr><tr><td data-num="6"></td><td><pre>    Debian Utilities ---> 				# Debian 操作系统相关命令。   </pre></td></tr><tr><td data-num="7"></td><td><pre>    klibc-utils ---> 					# 供 initramfs 所使用的最小化 libc 子集。</pre></td></tr><tr><td data-num="8"></td><td><pre>    Editors ---> 						# 编辑工具，如 vi、awk、sed 等。   </pre></td></tr><tr><td data-num="9"></td><td><pre>    Finding Utilities ---> 				# 查找工具，如find、grep、xargs。   </pre></td></tr><tr><td data-num="10"></td><td><pre>    Init Utilities ---> 				# BusyBox init 相关命令。   </pre></td></tr><tr><td data-num="11"></td><td><pre>    Login/Password Management Utilities ---> # 登陆、用户账号/密码等方面的命令。   </pre></td></tr><tr><td data-num="12"></td><td><pre>    Linux Ext2 FS Progs ---> 			# ext2 文件系统的一些工具。   </pre></td></tr><tr><td data-num="13"></td><td><pre>    Linux Module Utilities ---> 		# 加载/卸载模块等相关的命令。   </pre></td></tr><tr><td data-num="14"></td><td><pre>    Linux System Utilities --->  		# 一些系统命令。   </pre></td></tr><tr><td data-num="15"></td><td><pre>    Miscellaneous Utilities ---> 		# 一些不好分类的命令，如crond、crontab。   </pre></td></tr><tr><td data-num="16"></td><td><pre>    Networking Utilities --->    		# 网络相关的命令和工具。   </pre></td></tr><tr><td data-num="17"></td><td><pre>    Print Utilities --->    			# print spool 服务及相关工具。   </pre></td></tr><tr><td data-num="18"></td><td><pre>    Mail Utilities --->      			# mail 相关命令。   </pre></td></tr><tr><td data-num="19"></td><td><pre>    Process Utilities --->      		# 进程相关命令，如ps、kill等。   </pre></td></tr><tr><td data-num="20"></td><td><pre>    Runit Utilities --->    			# runit 程序。   </pre></td></tr><tr><td data-num="21"></td><td><pre>    Shells --->             			# shell 程序。   </pre></td></tr><tr><td data-num="22"></td><td><pre>    System Logging Utilities --->   	# 系统日志相关工具，如 syslogd、klogd。</pre></td></tr><tr><td data-num="23"></td><td><pre>---</pre></td></tr><tr><td data-num="24"></td><td><pre>	Load an Alternate Configuration File		# 加载备用配置文件</pre></td></tr><tr><td data-num="25"></td><td><pre>	Save Configuration to an Alternate File		# 将配置保存到备用文件</pre></td></tr></table></figure><p>然后在这里记录几个关键的配置：</p><ul><li><p>静态或者动态编译 busybox，取消选择静态编译，使得 busybox 可执行文件更小</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>-> Settings</pre></td></tr><tr><td data-num="2"></td><td><pre>  -> [ ] Build static binary (no shared libs)</pre></td></tr></table></figure></li><li><p>打开命令行编辑，增加 vi 编辑样式，其余默认或按需修改</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>-> Settings</pre></td></tr><tr><td data-num="2"></td><td><pre>  -> [*] Command line editing</pre></td></tr><tr><td data-num="3"></td><td><pre>     [*]   vi-style line editing commands</pre></td></tr></table></figure></li><li><p>打开简洁式 help 命令提示</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>-> Settings</pre></td></tr><tr><td data-num="2"></td><td><pre>  -> [*] Show applet usage messages</pre></td></tr><tr><td data-num="3"></td><td><pre>     [ ]   Show verbose applet usage messages</pre></td></tr><tr><td data-num="4"></td><td><pre>     [*]   Store applet usage messages in compressed form</pre></td></tr></table></figure></li><li><p>选择支持 Unicode 编码，其余默认或按需修改</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>-> Settings</pre></td></tr><tr><td data-num="2"></td><td><pre>  -> [*] Support Unicode</pre></td></tr><tr><td data-num="3"></td><td><pre>     [*]   Check $LC_ALL, $LC_CTYPE and $LANG environment variables</pre></td></tr></table></figure></li><li><p>取消对模块实用程序的简化，这样在该表将会额外多出几个拓展选项</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>-> Linux Module Utilities</pre></td></tr><tr><td data-num="2"></td><td><pre>  -> [ ] Simplified modutils</pre></td></tr></table></figure></li><li><p>打开设备自主管理功能，实现初始化常用设备和动态更新</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>-> Linux System Utilities</pre></td></tr><tr><td data-num="2"></td><td><pre>  -> [*] mdev</pre></td></tr><tr><td data-num="3"></td><td><pre>     [*]   Support /etc/mdev.conf</pre></td></tr><tr><td data-num="4"></td><td><pre>     [*]     Support subdirs/symlinks</pre></td></tr><tr><td data-num="5"></td><td><pre>     [*]       Support regular expressions substitutions when renaming dev</pre></td></tr><tr><td data-num="6"></td><td><pre>     [*]     Support command execution at device addition/removal</pre></td></tr><tr><td data-num="7"></td><td><pre>     [*]   Support loading of firmware</pre></td></tr><tr><td data-num="8"></td><td><pre>     [*]   Support daemon mode</pre></td></tr></table></figure></li><li><p>选择内核启动后 init 进程处理</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>-> Init Utilities</pre></td></tr><tr><td data-num="2"></td><td><pre>  -> [*] init</pre></td></tr><tr><td data-num="3"></td><td><pre>  -> [ ] linuxrc: support running init from initrd (not initramfs)</pre></td></tr></table></figure><p>在这里，取消勾选 <code>linuxrc</code> ；在 Linux2.4 内核及更低版本，由 <code>initrd</code> 引导加载文件系统，核心文件就是 <code>linuxrc</code> ，其通常是一个脚本文件，负责加载内核访问根文件系统必须的驱动， 以及加载根文件系统，如果你勾选上那么编译后你将会看到一个 <code>/linuxrc</code> 文件；Linux2.6 内核之后被 <code>initramfs</code> 取代，与 <code>initrd</code> 需要先解压再挂载模拟成一个块设备不同， <code>initramfs</code> 在编译阶段就被打包成 <code>cpio</code> 格式，内核可以直接将其解压建立文件系统。</p><p>为了保持向后兼容性，实际上，在这些发行版中， <code>initrd</code> 通常只是一个指向 <code>initramfs</code> 的符号链接；也就是说，你所看到的 <code>initrd</code> 实际上已经是现代化的 <code>initramfs</code> 了，通过 <code>ls -l linuxrc</code> 可以看到其实是个软链接而非文件脚本了。</p></li><li><p>shell 终端选择</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>-> Shells</pre></td></tr><tr><td data-num="2"></td><td><pre>  -> [*] ash</pre></td></tr><tr><td data-num="3"></td><td><pre>  -> [*] hush</pre></td></tr></table></figure><p>Almquist shell (也称为 A shell、ash 和 sh) 是一种轻量级 Unix shell（最大的特点就是轻量化）；Hush 是一个创新的 shell 脚本语言，它将 Lua 的简洁性和 Unix 的实用性融为一体。</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>-> Shells</pre></td></tr><tr><td data-num="2"></td><td><pre>     Choose which shell is aliased to 'sh' name (ash)  ---></pre></td></tr><tr><td data-num="3"></td><td><pre>     Choose which shell is aliased to 'bash' name (hush)  ---></pre></td></tr></table></figure><p>分别为 <code>sh</code> / <code>bash</code> 指定 ash 和 hush shell 名称。</p></li></ul><h3 id="添加中文支持"><a class="anchor" href="#添加中文支持">#</a> 添加中文支持</h3><p>在上面启用 Unicode 编码后，可以通过修改以下几个文件来实现中文显示。</p><p>1、修改 <code>unicode.c</code> 文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[user@localhost] #"></td><td><pre><span class="token function">sudo</span> <span class="token function">vim</span> libbb/unicode.c</pre></td></tr></table></figure><p>找到 <code>unicode_conv_to_printable2</code> 函数，进行以下修改：</p><p><img data-src="image-20240822210341756.png" alt="image-20240822210341756"></p><p>2、修改 <code>printable_string.c</code> 文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[user@localhost] #"></td><td><pre><span class="token function">sudo</span> <span class="token function">vim</span> libbb/printable_string.c</pre></td></tr></table></figure><p>找到 <code>printable_string2</code> 函数，进行以下修改：</p><p><img data-src="image-20240822210801046.png" alt="image-20240822210801046"></p><h2 id="编写脚本"><a class="anchor" href="#编写脚本">#</a> 编写脚本</h2><p>1、默认配置生成脚本</p><figure class="highlight bash"><figcaption data-lang="bash"><span>build.sh</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token shebang important">#!/bin/bash</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 若之前已经导入到环境变量则不需要</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/usr/local/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf/bin</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 若已经在顶层 Makefile 文件中指定则不需要</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">ARCH</span><span class="token operator">=</span>arm</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 若已经在顶层 Makefile 文件中指定则不需要</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">CROSS_COMPILE</span><span class="token operator">=</span>arm-none-linux-gnueabihf-</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function">make</span> distclean</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">make</span> defconfig</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token function">make</span> -j<span class="token variable"><span class="token variable">$(</span>nproc<span class="token variable">)</span></span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token function">make</span> <span class="token function">install</span> -j<span class="token variable"><span class="token variable">$(</span>nproc<span class="token variable">)</span></span></pre></td></tr></table></figure><p>2、数据修改脚本</p><figure class="highlight bash"><figcaption data-lang="bash"><span>autobuild.sh</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token shebang important">#!/bin/bash</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 若之前已经导入到环境变量则不需要</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/usr/local/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf/bin</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 若已经在顶层 Makefile 文件中指定则不需要</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">ARCH</span><span class="token operator">=</span>arm</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 若已经在顶层 Makefile 文件中指定则不需要</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">CROSS_COMPILE</span><span class="token operator">=</span>arm-none-linux-gnueabihf-</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function">make</span> clean</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">make</span> -j<span class="token variable"><span class="token variable">$(</span>nproc<span class="token variable">)</span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function">make</span> <span class="token function">install</span> -j<span class="token variable"><span class="token variable">$(</span>nproc<span class="token variable">)</span></span></pre></td></tr></table></figure><p>通过执行 <code>build.sh</code> 或 <code>make menuconfig</code> 修改及执行 <code>autobuild.sh</code> 得到所需的二进制执行程序，这时在生成的目录下可以看到：</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>|</pre></td></tr><tr><td data-num="2"></td><td><pre>|-- bin</pre></td></tr><tr><td data-num="3"></td><td><pre>|-- sbin</pre></td></tr><tr><td data-num="4"></td><td><pre>|-- usr</pre></td></tr><tr><td data-num="5"></td><td><pre>     |-- bin</pre></td></tr><tr><td data-num="6"></td><td><pre>     |-- sbin</pre></td></tr></table></figure><h2 id="补充-rootfs-目录"><a class="anchor" href="#补充-rootfs-目录">#</a> 补充 rootfs 目录</h2><p>根据上面 rootfs 的构成，尽管是要做最小 rootfs，除 busybox 生成的目录文件外，还需要我们去填补运行所需的目录文件。</p><h3 id="添加-lib-库"><a class="anchor" href="#添加-lib-库">#</a> 添加 lib 库</h3><p>Linux 中的应用程序一般都是需要动态库的，当然你也可以编译成静态的，但是静态的可执行文件会很大。如果编译为动态的话就需要动态库，所以我们需要向根文件系统中添加动态库，包括前面提到的 busybox 配置中的动态编译。这些动态库可以从调用的交叉编译器中获取，。</p><p><strong>1、 <code>/lib</code> 库添加</strong></p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost:rootfs] #"></td><td><pre><span class="token function">mkdir</span> lib</pre></td></tr><tr><td data-num="2"></td><td data-command="[root@localhost:rootfs] #"></td><td><pre><span class="token function">cp</span> <span class="token parameter variable">-d</span> /usr/local/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf/arm-none-linux-gnueabihf/libc/lib/*so* lib/</pre></td></tr><tr><td data-num="3"></td><td data-command="[root@localhost:rootfs] #"></td><td><pre><span class="token function">cp</span> <span class="token parameter variable">-d</span> /usr/local/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf/arm-none-linux-gnueabihf/libc/lib/*.a lib/</pre></td></tr></table></figure><p>复制 arm linux 交叉编译器下的 <code>libc/lib</code> 库里的 <code>*so*</code> 和 <code>*.a</code> 到 rootfs 的 <code>lib</code> 中， <code>-d</code> 连同软链接也一起拷贝。</p><p><strong>2、 <code>/usr/lib</code> 库添加</strong></p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost:rootfs] #"></td><td><pre><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> usr/lib</pre></td></tr><tr><td data-num="2"></td><td data-command="[root@localhost:rootfs] #"></td><td><pre><span class="token function">cp</span> <span class="token parameter variable">-d</span> /usr/local/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf/arm-none-linux-gnueabihf/libc/usr/lib/*so* usr/lib</pre></td></tr><tr><td data-num="3"></td><td data-command="[root@localhost:rootfs] #"></td><td><pre><span class="token function">cp</span> <span class="token parameter variable">-d</span> /usr/local/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf/arm-none-linux-gnueabihf/libc/usr/lib/*.a usr/lib</pre></td></tr></table></figure><p>复制 arm linux 交叉编译器下的 <code>libc/usr/lib</code> 库里的 <code>*so*</code> 和 <code>*.a</code> 到 rootfs 的 <code>usr/lib</code> 中， <code>-d</code> 连同软链接也一起拷贝。</p><h3 id="完善根目录"><a class="anchor" href="#完善根目录">#</a> 完善根目录</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost:rootfs] #"></td><td><pre><span class="token function">mkdir</span>  dev  etc  home  mnt  proc  sys  var</pre></td></tr></table></figure><h1 id="测试"><a class="anchor" href="#测试">#</a> 测试</h1><p>在完成上面的所有操作后，可以利用 NFS 网络挂载文件系统进行测试完善；关于 NFS 服务的搭建可看 <a href="https://arachnid.cc/ubuntu-tftp-nfs-create/">Ubuntu 搭建 tftp 及 NFS 服务</a> 。</p><p>对于利用 NFS 挂载根文件系统，可以通过修改 uboot 启动的 <code>bootargs</code> 配置来变更文件系统挂载路径，例如：</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>=> setenv bootargs 'console=ttymxc0,115200 root=/dev/nfs nfsroot=192.168.1.100:/home/user/nfs_rootfs,proto=tcp rw ip=192.168.1.251:192.168.1.100:192.168.1.1:255.255.255.0::eth0:off'</pre></td></tr><tr><td data-num="2"></td><td><pre>=></pre></td></tr><tr><td data-num="3"></td><td><pre>=> saveenv</pre></td></tr></table></figure><p>关于 uboot 改成 NFS 挂载 rootfs 的格式（更多信息可看 kernel 里面的 <code>Documentation/filesystems/nfs/nfsroot.txt</code> 及其相关文件）：</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>root=/dev/nfs nfsroot=[&lt;server-ip>:]&lt;root-dir>[,&lt;nfs-options>] ip=&lt;client-ip>:&lt;server-ip>:&lt;gw-ip>:&lt;netmask>:&lt;hostname>:&lt;device>:&lt;autoconf>:&lt;dns0-ip>:&lt;dns1-ip></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>&lt;server-ip>：服务器 IP 地址；比如这里的 PC 主机 IP 地址为 192.168.1.100。</pre></td></tr><tr><td data-num="4"></td><td><pre>&lt;root-dir>：根文件系统的存放路径，要保证放在 NFS 共享目录下；比如 /home/user/nfs_rootfs。</pre></td></tr><tr><td data-num="5"></td><td><pre>&lt;nfs-options>：NFS 的其他可选选项，一般不设置。</pre></td></tr><tr><td data-num="6"></td><td><pre>&lt;client-ip>：客户端 IP 地址，也就是开发板的 IP 地址。</pre></td></tr><tr><td data-num="7"></td><td><pre>&lt;server-ip>：服务器 IP 地址，前面已经说了。</pre></td></tr><tr><td data-num="8"></td><td><pre>&lt;gw-ip>：网关地址。</pre></td></tr><tr><td data-num="9"></td><td><pre>&lt;netmask>：子网掩码。</pre></td></tr><tr><td data-num="10"></td><td><pre>&lt;hostname>：客户机的名字，一般不设置，此值可以空着。</pre></td></tr><tr><td data-num="11"></td><td><pre>&lt;device>：设备名，也就是网卡名，一般是 eth0，eth1...。</pre></td></tr><tr><td data-num="12"></td><td><pre>&lt;autoconf>：自动配置，一般不使用，所以设置为 off。</pre></td></tr><tr><td data-num="13"></td><td><pre>&lt;dns0-ip>：DNS0 服务器 IP 地址，不使用。</pre></td></tr><tr><td data-num="14"></td><td><pre>&lt;dns1-ip>：DNS1 服务器 IP 地址，不使用。</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>“proto=tcp”表示使用 TCP 协议，“rw”表示 nfs 挂载的根文件系统为可读可写。</pre></td></tr></table></figure><p>在这里，结合 <a href="https://arachnid.cc/6ull-uboot-transplant/">imx-6ULL uboot 移植</a> 篇章，可以配置成：</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>=> setenv netargs setenv bootargs 'console=$&#123;console&#125;,$&#123;baudrate&#125; root=/dev/nfs nfsroot=$&#123;serverip&#125;:/home/user/nfs_rootfs,proto=tcp rw ip=$&#123;ipaddr&#125;:$&#123;serverip&#125;:$&#123;gatewayip&#125;:$&#123;netmask&#125;::eth0:off'</pre></td></tr><tr><td data-num="2"></td><td><pre>=></pre></td></tr><tr><td data-num="3"></td><td><pre>=> setenv nfsboot 'run findfdt; run findtee; mmc dev $&#123;mmcdev&#125;; mmc dev $&#123;mmcdev&#125;; run netargs; run loadimage; run loadfdt; bootz $&#123;loadaddr&#125; - $&#123;fdt_addr&#125;'</pre></td></tr><tr><td data-num="4"></td><td><pre>=></pre></td></tr><tr><td data-num="5"></td><td><pre>=> saveenv</pre></td></tr><tr><td data-num="6"></td><td><pre>=></pre></td></tr><tr><td data-num="7"></td><td><pre>=> run nfsboot</pre></td></tr></table></figure><p>最后，通过运行 <code>nfsboot</code> 来启动。</p><h2 id="添加-rcs-文件"><a class="anchor" href="#添加-rcs-文件">#</a> 添加 rcS 文件</h2><p>通过 uboot 执行 <code>run nfsboot</code> 进入系统后，可以看到已经成功挂在 NFS 上的 rootfs 了：</p><p><img data-src="JQKH%7B0OI%25CXEAYY0PYJ%7DFW.png" alt="img"></p><p>但是在进入根文件系统的时候，打印上有一行报错，显示错误提示：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>can<span class="token string">'t run '</span>/etc/init.d/rcS': No such <span class="token function">file</span> or directory</pre></td></tr></table></figure><p>提示不能运行 <code>/etc/init.d/rcS</code> ，没有这个文件；该文件是个 shell 脚本，Linux 内核启动以后需要启动一些服务，而 rcS 就是规定启动哪些文件的脚本文件</p><p>那么补充一下这个文件，并写入以下内容：</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>rcS</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token shebang important">#!/bin/sh</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># rcS		Call all S??* scripts in /etc/rcS.d in</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">#		numerical/alphabetical order.</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># Version:	@(#)/etc/init.d/rcS  2.76  19-Apr-1999  miquels@cistron.nl</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/sbin:/bin:/usr/sbin:/usr/bin  <span class="token comment"># 初始化环境变量 PATH，操作系统执行程序默认到 PATH 指定的目录下寻找该程序</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token assign-left variable">runlevel</span><span class="token operator">=</span>S  <span class="token comment"># 设置系统运行级别为 S，即 single-user（单用户）模式</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token assign-left variable">prevlevel</span><span class="token operator">=</span>N <span class="token comment"># 用来记录上一个运行级别的值，以便系统能够在需要时回到前一个运行级别，为 N 则表示没有</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token builtin class-name">umask</span> 022   <span class="token comment"># 指定当前用户在创建文件时的默认权限，默认 touch 创建一个文件的权限是 644</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token builtin class-name">export</span> <span class="token environment constant">PATH</span> runlevel prevlevel  <span class="token comment"># 导出环境变量</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">#	Mount all file systems defined in /etc/fstab</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token function">mkdir</span> /dev/pts</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token function">mount</span> <span class="token parameter variable">-a</span>    <span class="token comment"># 挂载 /etc/fstab 文件中指定的文件系统</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">#	Make sure proc is mounted</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">[</span> <span class="token parameter variable">-d</span> <span class="token string">"/proc/1"</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token function">mount</span> /proc <span class="token comment"># 确保 /proc 已挂载</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment">#	Trap CTRL-C &amp;c only in this shell so we can interrupt subprocesses.</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token builtin class-name">trap</span> <span class="token string">":"</span> INT QUIT TSTP  <span class="token comment"># 捕捉 INT、QUIT、TSTP 信号</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment">#	Call all parts in order.</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token builtin class-name">exec</span> /etc/init.d/rc.local   <span class="token comment"># 转去执行 rc.local 文件中内容</span></pre></td></tr></table></figure><h3 id="补充-fstab-和-rclocal-文件"><a class="anchor" href="#补充-fstab-和-rclocal-文件">#</a> 补充 fstab 和 rc.local 文件</h3><p>在添加完 <code>/etc/init.d/rcS</code> 后再次运行：</p><p><img data-src="QQ%E5%9B%BE%E7%89%8720240829205505.png" alt="QQ图片20240829205505"></p><p>可以看到本次打印已经没有上面的提示了，但是会多出两个文件的报错：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>mount: can<span class="token string">'t read '</span>/etc/fstab<span class="token string">': No such file or directory</span></pre></td></tr><tr><td data-num="2"></td><td><pre>mount: can't <span class="token builtin class-name">read</span> <span class="token string">'/etc/fstab'</span><span class="token builtin class-name">:</span> No such <span class="token function">file</span> or directory</pre></td></tr><tr><td data-num="3"></td><td><pre>/etc/init.d/rcS: exec: line <span class="token number">34</span>: /etc/init.d/rc.local: not found</pre></td></tr></table></figure><p>分别是缺失 <code>/etc/fstab</code> 和 <code>/etc/init.d/rc.local</code> ，其实从上面的 rcS 文件上的注释可以看到，该文件是会调用 <code>fstab</code> 和 <code>rc.local</code> ，因此补充这两个文件：</p><ul><li><p><code>/etc/fstab</code></p><p>用于指定系统需要挂载的文件系统，其格式如下：</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>&lt;file system> &lt;mount point> &lt;type> &lt;options> &lt;dump> &lt;pass></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>&lt;file system>：要挂载的特殊的设备，也可以是块设备，比如 /dev/sda 等等</pre></td></tr><tr><td data-num="4"></td><td><pre>&lt;mount point>：挂载点。</pre></td></tr><tr><td data-num="5"></td><td><pre>&lt;type>：文件系统类型，比如 ext2、ext3、proc、romfs、tmpfs 等等。</pre></td></tr><tr><td data-num="6"></td><td><pre>&lt;options>：挂载选项，一般使用 defaults，defaults 包含了 rw、suid、 dev、 exec、 auto、 nouser 和 async。</pre></td></tr><tr><td data-num="7"></td><td><pre>&lt;dump>：为 1 的话表示允许备份，为 0 不备份，一般不备份，因此设置为 0。</pre></td></tr><tr><td data-num="8"></td><td><pre>&lt;pass>：磁盘检查设置，为 0 表示不检查。根目录 ‘/’ 设置为 1，其他的都不能设置为 1，因此这里一般设置为 0</pre></td></tr></table></figure><figure class="highlight text"><figcaption data-lang="text"><span>fstab</span></figcaption><table><tr><td data-num="1"></td><td><pre># stock fstab - you probably want to override this with a machine specific one</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>proc                 /proc                proc       defaults              0  0</pre></td></tr><tr><td data-num="4"></td><td><pre>tmpfs                /dev                 tmpfs      defaults              0  0</pre></td></tr><tr><td data-num="5"></td><td><pre>sysfs                /sys                 sysfs      defaults              0  0</pre></td></tr><tr><td data-num="6"></td><td><pre>devpts               /dev/pts             devpts     mode=0620,gid=5       0  0</pre></td></tr></table></figure></li><li><p><code>/etc/init.d/rc.local</code></p><p>该文件一般作为 <code>rcS</code> 文件的拓展，可有可无，用于设置特定的与系统级无关的操作</p><figure class="highlight bash"><figcaption data-lang="bash"><span>rc.local</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token shebang important">#!/bin/sh</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 设置从 /etc/hostname 文件中获取的主机名</span></pre></td></tr><tr><td data-num="4"></td><td><pre>/bin/hostname <span class="token parameter variable">-F</span> /etc/hostname</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 使用 mdev 来管理热插拔设备，使 Linux 内核就可以在 /dev 目录下自动创建设备节点</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token builtin class-name">echo</span> /sbin/mdev <span class="token operator">></span> /proc/sys/kernel/hotplug</pre></td></tr><tr><td data-num="8"></td><td><pre>mdev <span class="token parameter variable">-s</span></pre></td></tr></table></figure></li></ul><h3 id="完善-devpts-和-etchostname"><a class="anchor" href="#完善-devpts-和-etchostname">#</a> 完善 /dev/pts 和 /etc/hostname</h3><p>在补充完上述的两个文件后，如果再次运行，那么还是会出现报错：</p><p><img data-src="QQ%E5%9B%BE%E7%89%8720240829205721.png" alt=""></p><p>嘛，这也是预料之中：</p><ul><li><p>在 <code>fstab</code> 中需要挂载一个 /dev/pts 路径的虚拟文件系统，用于实现终端设备的动态分配和管理</p></li><li><p><code>rc.local</code> 中需要读取 /etc/hostname 文件来获取主机名</p></li></ul><p>所以在 <code>rcS</code> 中的 <code>mount -a</code> 前面添加 <code>mkdir /dev/pts</code> 命令；创建 <code>/etc/hostname</code> 文件，并在里面填写你喜欢的开发板名字。</p><p>再运行一次，这次就没有报错提示了，但是有个问题就是，终端的主机名和用户名都没有显示，与常规的终端显示不一样：</p><p><img data-src="QQ%E5%9B%BE%E7%89%8720240829205755.png" alt=""></p><h2 id="添加-profile-文件"><a class="anchor" href="#添加-profile-文件">#</a> 添加 profile 文件</h2><p>之前添加了 /bin/hostname 以获取主机名，并用 <code>hostname -F</code> 配置主机名，但实际效果是命令行的提示符是没有显示，而调用各种执行程序是没问题的，说明这部分是 Shell 变量设置导致的。</p><p>查阅常见环境变量：</p><ul><li><p>PATH：执行命令时要搜索的目录列表</p></li><li><p>HOME：当前用户的家目录</p></li><li><p>MAIL： 当前用户的邮件储蓄目录</p></li><li><p>SHELL：当前用户的 Shell 路径</p></li><li><p>TZ：时区</p></li><li><p>HISTSIZE：是指保存历史命令记录的条数</p></li><li><p>LOGNAME：是指当前用户的登录名</p></li><li><p>PWD：当前的工作目录</p></li><li><p>HOSTNAME：是指主机的名称，许多应用程序如果要用到主机名的话，通常是从这个环境变量中来取得的</p></li><li><p>LANG/LANGUGE：是和语言相关的环境变量，使用多种语言的用户可以修改此环境变量</p></li><li><p>PS1：是基本提示符，对于 root 用户是 #，对于普通用户是 $</p></li><li><p>PS2：是附属提示符，默认是 “&gt;” ，可以通过修改此环境变量来修改当前的命令符</p></li></ul><p>为了验证是否靠环境变量实现这一作用，编写一个 <code>profile</code> 文件：</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>profile</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># /etc/profile: system-wide .profile file for the Bourne shell (sh(1))</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># and Bourne compatible shells (bash(1), ksh(1), ash(1), ...).</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/usr/local/bin</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-e</span> /etc/localtime <span class="token parameter variable">-a</span> <span class="token operator">!</span> <span class="token parameter variable">-e</span> /etc/TZ <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token assign-left variable">TZ</span><span class="token operator">=</span><span class="token string">"UTC"</span>		<span class="token comment"># Time Zone. Look at http://theory.uwinnipeg.ca/gnu/glibc/libc_303.html</span></pre></td></tr><tr><td data-num="8"></td><td><pre>				<span class="token comment"># for an explanation of how to set this to your local timezone.</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token builtin class-name">export</span> TZ</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">fi</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token assign-left variable"><span class="token environment constant">USER</span></span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">`</span><span class="token function">id</span> <span class="token parameter variable">-un</span><span class="token variable">`</span></span>"</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token assign-left variable"><span class="token environment constant">LOGNAME</span></span><span class="token operator">=</span><span class="token environment constant">$USER</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token assign-left variable"><span class="token environment constant">HOSTNAME</span></span><span class="token operator">=</span><span class="token string">'/bin/hostname'</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token environment constant">$HOME</span>"</span> <span class="token operator">=</span> <span class="token string">"/home/root"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="17"></td><td><pre>   <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/usr/local/sbin</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">fi</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token environment constant">$PS1</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># works for bash and ash (no other shells known to be in use here)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>   <span class="token assign-left variable"><span class="token environment constant">PS1</span></span><span class="token operator">=</span><span class="token string">'\u@\h:\w\$ '</span>  <span class="token comment"># 显示主机名、当前路径等信息</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">fi</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token builtin class-name">export</span> <span class="token environment constant">USER</span> <span class="token environment constant">LOGNAME</span> <span class="token environment constant">PATH</span> <span class="token environment constant">PS1</span></pre></td></tr></table></figure><p>上面的文件除了配置主机名变量和显示终端基本提示符，还追加 $PASH 路径、指定时区及用户名等。</p><p>然后重启查看效果，是否能解决命令行提示符显示：</p><p><img data-src="QQ%E5%9B%BE%E7%89%8720240829205846.png" alt=""></p><p>现在是：第一，profile 文件起了作用，hostname 显示出来了，路径指示也显示了；第二，还有个问题就是登录用户名没显示出来。</p><h2 id="添加-passwad-shadow-group-gshadow-文件"><a class="anchor" href="#添加-passwad-shadow-group-gshadow-文件">#</a> 添加 passwad , shadow , group , gshadow 文件</h2><p>前面已经在 <code>profile</code> 中加入了用户名变量，然而还是没从终端显示出来，那么是不是因为系统没有获取到用户配置信息呢？</p><p>与用户配置信息有关的几个文件：</p><ul><li><strong>etc/passwad</strong></li></ul><p><code>/etc/passwd</code> 文件，是系统用户配置文件，存储了系统中所有用户的基本信息，并且所有用户都可以对此文件执行读操作。</p><p>文件中每行代表一个用户信息，以 <code>:</code> 作为分隔符，划分为 7 个字段，每个字段所表示的含义如下：</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>用户名 : 密码 : UID（用户ID） : GID（组ID） : 描述性信息 : 主目录 : Shell 路径</pre></td></tr></table></figure><p>添加以下信息：</p><figure class="highlight text"><figcaption data-lang="text"><span>passwad</span></figcaption><table><tr><td data-num="1"></td><td><pre>root:x:0:0:root:/home/root:/bin/bash</pre></td></tr></table></figure><p>note：&quot;x&quot; 表示此用户设有密码，但不是真正的密码，真正的密码保存在 <code>/etc/shadow</code> 文件中。</p><ul><li><strong>/etc/shadow</strong></li></ul><p><code>/etc/shadow</code> 文件，用于存储 Linux 系统中用户的密码信息。</p><p>文件中每行代表一个用户信息，以 <code>:</code> 作为分隔符，划分为 9 个字段，每个字段所表示的含义如下：</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>用户名 : 加密密码 : 最后一次修改时间 : 最小修改时间间隔 : 密码有效期 : 密码需要变更前的警告天数 : 密码过期后的宽限时间 : 账号失效时间 : 保留字段</pre></td></tr></table></figure><p>添加以下信息：</p><figure class="highlight text"><figcaption data-lang="text"><span>shadow</span></figcaption><table><tr><td data-num="1"></td><td><pre>root::19424:0:99999:7:::</pre></td></tr></table></figure><p>note：这里的加密密码保存的是真正加密的密码，目前 Linux 的密码采用的是 SHA512 散列加密算法，原来采用的是 MD5 或 DES 加密算法；而最后一次修改时间是指在 1970 年 1 月 1 日之后的第 n 天修改，eg：19424，可通过 <code>date -d &quot;1970-01-01 19424 days&quot;</code> 得到 <code>2023年 03月 08日 星期三 00:00:00 CST</code> 。</p><ul><li><strong>/etc/group</strong></li></ul><p><code>/ect/group</code> 文件是用户组配置文件，即用户组的所有信息都存放在此文件中。</p><p>文件中每行代表一个用户组信息，以 <code>:</code> 作为分隔符，划分为 4 个字段，，每个字段所表示的含义如下：</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>组名 : 密码 : GID（组ID） : 该用户组中的用户列表</pre></td></tr></table></figure><p>添加以下信息：</p><figure class="highlight text"><figcaption data-lang="text"><span>shadow</span></figcaption><table><tr><td data-num="1"></td><td><pre>root:x:0:</pre></td></tr></table></figure><p>note：和 <code>/etc/passwd</code> 文件一样，这里的 &quot;x&quot; 仅仅是密码标识，真正加密后的组密码默认保存在 <code>/etc/gshadow</code> 文件中。</p><ul><li><strong>/etc/gshadow</strong></li></ul><p><code>/etc/gshadow</code> 文件，用于存储 Linux 系统中组用户的密码信息。</p><p>文件中每行代表一个组用户的密码信息，以 <code>:</code> 作为分隔符，划分为 4 个字段，每个字段所表示的含义如下：</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>组名 : 加密密码 : 组管理员 : 组附加用户列表</pre></td></tr></table></figure><p>添加以下信息：</p><figure class="highlight text"><figcaption data-lang="text"><span>gshadow</span></figcaption><table><tr><td data-num="1"></td><td><pre>root:*::</pre></td></tr></table></figure><p>最后，添加上这几个文件后再运行一次：</p><p><img data-src="QQ%E5%9B%BE%E7%89%8720240829211053.png" alt=""></p><p>这下子，基本的 rootfs 雏形就出来了。</p><h2 id="添加-inittab-文件"><a class="anchor" href="#添加-inittab-文件">#</a> 添加 inittab 文件</h2><p>为什么需要这个文件？Linux 内核启动完成后，内核通过启动第一个用户进程（init 进程）来启动其他用户记的进程或服务，init 进程是 Linux 系统中所有进程的父进程。</p><p>init 进程将解析 inittab 文件，运行操作系统的配置脚本，对 Linux 系统进行初始化：</p><p><img data-src="1436095-20180709194017319-1896253481.png" alt="img"></p><p>inittab 文件是一个不可执行的文本文件，它被按照固定的格式书写，以供 init 进程识别；inittab 由若干条指令组成，每条指令的结构都相同，以 <code>:</code> 作为分隔符，划分为 4 个字段，每个字段所表示的含义如下：</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>identifier : runlevels : action : process</pre></td></tr></table></figure><ol><li><p>identifier</p><p>用于唯一标识 inittab 文件中的每条指令。</p></li><li><p>runlevels</p><table><thead><tr><th>level</th><th>note</th></tr></thead><tbody><tr><td>runlevel 0</td><td>让 init 关闭所有进程并终止系统。</td></tr><tr><td>runlevel 1</td><td>用来将系统转到单用户模式，单用户模式只能有系统管理员进入，在该模式下处理那些在有登录用户的情况下不能进行更改的文件，改 runlevel 的编号 1 也可以用 S 代替。</td></tr><tr><td>runlevel 2</td><td>允许系统进入多用户的模式，但并不支持文件共享，这种模式很少应用。</td></tr><tr><td>runlevel 3</td><td>最常用的运行模式，主要用来提供真正的多用户模式，也是多数服务器的缺省模式。</td></tr><tr><td>runlevel 4</td><td>一般不被系统使用，用户可以设计自己的系统状态并将其应用到 runlevel。</td></tr><tr><td>runlevel 5</td><td>将系统初始化为专用的 X Window 终端。对功能强大的 Linux 系统来说，这并不是好的选择，但用户如果需要这样，也可以通过在 runlevel 启动来实现该方案。</td></tr><tr><td>runlevel 6</td><td>关闭所有运行的进程并重新启动系统。</td></tr></tbody></table></li><li><p>action</p><table><thead><tr><th>字段</th><th>描述</th></tr></thead><tbody><tr><td>sysinit</td><td>在系统初始化的时候 process 才会执行一次。</td></tr><tr><td>wait</td><td>告诉 init，要等待相应的进程执行完以后才能继续执行。</td></tr><tr><td>once</td><td>init 只运行一次该进程。</td></tr><tr><td>respawn</td><td>init 会监视这个 process，即使其结束后也会立即被重新启动。</td></tr><tr><td>askfirst</td><td>与 respawn 类似，在运行 process 之前在控制台上显示 “Please press Enter to activate this console.”。只要用户按下 “Enter” 键以后才会执行 process。</td></tr><tr><td>ctrlaltdel</td><td>当 Ctrl+Alt+Del 三个键同时按下时会执行 process。</td></tr><tr><td>restart</td><td>当 init 重启的时候才会执行 procee。</td></tr><tr><td>shutdown</td><td>关机的时候执行 process。</td></tr></tbody></table></li><li><p>process</p><p>表示所要执行的程序、脚本或命令等。</p></li></ol><p>在了解完 inittab 文件的作用后，那么你可以编写你所需要的执行操作了；在这里你可能会问，前面没有创建 <code>/etc/inittab</code> 文件，那为何可以对 Linux 系统进行初始化，这个其实查看代码可以看到，当无法获取 <code>/etc/inittab</code> 文件时，将会使用固定流程进行初始化：</p><p><img data-src="image-20240829221814093.png" alt="image-20240829221814093"></p><p>但对于固定流程，我们更偏向于自定义初始化流程，因此可以简单编写：</p><figure class="highlight text"><figcaption data-lang="text"><span>inittab</span></figcaption><table><tr><td data-num="1"></td><td><pre># Boot-time system configuration/initialization script.</pre></td></tr><tr><td data-num="2"></td><td><pre># This is run first except when booting in emergency (-b) mode.</pre></td></tr><tr><td data-num="3"></td><td><pre>::sysinit:/etc/init.d/rcS</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>::askfirst:-/bin</pre></td></tr><tr><td data-num="6"></td><td><pre>#::askfirst:-/bin/login</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre># Stuff to do before rebooting</pre></td></tr><tr><td data-num="9"></td><td><pre>::ctrlaltdel:/sbin/reboot</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre># umount all filesystem</pre></td></tr><tr><td data-num="12"></td><td><pre>::shutdown:/bin/umount -a -r</pre></td></tr><tr><td data-num="13"></td><td><pre>#::shutdown:/sbin/swapoff -a</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre># restart init process</pre></td></tr><tr><td data-num="16"></td><td><pre>::restart:/sbin/init</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre># Example of how to put a getty on a serial line (for a terminal)</pre></td></tr><tr><td data-num="19"></td><td><pre>::once:/sbin/getty -L tty0 115200 vt100 -n root -I "Auto login as root ..."</pre></td></tr></table></figure><h1 id="扩展-bosybox-执行命令"><a class="anchor" href="#扩展-bosybox-执行命令">#</a> 扩展 bosybox 执行命令</h1><p>这里的拓展命令，并不是指基于原有的 bosybox 工程追加命令，而是通过新的工程编译成独立的执行文件，用以拓展命令。</p><p>对于新增编译的 bosybox，一般要满足两个要求：</p><ol><li>glibc 版本的兼容</li><li>尽可能使 bosybox 版本一致</li></ol><h2 id="glibc-版本获取"><a class="anchor" href="#glibc-版本获取">#</a> GLIBC 版本获取</h2><p><strong>方法一：</strong></p><figure class="highlight c"><figcaption data-lang="c"><span>get_glibc_version.c</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span>                                                                </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;gnu/libc-version.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token keyword">char</span> <span class="token operator">*</span> str_gnu_ver <span class="token operator">=</span> <span class="token function">gnu_get_libc_version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre> </pre></td></tr><tr><td data-num="8"></td><td><pre>   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"gnuc lib version : %s \n"</span><span class="token punctuation">,</span>str_gnu_ver<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"__GLIBC__ =  %d \n"</span><span class="token punctuation">,</span>__GLIBC__<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"__GLIBC_MINOR__  = %d \n"</span><span class="token punctuation">,</span>__GLIBC_MINOR__<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre> </pre></td></tr><tr><td data-num="12"></td><td><pre>   <span class="token keyword">return</span> <span class="token number">0</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>编译运行：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost] $"></td><td><pre>gcc get_glibc_version.c <span class="token parameter variable">-o</span> get_glibc_version</pre></td></tr><tr><td data-num="2"></td><td data-command="[root@localhost] $"></td><td><pre>./get_glibc_version</pre></td></tr><tr><td data-num="3"></td><td data-command=""></td><td><pre>gnuc lib version <span class="token builtin class-name">:</span> <span class="token number">2.23</span> </pre></td></tr><tr><td data-num="4"></td><td data-command=""></td><td><pre>__GLIBC__ <span class="token operator">=</span>  <span class="token number">2</span> </pre></td></tr><tr><td data-num="5"></td><td data-command=""></td><td><pre>__GLIBC_MINOR__  <span class="token operator">=</span> <span class="token number">23</span></pre></td></tr></table></figure><p>这里利用哪个交叉编译器，输出的版本就是该编译器的 GLIBC 版本。</p><p>note：GNU C 从 2.0 开始，为 GLIBC 提供两个常量 <code>__GLIBC__</code> 和 <code>__GLIBC_MINOR__</code> 用来指示版本。</p><p><strong>方法二：</strong></p><p>对于开发平台，找到你的交叉编译器所在的安装文件夹，从里面找到 <code>libc.so.6</code> 文件，在该目录下或指向该目录（eg： <code>/usr/local/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf/arm-none-linux-gnueabihf/libc/lib/</code> ），运行以下命令：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost] $"></td><td><pre>strings /usr/local/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf/arm-none-linux-gnueabihf/libc/lib/libc.so.6 <span class="token operator">|</span> <span class="token function">grep</span> ^GLIBC</pre></td></tr><tr><td data-num="2"></td><td data-command=""></td><td><pre>GLIBC_2.4</pre></td></tr><tr><td data-num="3"></td><td data-command=""></td><td><pre>GLIBC_2.5</pre></td></tr><tr><td data-num="4"></td><td data-command=""></td><td><pre>GLIBC_2.6</pre></td></tr><tr><td data-num="5"></td><td data-command=""></td><td><pre>GLIBC_2.7</pre></td></tr><tr><td data-num="6"></td><td data-command=""></td><td><pre>GLIBC_2.8</pre></td></tr><tr><td data-num="7"></td><td data-command=""></td><td><pre>GLIBC_2.9</pre></td></tr><tr><td data-num="8"></td><td data-command=""></td><td><pre>GLIBC_2.10</pre></td></tr><tr><td data-num="9"></td><td data-command=""></td><td><pre>GLIBC_2.11</pre></td></tr><tr><td data-num="10"></td><td data-command=""></td><td><pre>GLIBC_2.12</pre></td></tr><tr><td data-num="11"></td><td data-command=""></td><td><pre>GLIBC_2.13</pre></td></tr><tr><td data-num="12"></td><td data-command=""></td><td><pre>GLIBC_2.14</pre></td></tr><tr><td data-num="13"></td><td data-command=""></td><td><pre>GLIBC_2.15</pre></td></tr><tr><td data-num="14"></td><td data-command=""></td><td><pre>GLIBC_2.16</pre></td></tr><tr><td data-num="15"></td><td data-command=""></td><td><pre>GLIBC_2.17</pre></td></tr><tr><td data-num="16"></td><td data-command=""></td><td><pre>GLIBC_2.18</pre></td></tr><tr><td data-num="17"></td><td data-command=""></td><td><pre>GLIBC_2.22</pre></td></tr><tr><td data-num="18"></td><td data-command=""></td><td><pre>GLIBC_2.23</pre></td></tr><tr><td data-num="19"></td><td data-command=""></td><td><pre>GLIBC_2.24</pre></td></tr><tr><td data-num="20"></td><td data-command=""></td><td><pre>GLIBC_2.25</pre></td></tr><tr><td data-num="21"></td><td data-command=""></td><td><pre>GLIBC_2.26</pre></td></tr><tr><td data-num="22"></td><td data-command=""></td><td><pre>GLIBC_2.27</pre></td></tr><tr><td data-num="23"></td><td data-command=""></td><td><pre>GLIBC_2.28</pre></td></tr><tr><td data-num="24"></td><td data-command=""></td><td><pre>GLIBC_2.29</pre></td></tr><tr><td data-num="25"></td><td data-command=""></td><td><pre>GLIBC_2.30</pre></td></tr><tr><td data-num="26"></td><td data-command=""></td><td><pre>GLIBC_2.32</pre></td></tr><tr><td data-num="27"></td><td data-command=""></td><td><pre>GLIBC_2.33</pre></td></tr><tr><td data-num="28"></td><td data-command=""></td><td><pre>GLIBC_PRIVATE</pre></td></tr><tr><td data-num="29"></td><td data-command=""></td><td><pre>GLIBC_2.29</pre></td></tr><tr><td data-num="30"></td><td data-command=""></td><td><pre>GLIBC_2.26</pre></td></tr><tr><td data-num="31"></td><td data-command=""></td><td><pre>GLIBC_2.25</pre></td></tr><tr><td data-num="32"></td><td data-command=""></td><td><pre>GLIBC_2.23</pre></td></tr><tr><td data-num="33"></td><td data-command=""></td><td><pre>GLIBC_2.8</pre></td></tr><tr><td data-num="34"></td><td data-command=""></td><td><pre>GLIBC_2.33</pre></td></tr><tr><td data-num="35"></td><td data-command=""></td><td><pre>GLIBC_2.30</pre></td></tr><tr><td data-num="36"></td><td data-command=""></td><td><pre>GLIBC_2.5</pre></td></tr><tr><td data-num="37"></td><td data-command=""></td><td><pre>GLIBC_2.9</pre></td></tr><tr><td data-num="38"></td><td data-command=""></td><td><pre>GLIBC_2.7</pre></td></tr><tr><td data-num="39"></td><td data-command=""></td><td><pre>GLIBC_2.6</pre></td></tr><tr><td data-num="40"></td><td data-command=""></td><td><pre>GLIBC_2.18</pre></td></tr><tr><td data-num="41"></td><td data-command=""></td><td><pre>GLIBC_2.14</pre></td></tr><tr><td data-num="42"></td><td data-command=""></td><td><pre>GLIBC_2.11</pre></td></tr><tr><td data-num="43"></td><td data-command=""></td><td><pre>GLIBC_2.16</pre></td></tr><tr><td data-num="44"></td><td data-command=""></td><td><pre>GLIBC_2.13</pre></td></tr></table></figure><p>通常 <span class="exturl" data-url="aHR0cDovL2xpYmMuc28=">libc.so</span> 会支持多个版本，即向前兼容，查看该文件中包含的字符串可以看到其支持的版本，通常是连续的。</p><p>对于目标平台，同样在相关的 <code>lib</code> 库目录上找到 <code>libc.so.6</code> 文件，然后通过执行或查看软链接：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost] $"></td><td><pre>/lib/lib.so.6</pre></td></tr><tr><td data-num="2"></td><td data-command=""></td><td><pre>GNU C Library <span class="token punctuation">(</span>GNU libc<span class="token punctuation">)</span> stable release version <span class="token number">2.21</span>, by Roland McGrath et al.</pre></td></tr><tr><td data-num="3"></td><td data-command=""></td><td><pre>Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2015</span> Free Software Foundation, Inc.</pre></td></tr><tr><td data-num="4"></td><td data-command=""></td><td><pre>This is <span class="token function">free</span> software<span class="token punctuation">;</span> see the <span class="token builtin class-name">source</span> <span class="token keyword">for</span> copying conditions.</pre></td></tr><tr><td data-num="5"></td><td data-command=""></td><td><pre>There is NO warranty<span class="token punctuation">;</span> not even <span class="token keyword">for</span> MERCHANTABILITY or FITNESS FOR A</pre></td></tr><tr><td data-num="6"></td><td data-command=""></td><td><pre>PARTICULAR PURPOSE.</pre></td></tr><tr><td data-num="7"></td><td data-command=""></td><td><pre>Compiled by GNU CC version <span class="token number">5.3</span>.1 <span class="token number">20160113</span>.</pre></td></tr><tr><td data-num="8"></td><td data-command=""></td><td><pre>Available extensions:</pre></td></tr><tr><td data-num="9"></td><td data-command=""></td><td><pre>        crypt add-on version <span class="token number">2.1</span> by Michael Glad and others</pre></td></tr><tr><td data-num="10"></td><td data-command=""></td><td><pre>        GNU Libidn by Simon Josefsson</pre></td></tr><tr><td data-num="11"></td><td data-command=""></td><td><pre>        Native POSIX Threads Library by Ulrich Drepper et al</pre></td></tr><tr><td data-num="12"></td><td data-command=""></td><td><pre>        BIND-8.2.3-T5B</pre></td></tr><tr><td data-num="13"></td><td data-command=""></td><td><pre>libc ABIs: UNIQUE</pre></td></tr><tr><td data-num="14"></td><td data-command=""></td><td><pre>For bug reporting instructions, please see:</pre></td></tr><tr><td data-num="15"></td><td data-command=""></td><td><pre><span class="token operator">&lt;</span>http://www.gnu.org/software/libc/bugs.html<span class="token operator">></span>.</pre></td></tr><tr><td data-num="16"></td><td data-command=""></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">ls</span> <span class="token parameter variable">-al</span> /lib/lib.so.6</pre></td></tr><tr><td data-num="18"></td><td data-command=""></td><td><pre>lrwxrwxrwx    <span class="token number">1</span> root     root            <span class="token number">12</span> Mar <span class="token number">8</span>  <span class="token number">2023</span> /lib/libc.so.6 -<span class="token operator">></span> libc-2.21.so</pre></td></tr></table></figure><h2 id="bosybox-版本获取"><a class="anchor" href="#bosybox-版本获取">#</a> bosybox 版本获取</h2><p>主要是获取目标平台上的版本，然后下载相应的 bosybox 版本进行拓展编译。关于获取目标平台上的版本，可以通过执行：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost] $"></td><td><pre>bosybox</pre></td></tr></table></figure><p>然后下载相应版本进行编译，在这里需要 <code>make menuconfig</code> 把静态编译勾上：</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>-> Settings</pre></td></tr><tr><td data-num="2"></td><td><pre>  -> [*] Build static binary (no shared libs)</pre></td></tr></table></figure><p>因为如果用动态编译的话，需要调用 <code>lib</code> 库，这样就会使得需要确保交叉编译器得尽可能一致，使用的 <code>lib</code> 库也要尽可能一致，而利用静态编译就不用调用 <code>lib</code> 库了。</p><h2 id="实现合并"><a class="anchor" href="#实现合并">#</a> 实现合并</h2><p>当你编译好一个新的 busybox 后，在 rootfs 上找个目录存放，或者取一个 busybox1 之类的名字存放至 <code>/bin</code> 目录上，然后把生成软链接拓展命令，替换链接到新的 busybox1 即可。</p><h1 id="参考"><a class="anchor" href="#参考">#</a> 参考</h1><p><span class="exturl" data-url="aHR0cHM6Ly9mdXppZGFnZS5naXRodWIuaW8vMjAyNC8wNy8yMC9MaW51eCVFNSU4NiU4NSVFNiVBMCVCOC1yb290ZnMlRTYlOUUlODQlRTUlQkIlQkElRTclQTclQkIlRTYlQTQlOEQvIzMtZ291LWppYW4tZ2VuLXdlbi1qaWFuLXhpLXRvbmc=">https://fuzidage.github.io/2024/07/20/Linux 内核 - rootfs 构建移植 /#3-gou-jian-gen-wen-jian-xi-tong</span></p><p><span class="exturl" data-url="aHR0cDovL3d3dy5sdWp1bi5vcmcuY24vP3A9MzU3NA==">http://www.lujun.org.cn/?p=3574</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbGluZmVuZy1sZWFybmluZy9wLzkyODU1NDMuaHRtbA==">https://www.cnblogs.com/linfeng-learning/p/9285543.html</span></p><p><span class="exturl" data-url="aHR0cDovL2Jsb2cuY2hpbmF1bml4Lm5ldC91aWQtMjA1NjQ4NDgtaWQtNzM5NTQuaHRtbA==">http://blog.chinaunix.net/uid-20564848-id-73954.html</span></p><div class="tags"><a href="/tags/Linux/" rel="tag"><i class="ic i-tag"></i> Linux</a> <a href="/tags/arm-linux/" rel="tag"><i class="ic i-tag"></i> arm_linux</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-08-30 23:15:56" itemprop="dateModified" datetime="2024-08-30T23:15:56+08:00">2024-08-30</time></span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="linux-rootfs-create/" class="item leancloud_visitors" data-flag-title="Linux 根文件系统的构建" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span id="busuanzi_value_page_pv"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 投喂</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.webp" alt="夏沫の浅雨 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.webp" alt="夏沫の浅雨 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>夏沫の浅雨 <i class="ic i-at"><em>@</em></i>命运转轮</li><li class="link"><strong>本文链接：</strong> <a href="https://arachnid.cc/linux-rootfs-create/" title="Linux 根文件系统的构建">https://arachnid.cc/linux-rootfs-create/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/6ull-kernel-transplant/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;arachnid.cc&#x2F;picture&#x2F;(17).webp" title="imx-6ULL kernel 移植"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>imx-6ULL kernel 移植</h3></a></div><div class="item right"><a href="/linux_c-time-configuration/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;arachnid.cc&#x2F;picture&#x2F;(8).webp" title="Linux c 时间时区配置"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>Linux c 时间时区配置</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.</span> <span class="toc-text">环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E5%99%A8"><span class="toc-number">1.1.</span> <span class="toc-text">交叉编译器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.</span> <span class="toc-text">文件系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E6%88%90"><span class="toc-number">2.1.</span> <span class="toc-text">组成</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">构建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#busybox"><span class="toc-number">3.1.</span> <span class="toc-text">busybox</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E9%AA%8C%E8%AF%81"><span class="toc-number">3.1.1.</span> <span class="toc-text">编译验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E4%B8%BB%E9%85%8D%E7%BD%AE"><span class="toc-number">3.1.2.</span> <span class="toc-text">自主配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%B8%AD%E6%96%87%E6%94%AF%E6%8C%81"><span class="toc-number">3.1.3.</span> <span class="toc-text">添加中文支持</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E8%84%9A%E6%9C%AC"><span class="toc-number">3.2.</span> <span class="toc-text">编写脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E5%85%85-rootfs-%E7%9B%AE%E5%BD%95"><span class="toc-number">3.3.</span> <span class="toc-text">补充 rootfs 目录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-lib-%E5%BA%93"><span class="toc-number">3.3.1.</span> <span class="toc-text">添加 lib 库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E5%96%84%E6%A0%B9%E7%9B%AE%E5%BD%95"><span class="toc-number">3.3.2.</span> <span class="toc-text">完善根目录</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">4.</span> <span class="toc-text">测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-rcs-%E6%96%87%E4%BB%B6"><span class="toc-number">4.1.</span> <span class="toc-text">添加 rcS 文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85-fstab-%E5%92%8C-rclocal-%E6%96%87%E4%BB%B6"><span class="toc-number">4.1.1.</span> <span class="toc-text">补充 fstab 和 rc.local 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E5%96%84-devpts-%E5%92%8C-etchostname"><span class="toc-number">4.1.2.</span> <span class="toc-text">完善 &#x2F;dev&#x2F;pts 和 &#x2F;etc&#x2F;hostname</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-profile-%E6%96%87%E4%BB%B6"><span class="toc-number">4.2.</span> <span class="toc-text">添加 profile 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-passwad-shadow-group-gshadow-%E6%96%87%E4%BB%B6"><span class="toc-number">4.3.</span> <span class="toc-text">添加 passwad , shadow , group , gshadow 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-inittab-%E6%96%87%E4%BB%B6"><span class="toc-number">4.4.</span> <span class="toc-text">添加 inittab 文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%89%A9%E5%B1%95-bosybox-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">5.</span> <span class="toc-text">扩展 bosybox 执行命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#glibc-%E7%89%88%E6%9C%AC%E8%8E%B7%E5%8F%96"><span class="toc-number">5.1.</span> <span class="toc-text">GLIBC 版本获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bosybox-%E7%89%88%E6%9C%AC%E8%8E%B7%E5%8F%96"><span class="toc-number">5.2.</span> <span class="toc-text">bosybox 版本获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%90%88%E5%B9%B6"><span class="toc-number">5.3.</span> <span class="toc-text">实现合并</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">6.</span> <span class="toc-text">参考</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="夏沫の浅雨" data-src="/images/avatar.webp"><p class="name" itemprop="name">夏沫の浅雨</p><div class="description" itemprop="description">不曾亏欠，不曾辜负，如此足矣</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">98</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">6</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">26</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FyYWNobmlkLTk3" title="https:&#x2F;&#x2F;github.com&#x2F;Arachnid-97"><i class="ic i-github"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMjM2MTA4MzU=" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;23610835"><i class="ic i-bilibili"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友人帐</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-info-circle"></i>关于</a></li><li class="item"><a href="/atom.xml" rel="section"><i class="ic i-rss"></i>RSS</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/6ull-kernel-transplant/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/linux_c-time-configuration/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/modbus/" title="分类于 modbus">modbus</a></div><span><a href="/modbus-rtu-protocol" title="Modbus家族之 RTU">Modbus家族之 RTU<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/logic-device" title="逻辑门、锁存器和触发器">逻辑门、锁存器和触发器<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/linux-device-common-operation" title="Linux 设备常用操作">Linux 设备常用操作<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/virtual-network-setup" title="vmware 下 Ubuntu 双网卡设置">vmware 下 Ubuntu 双网卡设置<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Hexo/" title="分类于 Hexo-shoka">Hexo-shoka</a></div><span><a href="/hexo-shoka-create" title="博客搭建笔记之 Hexo-shoka">博客搭建笔记之 Hexo-shoka<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/linux-system-constitute" title="Linux 系统构成：bootloader、kernel、rootfs">Linux 系统构成：bootloader、kernel、rootfs<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/FreeRTOS/" title="分类于 FreeRTOS">FreeRTOS</a></div><span><a href="/freertos-config" title="FreeRTOS 篇章之 FreeRTOSConfig.h 分析">FreeRTOS 篇章之 FreeRTOSConfig.h 分析<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/NAS/" title="分类于 NAS">NAS</a></div><span><a href="/docker-deployment-of-v2raya" title="docker 部署之 v2raya 科学上网">docker 部署之 v2raya 科学上网<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/ubuntu-ftp-create" title="Ubuntu 下 FTP 的搭建配置">Ubuntu 下 FTP 的搭建配置<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/x-ymodem-protocol" title="X&#x2F;YModem 传输协议">X/YModem 传输协议<i class="ic i-link-alt"></i></a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">夏沫の浅雨 @ Arachnid's blog</span></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="count"><span class="icon"><i class="ic i-person"></i> <span id="busuanzi_value_site_uv"></span>人 <span class="post-meta-divider">|</span> <span class="icon"><i class="ic i-eye"></i> <span id="busuanzi_value_site_pv"></span>次 <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">692k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">11:46</span></span></span></div><div class="create_time"><span class="icon"><i class="ic i-clock"></i> <span id="timeDate">正在加载</span> <span id="times">...</span><script>function createtime(){var n=new Date("04/28/2022 15:45:50");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML=" 本站存活 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}var now=new Date;setInterval("createtime()",250)</script></span></div><div class="powered-by">Powered-by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"linux-rootfs-create/",favicon:{show:"ψ(｀∇´)ψ 欢迎回来!",hide:"《原子弹入门及制造》"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',isOutdated:!0,format_year_as_prefix:"{{year}}年",format_month_as_prefix:"{{month}}个月",format_month_as_suffix:"零{{month}}个月",format_day_as_prefix:"{{day}}天",format_day_as_suffix:"零{{day}}天",template:"<div class='note warning'><p><span class='label primary'><strong>文章时效性提示</strong></span><br>这是一篇发布于 <span class='pink'>{{publish}}</span> 前，最后一次更新距今已经 <span class='pink'>{{updated}}</span> 的文章，部分内容可能已经过时，请注意甄别。</p></div>",ignores:[function(a){return a.includes("#")},function(a){return new RegExp(LOCAL.path+"$").test(a)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="/js/combined-file.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->